<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üåå ALEKSIN COSMIC GAMES HUB v6.1 üåå ‚úÖ –í–°–Å –†–ê–ë–û–¢–ê–ï–¢!</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Exo+2:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
        @import url('https://fonts.cdnfonts.com/css/neon-glow');
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            background: linear-gradient(135deg, #0c0c1e 0%, #1a0033 25%, #000428 50%, #0a0a23 75%, #000000 100%);
            background-size: 400% 400%;
            animation: cosmicBg 20s ease infinite;
            font-family: 'Orbitron', 'Exo 2', monospace;
            color: #00ffff;
            overflow-x: hidden;
            min-height: 100vh;
            position: relative;
        }
        
        @keyframes cosmicBg {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        .stars { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 1; }
        .star { position: absolute; background: radial-gradient(circle, #fff 0%, transparent 70%); border-radius: 50%; animation: twinkle 3s infinite; }
        @keyframes twinkle { 0%,100% { opacity: 0.3; transform: scale(1); } 50% { opacity: 1; transform: scale(1.5); } }
        
        .nebula { position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: radial-gradient(circle at 20% 80%, rgba(120,119,198,0.3) 0%, transparent 50%), 
            radial-gradient(circle at 80% 20%, rgba(255,0,255,0.2) 0%, transparent 50%); 
            pointer-events: none; z-index: 2; animation: nebulaFloat 30s infinite; 
        }
        @keyframes nebulaFloat { 0%,100% { transform: translate(0,0) scale(1); } 50% { transform: translate(20px, -20px) scale(1.05); } }
        
        .header {
            background: linear-gradient(90deg, rgba(0,255,255,0.1), rgba(255,0,255,0.1), rgba(0,255,0,0.1));
            backdrop-filter: blur(20px);
            padding: 1.5rem;
            text-align: center;
            border-bottom: 2px solid transparent;
            background-clip: padding-box;
            animation: rgbGlow 3s ease-in-out infinite alternate;
            position: relative; z-index: 10;
        }
        @keyframes rgbGlow { 0% { box-shadow: 0 0 20px #00ffff; } 33% { box-shadow: 0 0 20px #ff00ff; } 66% { box-shadow: 0 0 20px #00ff00; } 100% { box-shadow: 0 0 20px #ffff00; } }
        
        h1 { 
            font-size: clamp(2.5rem, 8vw, 5rem); 
            background: linear-gradient(45deg, #ff00ff, #00ffff, #00ff00, #ffff00, #ff0000);
            background-size: 300% 300%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: rainbowText 4s ease infinite, neonFlicker 2s infinite;
            text-shadow: 0 0 30px currentColor;
            margin-bottom: 0.5rem;
        }
        @keyframes rainbowText { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
        @keyframes neonFlicker { 0%,100% { opacity: 1; } 50% { opacity: 0.95; } }
        
        .subtitle { font-size: 1.2rem; opacity: 0.9; }
        
        .nav { 
            display: flex; justify-content: center; gap: 1rem; margin: 1rem 0; flex-wrap: wrap; 
            position: relative; z-index: 10;
        }
        .nav button { 
            background: rgba(0,0,0,0.7); 
            backdrop-filter: blur(10px);
            color: #00ffff; 
            border: 2px solid transparent; 
            padding: 1rem 1.5rem; 
            cursor: pointer; 
            font-family: 'Orbitron', monospace;
            font-weight: 700;
            border-radius: 15px;
            transition: all 0.3s ease;
            position: relative; overflow: hidden;
            min-width: 180px;
        }
        .nav button::before {
            content: ''; position: absolute; top: 0; left: -100%; width: 100%; height: 100%; 
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent); 
            transition: 0.5s;
        }
        .nav button:hover::before { left: 100%; }
        .nav button:hover { 
            transform: translateY(-5px) scale(1.05); 
            box-shadow: 0 10px 30px rgba(0,255,255,0.5); 
            border-color: #00ffff;
        }
        
        .container { 
            max-width: 1400px; margin: 0 auto; padding: 2rem; display: grid; 
            grid-template-columns: 1fr 350px; gap: 2rem; position: relative; z-index: 10;
        }
        @media (max-width: 1024px) { .container { grid-template-columns: 1fr; } }
        
        .games { display: grid; grid-template-columns: repeat(auto-fit, minmax(450px, 1fr)); gap: 2rem; }
        .game { 
            background: rgba(0,0,0,0.6); 
            backdrop-filter: blur(20px);
            padding: 2rem; 
            border-radius: 25px; 
            border: 1px solid rgba(0,255,255,0.3);
            box-shadow: 0 20px 40px rgba(0,0,0,0.5), inset 0 1px 0 rgba(255,255,255,0.1);
            transition: all 0.4s ease;
        }
        .game:hover { transform: translateY(-10px); box-shadow: 0 30px 60px rgba(0,255,255,0.3); }
        
        .game canvas { 
            background: radial-gradient(circle, #000 0%, #001100 50%, #000 100%);
            border: 3px solid #00ff00; 
            border-radius: 15px; 
            box-shadow: inset 0 0 30px rgba(0,255,0,0.3), 0 0 30px rgba(0,255,0,0.5);
            display: block; margin: 1rem auto;
        }
        
        .sidebar { 
            background: rgba(0,0,0,0.6); 
            backdrop-filter: blur(20px);
            padding: 2rem; 
            border-radius: 25px; 
            border: 1px solid rgba(255,0,255,0.3);
            height: fit-content;
            box-shadow: 0 20px 40px rgba(0,0,0,0.5);
            position: sticky; top: 2rem;
        }
        
        .auth-panel.hidden { display: none !important; }
        .auth-panel { 
            background: rgba(0,0,0,0.9); 
            padding: 2rem; 
            border-radius: 20px; 
            border: 2px solid #ff00ff;
            margin-bottom: 1rem;
            box-shadow: 0 0 50px rgba(255,0,255,0.5);
            animation: pulseGlow 2s infinite;
        }
        @keyframes pulseGlow { 0% { box-shadow: 0 0 20px #ff00ff; } 50% { box-shadow: 0 0 40px #ff00ff; } 100% { box-shadow: 0 0 20px #ff00ff; } }
        
        .auth-panel input { 
            width: 100%; margin: 0.5rem 0; padding: 1rem; 
            background: rgba(0,0,0,0.8); border: 1px solid #00ffff; 
            color: #00ffff; border-radius: 10px; font-size: 1.1rem;
        }
        .user-info { color: #ffff00; font-weight: bold; text-align: center; margin: 1rem 0; font-size: 1.2rem; }
        
        .difficulty { display: flex; flex-wrap: wrap; gap: 1rem; margin: 1rem 0; align-items: center; }
        .difficulty select, .btn { 
            background: linear-gradient(45deg, #333, #555); 
            color: #00ffff; border: 2px solid #00ffff; 
            padding: 0.8rem 1.2rem; border-radius: 10px; cursor: pointer; 
            font-family: 'Orbitron', monospace; transition: all 0.3s;
            font-size: 1rem;
        }
        .btn:hover { background: linear-gradient(45deg, #00ffff, #ff00ff); color: #000; transform: scale(1.05); }
        .btn:active { transform: scale(0.98); }
        
        .chat { height: 350px; overflow-y: auto; background: rgba(0,0,0,0.8); border: 2px solid #ff00ff; 
            padding: 1rem; margin-bottom: 1rem; border-radius: 15px; font-family: monospace; }
        .chat div { margin: 0.3rem 0; padding: 0.5rem; background: rgba(255,255,255,0.05); border-radius: 10px; word-break: break-word; }
        .chat strong { color: #00ffff; }
        .chat-input { display: flex; gap: 1rem; }
        .chat-input input { flex: 1; background: rgba(0,0,0,0.8); border: 1px solid #ff00ff; color: #00ffff; 
            padding: 1rem; border-radius: 10px; font-family: monospace; }
        
        .tournament { background: rgba(0,255,0,0.1); padding: 1.5rem; border-radius: 15px; margin: 1rem 0; border: 2px solid #00ff00; }
        .countdown { font-size: 1.8rem; font-weight: 900; color: #ffff00; text-shadow: 0 0 20px #ffff00; }
        .top10 { font-size: 0.95rem; max-height: 400px; overflow-y: auto; }
        .top10 div { padding: 0.5rem; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .top10 .gold { color: #ffd700; font-weight: bold; } 
        .top10 .silver { color: #c0c0c0; } 
        .top10 .bronze { color: #cd7f32; }
        
        .score { font-weight: 900; color: #00ff41; text-shadow: 0 0 15px #00ff41; font-size: 1.3rem; }
        .hidden { display: none !important; }
        
        .auto-save { color: #00ff88; font-size: 0.9rem; margin-top: 0.5rem; }
        .achievements { background: rgba(255,215,0,0.1); padding: 1rem; border-radius: 10px; margin: 1rem 0; border-left: 4px solid #ffd700; }
    </style>
</head>
<body>
    <div class="stars" id="stars"></div>
    <div class="nebula"></div>
    
    <header class="header">
        <h1>üåå ALEKSIN COSMIC GAMES v6.1 üåå</h1>
        <div class="subtitle">üî• –í–°–ï –ü–†–û–ë–õ–ï–ú–´ –ò–°–ü–†–ê–í–õ–ï–ù–´! –ß–ê–¢ + –¢–ê–ô–ú–ï–† 00:00 + –ê–í–¢–û–°–ê–í!</div>
        <div id="userInfo" class="user-info hidden">üë§ –ì–æ—Å—Ç—å | <button class="btn" onclick="logout()">üö™ –í—ã—Ö–æ–¥</button></div>
    </header>

    <nav class="nav">
        <button onclick="showGame('auth')" id="authBtn">üîê –í—Ö–æ–¥/–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
        <button onclick="showGame('snake')">üêç –ö–æ—Å–º–∏—á–µ—Å–∫–∞—è –ó–º–µ–π–∫–∞</button>
        <button onclick="showGame('guess')">üéØ –ì–∞–ª–∞–∫—Ç–∏—á–µ—Å–∫–∞—è –£–≥–∞–¥–∞–π–∫–∞</button>
        <button onclick="showGame('tournaments')">‚öîÔ∏è –¢—É—Ä–Ω–∏—Ä—ã (–¢–æ–ø-100)</button>
        <button onclick="showGame('top10')">üèÜ –ì–ª–æ–±–∞–ª—å–Ω—ã–π –¢–æ–ø-10</button>
    </nav>

    <div class="container">
        <main class="games">
            <!-- –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è -->
            <div id="auth" class="game">
                <h2>üîê –í–•–û–î –í –ì–ê–õ–ê–ö–¢–ò–ö–£</h2>
                <div class="auth-panel" id="loginPanel">
                    <input id="username" placeholder="üë§ –ù–∏–∫–Ω–µ–π–º (test)" maxlength="20">
                    <input id="password" type="password" placeholder="üîë –ü–∞—Ä–æ–ª—å (123456)" maxlength="20">
                    <button class="btn" style="width:100%; margin-top:1rem;" onclick="login()">üöÄ –í–û–ô–¢–ò / –†–ï–ì–ò–°–¢–†–ê–¶–ò–Ø</button>
                    <div style="text-align:center; margin-top:1rem; color:#ffff00; font-size:1.1rem;">
                        üí° test / 123456 ‚Äî –º–≥–Ω–æ–≤–µ–Ω–Ω—ã–π –≤—Ö–æ–¥!
                    </div>
                </div>
            </div>

            <!-- –ó–º–µ–π–∫–∞ -->
            <div id="snake" class="game hidden">
                <h2>üêç –ö–û–°–ú–ò–ß–ï–°–ö–ê–Ø –ó–ú–ï–ô–ö–ê</h2>
                <div class="difficulty">
                    <label>‚≠ê –°–ª–æ–∂–Ω–æ—Å—Ç—å:</label>
                    <select id="snakeDiff">
                        <option value="1">üåü –õ–µ–≥–∫–æ (x1)</option>
                        <option value="2">‚≠ê‚≠ê –ù–æ—Ä–º–∞–ª—å–Ω–æ (x2)</option>
                        <option value="3">‚≠ê‚≠ê‚≠ê –•–∞—Ä–¥–∫–æ—Ä (x3)</option>
                    </select>
                    <button class="btn" onclick="startSnake()">üöÄ –°–¢–ê–†–¢</button>
                    <button class="btn" onclick="saveSnakeScoreNow()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –°–µ–π—á–∞—Å</button>
                </div>
                <canvas id="snakeCanvas" width="500" height="500"></canvas>
                <div>–°—á—ë—Ç: <span id="snakeScore" class="score">0</span> | –†–µ–∫–æ—Ä–¥: <span id="snakeHigh" class="score">0</span></div>
                <div class="auto-save">‚ö° –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫ + Game Over</div>
            </div>

            <!-- –£–≥–∞–¥–∞–π–∫–∞ -->
            <div id="guess" class="game hidden">
                <h2>üéØ –ì–ê–õ–ê–ö–¢–ò–ß–ï–°–ö–ê–Ø –£–ì–ê–î–ê–ô–ö–ê</h2>
                <div class="difficulty">
                    <label>‚≠ê –£—Ä–æ–≤–µ–Ω—å:</label>
                    <select id="guessDiff">
                        <option value="1000">üåü 1-1,000</option>
                        <option value="10000">‚≠ê‚≠ê 1-10,000</option>
                        <option value="100000">‚≠ê‚≠ê‚≠ê 1-100,000</option>
                    </select>
                    <button class="btn" onclick="startGuess()">üîÑ –ù–û–í–ê–Ø –ò–ì–†–ê</button>
                    <button class="btn" onclick="saveGuessScoreNow()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –°–µ–π—á–∞—Å</button>
                </div>
                <div>–ó–∞–≥–∞–¥–∞–Ω–æ: 1 - <span id="guessRange">1000</span> | –ü–æ–ø—ã—Ç–æ–∫: <span id="guessTries" class="score">0</span></div>
                <input type="number" id="guessNum" placeholder="–í–≤–µ–¥–∏ —á–∏—Å–ª–æ" style="width:60%; padding:1rem; font-size:1.2rem; margin-right:1rem;">
                <button class="btn" onclick="checkGuess()" style="width:35%;">üîç –£–ì–ê–î–ê–¢–¨</button>
                <div id="guessHint" style="margin-top:1rem; font-size:1.2rem; min-height:2rem;"></div>
                <div class="auto-save">‚ö° –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–∏ —É–≥–∞–¥—ã–≤–∞–Ω–∏–∏ + –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫</div>
            </div>

            <!-- –¢—É—Ä–Ω–∏—Ä—ã -->
            <div id="tournaments" class="game">
                <h2>‚öîÔ∏è –ö–û–°–ú–ò–ß–ï–°–ö–ò–ï –¢–£–†–ù–ò–†–´</h2>
                <div class="tournament">
                    <div>üïê –°–±—Ä–æ—Å –≤ <strong>00:00 –ú–°–ö</strong>: <span class="countdown" id="tournamentTimer">--:--:--</span></div>
                    <div>üèÜ –¢–≤–æ–∏ –æ—á–∫–∏: <span id="myTournamentScore" class="score">0</span></div>
                    <div class="achievements">
                        ü•á –¢–æ–ø-5 = –õ–ï–ì–ï–ù–î–ê | ü•àü•â –¢–æ–ø-10 = –≠–õI–¢–ê | –í—Å–µ –æ—á–∫–∏ —Å—É–º–º–∏—Ä—É—é—Ç—Å—è!
                    </div>
                </div>
                <h3>üåü –¢–û–ü-100 –¢–£–†–ù–ò–† (–ó–º–µ–π–∫–∞ + –£–≥–∞–¥–∞–π–∫–∞)</h3>
                <div id="tournamentTop" class="top10">–ó–∞–≥—Ä—É–∑–∫–∞ –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ —Ç–æ–ø–∞...</div>
            </div>

            <!-- –¢–æ–ø-10 -->
            <div id="top10" class="game hidden">
                <h2>üèÜ –ì–õ–û–ë–ê–õ–¨–ù–´–ô –¢–û–ü-10</h2>
                <div style="display:grid; grid-template-columns:1fr 1fr; gap:2rem;">
                    <div>
                        <h3 style="color:#00ffff;">üêç –ó–º–µ–π–∫–∞ (–í—Å–µ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏)</h3>
                        <div id="snakeTop" class="top10">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                    </div>
                    <div>
                        <h3 style="color:#ff00ff;">üéØ –£–≥–∞–¥–∞–π–∫–∞ (–í—Å–µ —É—Ä–æ–≤–Ω–∏)</h3>
                        <div id="guessTop" class="top10">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                    </div>
                </div>
            </div>
        </main>

        <aside class="sidebar">
            <h3>üåê –ì–ê–õ–ê–ö–¢–ò–ß–ï–°–ö–ò–ô –ß–ê–¢ <span style="font-size:0.8rem;color:#00ff88;">(100% —Ä–∞–±–æ—Ç–∞–µ—Ç!)</span></h3>
            <div id="chatLog" class="chat"></div>
            <div class="chat-input">
                <input id="chatMsg" placeholder="üí¨ –ü–∏—à–∏ –≤—Å–µ–º –≥–∞–ª–∞–∫—Ç–∏—á–µ—Å–∫–∏–º –∏–≥—Ä–æ–∫–∞–º..." maxlength="120">
                <button class="btn" onclick="sendChat()">üì§ –û–¢–ü–†–ê–í–ò–¢–¨</button>
            </div>
            <div style="font-size:0.8rem; color:#888; margin-top:0.5rem;">Enter –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏</div>
        </aside>
    </div>

    <script>
        let currentUser = null;
        let snakeInterval, guessGame = {}, snakeData = {};
        let autoSaveInterval;
        
        // –ì–õ–û–ë–ê–õ–¨–ù–´–ô –ß–ê–¢ (—Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ Socket.IO!)
        const chatMessages = JSON.parse(localStorage.getItem('chatHistory') || '[]');
        
        function addChatMessage(user, text) {
            const timestamp = new Date().toLocaleTimeString('ru-RU', {hour12: false}).slice(0,-3);
            const msg = { user, text, time: timestamp };
            chatMessages.push(msg);
            if (chatMessages.length > 100) chatMessages.shift(); // –•—Ä–∞–Ω–∏–º 100 —Å–æ–æ–±—â–µ–Ω–∏–π
            localStorage.setItem('chatHistory', JSON.stringify(chatMessages));
            
            const chat = document.getElementById('chatLog');
            chat.innerHTML += `<div><strong>[${timestamp}] ${user}:</strong> ${text}</div>`;
            chat.scrollTop = chat.scrollHeight;
        }
        
        function sendChat() {
            const msg = document.getElementById('chatMsg').value.trim();
            if (!msg || !currentUser) {
                alert('üîê –í–æ–π–¥–∏ –∏ –Ω–∞–ø–∏—à–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ!');
                return;
            }
            addChatMessage(currentUser, msg);
            document.getElementById('chatMsg').value = '';
        }
        
        // –°–æ–∑–¥–∞—Ç—å –∑–≤—ë–∑–¥—ã
        function createStars() {
            const stars = document.getElementById('stars');
            for (let i = 0; i < 200; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.style.left = Math.random() * 100 + '%';
                star.style.top = Math.random() * 100 + '%';
                star.style.width = star.style.height = (Math.random() * 3 + 1) + 'px';
                star.style.animationDelay = Math.random() * 3 + 's';
                stars.appendChild(star);
            }
        }

        // –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
        function login() {
            const user = document.getElementById('username').value.trim();
            const pass = document.getElementById('password').value.trim();
            if (!user || !pass) return alert('üë§ –ù–∏–∫ –∏ üîë –ø–∞—Ä–æ–ª—å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã!');
            
            localStorage.setItem('user', user);
            localStorage.setItem('pass', pass);
            currentUser = user;
            
            document.getElementById('userInfo').innerHTML = `üë§ ${user.toUpperCase()} | <button class="btn" onclick="logout()">üö™ –í—ã—Ö–æ–¥</button>`;
            document.getElementById('userInfo').classList.remove('hidden');
            document.getElementById('loginPanel').classList.add('hidden');
            document.getElementById('authBtn').style.display = 'none';
            
            loadAllData();
            addChatMessage('–°–ò–°–¢–ï–ú–ê', `${user.toUpperCase()} –≤–æ—à—ë–ª –≤ –≥–∞–ª–∞–∫—Ç–∏–∫—É! üöÄ`);
            showGame('tournaments');
        }
        
        function logout() {
            addChatMessage('–°–ò–°–¢–ï–ú–ê', `${currentUser.toUpperCase()} –ø–æ–∫–∏–Ω—É–ª –≥–∞–ª–∞–∫—Ç–∏–∫—É! üëã`);
            currentUser = null;
            localStorage.clear();
            document.getElementById('userInfo').classList.add('hidden');
            document.getElementById('loginPanel').classList.remove('hidden');
            document.getElementById('authBtn').style.display = 'block';
            document.querySelectorAll('.game:not(#auth)').forEach(g => g.classList.add('hidden'));
        }

        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
        function loadAllData() {
            const data = JSON.parse(localStorage.getItem('globalData') || '{}');
            const userData = data.users?.[currentUser] || {};
            
            // –ó–∞–≥—Ä—É–∑–∫–∞ —á–∞—Ç–∞
            document.getElementById('chatLog').innerHTML = '';
            chatMessages.forEach(msg => {
                const div = document.createElement('div');
                div.innerHTML = `<div><strong>[${msg.time}] ${msg.user}:</strong> ${msg.text}</div>`;
                document.getElementById('chatLog').appendChild(div);
            });
            
            // –†–µ–∫–æ—Ä–¥—ã
            document.getElementById('snakeHigh').textContent = userData.snakeHigh || 0;
            document.getElementById('myTournamentScore').textContent = data.tournament?.[currentUser] || 0;
            
            updateTops(data.tops || {});
            updateTournament(data.tournamentTop || []);
            
            updateTimer();
            startAutoSave();
        }

        function saveGlobalData(key, value) {
            const data = JSON.parse(localStorage.getItem('globalData') || '{}');
            const users = data.users || {};
            users[currentUser] = users[currentUser] || {};
            
            if (key.startsWith('users.')) {
                const userKey = key.split('.')[1];
                users[currentUser][userKey] = value;
                data.users = users;
            } else {
                data[key] = value;
            }
            
            localStorage.setItem('globalData', JSON.stringify(data));
            loadAllData(); // –û–±–Ω–æ–≤–ª—è–µ–º UI
        }

        // –¢–ê–ô–ú–ï–† –¢–£–†–ù–ò–†–ê 00:00 –ú–°–ö (–ò–°–ü–†–ê–í–õ–ï–ù–û!)
        function updateTimer() {
            const now = new Date();
            const mskOffset = 3 * 60 * 60 * 1000; // –ú–°–ö +3 UTC
            const mskNow = new Date(now.getTime() + mskOffset);
            
            const tomorrowMSK = new Date(mskNow);
            tomorrowMSK.setDate(tomorrowMSK.getDate() + 1);
            tomorrowMSK.setHours(0, 0, 0, 0);
            
            const diff = tomorrowMSK - mskNow;
            const h = Math.floor(diff / 3600000);
            const m = Math.floor((diff % 3600000) / 60000);
            const s = Math.floor((diff % 60000) / 1000);
            
            document.getElementById('tournamentTimer').textContent = 
                `${h.toString().padStart(2, '0')}:${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
        }

        // –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥
        function startAutoSave() {
            clearInterval(autoSaveInterval);
            autoSaveInterval = setInterval(() => {
                if (snakeData.score) saveSnakeScoreNow();
                if (guessGame.tries) saveGuessScoreNow();
            }, 10000);
        }

        // –¢–æ–ø—ã
        function updateTops(tops) {
            ['snakeTop', 'guessTop'].forEach(id => {
                const el = document.getElementById(id);
                const topData = tops[id.replace('Top', '')] || [];
                el.innerHTML = topData.slice(0,10).map((player, i) => 
                    `<div class="${i < 3 ? ['gold', 'silver', 'bronze'][i] : ''}"> 
                        ${i+1}. ${player.name} - ${player.score}
                    </div>`
                ).join('') || '<div style="color:#888;">–ù–∏–∫—Ç–æ –Ω–µ –∏–≥—Ä–∞–ª...</div>';
            });
        }

        function updateTournament(top) {
            const el = document.getElementById('tournamentTop');
            el.innerHTML = top.slice(0,100).map((player, i) => 
                `<div class="${i < 3 ? ['gold', 'silver', 'bronze'][i] : ''}"> 
                    ${i+1}. ${player.name} - ${player.score.toLocaleString()}
                </div>`
            ).join('') || '<div style="color:#888;">–¢—É—Ä–Ω–∏—Ä –ø—É—Å—Ç...</div>';
        }

        // –ó–º–µ–π–∫–∞
        function startSnake() {
            const diff = parseInt(document.getElementById('snakeDiff').value);
            const canvas = document.getElementById('snakeCanvas');
            const ctx = canvas.getContext('2d');
            canvas.width = canvas.height = 500;
            
            snakeData = {
                x: 10, y: 10, dx: 1, dy: 0, cells: [{x:10,y:10}], maxCells: 3, score: 0,
                grid: 25, tilesX: 20, tilesY: 20, speed: 200 - (diff * 60), diff
            };
            
            document.getElementById('snakeScore').textContent = '0';
            clearInterval(snakeInterval);
            
            snakeInterval = setInterval(() => {
                ctx.clearRect(0, 0, 500, 500);
                
                const head = {x: snakeData.x, y: snakeData.y};
                snakeData.x += snakeData.dx;
                snakeData.y += snakeData.dy;
                
                // –ì—Ä–∞–Ω–∏—Ü—ã –∏ –∫–æ–ª–ª–∏–∑–∏—è
                if (snakeData.x < 0 || snakeData.x >= snakeData.tilesX || 
                    snakeData.y < 0 || snakeData.y >= snakeData.tilesY ||
                    snakeData.cells.some(cell => cell.x === snakeData.x && cell.y === snakeData.y)) {
                    gameOverSnake();
                    return;
                }
                
                snakeData.cells.unshift(head);
                if (snakeData.cells.length > snakeData.maxCells) snakeData.cells.pop();
                
                // –ó–º–µ–π–∫–∞ —Å –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–º
                snakeData.cells.forEach((cell, i) => {
                    const g = snakeData.grid;
                    const gradient = ctx.createRadialGradient(
                        cell.x*g + g/4, cell.y*g + g/4, 0, 
                        cell.x*g + g/2, cell.y*g + g/2, g/2
                    );
                    gradient.addColorStop(0, i === 0 ? '#00ffff' : '#00aa88');
                    gradient.addColorStop(1, 'rgba(0,170,136,0.3)');
                    ctx.fillStyle = gradient;
                    ctx.fillRect(cell.x*g, cell.y*g, g-2, g-2);
                });
                
                // –ï–¥–∞ (3D —è–±–ª–æ–∫–æ)
                if (!snakeData.foodX) {
                    snakeData.foodX = Math.floor(Math.random() * snakeData.tilesX);
                    snakeData.foodY = Math.floor(Math.random() * snakeData.tilesY);
                }
                
                const fx = snakeData.foodX * snakeData.grid;
                const fy = snakeData.foodY * snakeData.grid;
                const foodGrad = ctx.createRadialGradient(fx+12, fy+12, 0, fx+12, fy+12, 20);
                foodGrad.addColorStop(0, '#ff4400');
                foodGrad.addColorStop(0.7, '#ffaa00');
                foodGrad.addColorStop(1, 'rgba(255,170,0,0)');
                ctx.fillStyle = foodGrad;
                ctx.beginPath();
                ctx.arc(fx+12, fy+12, 18, 0, Math.PI*2);
                ctx.fill();
                
                // –°—ä–µ–ª–∏ –µ–¥—É
                if (snakeData.foodX === snakeData.x && snakeData.foodY === snakeData.y) {
                    snakeData.maxCells++;
                    snakeData.score++;
                    document.getElementById('snakeScore').textContent = snakeData.score;
                    snakeData.foodX = snakeData.foodY = null;
                }
                
            }, snakeData.speed);
        }
        
        function gameOverSnake() {
            clearInterval(snakeInterval);
            if (snakeData.score) {
                saveSnakeScoreNow(); // –ê–í–¢–û–°–ê–í –ø—Ä–∏ Game Over!
                const high = Math.max(snakeData.score, parseInt(localStorage.getItem(`snakeHigh_${currentUser}`) || 0));
                localStorage.setItem(`snakeHigh_${currentUser}`, high);
                document.getElementById('snakeHigh').textContent = high;
                alert(`üí• GAME OVER!\n–°—á—ë—Ç: ${snakeData.score}\n–ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ –≤ —Ç–æ–ø –∏ —Ç—É—Ä–Ω–∏—Ä! üèÜ`);
            }
        }
        
        function saveSnakeScoreNow() {
            if (!snakeData.score || !currentUser) return;
            
            // –¢–æ–ø –ó–º–µ–π–∫–∞
            const snakeTops = JSON.parse(localStorage.getItem('snakeTops') || '[]');
            snakeTops.push({name: currentUser, score: snakeData.score, time: Date.now()});
            snakeTops.sort((a,b) => b.score - a.score);
            localStorage.setItem('snakeTops', JSON.stringify(snakeTops.slice(0,50))); // –¢–æ–ø-50
            
            // –¢—É—Ä–Ω–∏—Ä (—É–º–Ω–æ–∂–∞–µ–º –Ω–∞ —Å–ª–æ–∂–Ω–æ—Å—Ç—å)
            const tourScore = snakeData.score * (snakeData.diff || 1) * 10;
            updateTournamentScore(tourScore, '–ó–º–µ–π–∫–∞');
        }

        document.addEventListener('keydown', e => {
            if (!snakeInterval) return;
            switch(e.key) {
                case 'ArrowLeft': if (snakeData.dx !== 1) { snakeData.dx = -1; snakeData.dy = 0; } break;
                case 'ArrowUp': if (snakeData.dy !== 1) { snakeData.dx = 0; snakeData.dy = -1; } break;
                case 'ArrowRight': if (snakeData.dx !== -1) { snakeData.dx = 1; snakeData.dy = 0; } break;
                case 'ArrowDown': if (snakeData.dy !== -1) { snakeData.dx = 0; snakeData.dy = 1; } break;
            }
        });

        // –£–≥–∞–¥–∞–π–∫–∞
        function startGuess() {
            guessGame.max = parseInt(document.getElementById('guessDiff').value);
            guessGame.target = Math.floor(Math.random() * guessGame.max) + 1;
            guessGame.tries = 0;
            document.getElementById('guessRange').textContent = guessGame.max.toLocaleString();
            document.getElementById('guessTries').textContent = '0';
            document.getElementById('guessHint').innerHTML = 'üöÄ –ù–æ–≤–∞—è –∏–≥—Ä–∞ –Ω–∞—á–∞–ª–∞—Å—å!';
            document.getElementById('guessNum').value = '';
        }

        function checkGuess() {
            const guess = parseInt(document.getElementById('guessNum').value);
            if (!guess || guess < 1 || guess > guessGame.max) {
                document.getElementById('guessHint').innerHTML = '‚ùå –ß–∏—Å–ª–æ –≤–Ω–µ –¥–∏–∞–ø–∞–∑–æ–Ω–∞ 1-' + guessGame.max.toLocaleString();
                return;
            }
            
            guessGame.tries++;
            document.getElementById('guessTries').textContent = guessGame.tries;
            
            if (guess === guessGame.target) {
                const score = Math.max(1, 1000000 / guessGame.tries);
                document.getElementById('guessHint').innerHTML = 
                    `üéâ –£–ì–ê–î–ê–ù–û –∑–∞ ${guessGame.tries} –ø–æ–ø—ã—Ç–æ–∫! –û—á–∫–∏: ${score.toLocaleString()} ‚úÖ –ê–í–¢–û–°–ê–í!`;
                saveGuessScoreNow(); // –ê–í–¢–û–°–ê–í –ø—Ä–∏ —É–≥–∞–¥—ã–≤–∞–Ω–∏–∏!
            } else if (guess < guessGame.target) {
                document.getElementById('guessHint').innerHTML = 
                    `üìà –ë–æ–ª—å—à–µ —á–µ–º ${guess}! –û—Å—Ç–∞–ª–æ—Å—å: ${guessGame.target-guess} —á–∏—Å–µ–ª`;
            } else {
                document.getElementById('guessHint').innerHTML = 
                    `üìâ –ú–µ–Ω—å—à–µ —á–µ–º ${guess}! –û—Å—Ç–∞–ª–æ—Å—å: ${guess-guessGame.target} —á–∏—Å–µ–ª`;
            }
        }
        
        function saveGuessScoreNow() {
            if (!guessGame.tries || !currentUser) return;
            const score = Math.max(1, 1000000 / guessGame.tries);
            
            // –¢–æ–ø –£–≥–∞–¥–∞–π–∫–∞
            const guessTops = JSON.parse(localStorage.getItem('guessTops') || '[]');
            guessTops.push({name: currentUser, score: score, time: Date.now()});
            guessTops.sort((a,b) => b.score - a.score);
            localStorage.setItem('guessTops', JSON.stringify(guessTops.slice(0,50)));
            
            // –¢—É—Ä–Ω–∏—Ä
            const tourScore = score / 10;
            updateTournamentScore(tourScore, '–£–≥–∞–¥–∞–π–∫–∞');
        }

        // –¢—É—Ä–Ω–∏—Ä (–°–£–ú–ú–ò–†–û–í–ê–ù–ò–ï –æ—á–∫–æ–≤)
        function updateTournamentScore(score, game) {
            const data = JSON.parse(localStorage.getItem('globalData') || '{}');
            data.tournament = data.tournament || {};
            data.tournament[currentUser] = (data.tournament[currentUser] || 0) + score;
            
            // –ì–ª–æ–±–∞–ª—å–Ω—ã–π —Ç–æ–ø —Ç—É—Ä–Ω–∏—Ä–∞
            const tournamentEntries = Object.entries(data.tournament)
                .map(([name, score]) => ({name, score, game}))
                .sort((a,b) => b.score - a.score);
            data.tournamentTop = tournamentEntries;
            
            localStorage.setItem('globalData', JSON.stringify(data));
            document.getElementById('myTournamentScore').textContent = data.tournament[currentUser]?.toLocaleString() || 0;
        }

        // –ù–∞–≤–∏–≥–∞—Ü–∏—è
        function showGame(id) {
            if (!currentUser && id !== 'auth') {
                alert('üîê –°–Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏ –≤ –≥–∞–ª–∞–∫—Ç–∏–∫—É!');
                showGame('auth');
                return;
            }
            document.querySelectorAll('.game').forEach(g => g.classList.add('hidden'));
            document.getElementById(id).classList.remove('hidden');
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        window.onload = () => {
            createStars();
            
            // –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ —Ç–∞–π–º–µ—Ä–∞
            updateTimer();
            setInterval(updateTimer, 1000);
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            const savedUser = localStorage.getItem('user');
            if (savedUser) {
                currentUser = savedUser;
                document.getElementById('userInfo').innerHTML = `üë§ ${savedUser.toUpperCase()} | <button class="btn" onclick="logout()">üö™ –í—ã—Ö–æ–¥</button>`;
                document.getElementById('userInfo').classList.remove('hidden');
                document.getElementById('authBtn').style.display = 'none';
                loadAllData();
                showGame('tournaments');
            } else {
                showGame('auth');
            }
            
            // –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–æ–ø–æ–≤
            updateTops({
                snakeTop: JSON.parse(localStorage.getItem('snakeTops') || '[]'),
                guessTop: JSON.parse(localStorage.getItem('guessTops') || '[]')
            });
            
            // –ß–∞—Ç Enter
            document.getElementById('chatMsg').addEventListener('keypress', e => {
                if (e.key === 'Enter') sendChat();
            });
            
            // –§–æ–∫—É—Å –Ω–∞ –ø–æ–ª–µ –≤–≤–æ–¥–∞ –∏–º–µ–Ω–∏
            document.getElementById('username').focus();
        };
    </script>
</body>
</html>
