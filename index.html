<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>üöÄ ALEKSIN GAMES HUB v4.1 ‚úÖ –ú–û–ë–ê–ô–õ 100% | –ê–¥–º–∏–Ω</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap');
*{margin:0;padding:0;box-sizing:border-box}
html, body {
    height: 100%;
    overflow: hidden;
    touch-action: none;
}
body{font-family:'Orbitron',monospace;background:linear-gradient(135deg,#0a0a23 0%,#1a0a3a 50%,#0f0f4f 100%);color:#fff}
.container{max-width:1400px;margin:0 auto;padding:20px;height:100vh;overflow:hidden}
h1{font-size:clamp(2rem,5vw,4rem);text-align:center;background:linear-gradient(45deg,#ff00ff,#00ffff,#ffff00);background-size:300% 300%;-webkit-background-clip:text;-webkit-text-fill-color:transparent;animation:gradient 3s ease infinite}
@keyframes gradient{0%,100%{background-position:0% 50%}50%{background-position:100% 50%}}
.btn{display:inline-block;padding:12px 24px;background:linear-gradient(45deg,rgba(255,0,255,0.3),rgba(0,255,255,0.3));border:2px solid rgba(255,255,255,0.3);border-radius:15px;font-size:1rem;font-weight:700;cursor:pointer;transition:all 0.3s ease;margin:5px;box-shadow:0 8px 25px rgba(0,0,0,0.5);touch-action:manipulation}
.btn:hover{background:linear-gradient(45deg,rgba(255,0,255,0.6),rgba(0,255,255,0.6));transform:translateY(-3px);box-shadow:0 12px 35px rgba(255,0,255,0.4)}
.btn:active{transform:translateY(0)}
.section{display:none;text-align:center}
.section.active{display:block;animation:fadeIn 0.5s ease}
@keyframes fadeIn{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
.game-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:15px;margin:20px 0}
canvas{border:3px solid rgba(255,255,255,0.3);border-radius:15px;background:#000;box-shadow:0 0 30px rgba(0,255,255,0.5);touch-action:none}
table{width:100%;max-width:350px;margin:10px auto;border-collapse:collapse;background:rgba(255,255,255,0.1);border-radius:15px;overflow:hidden;box-shadow:0 10px 30px rgba(0,0,0,0.5)}
th,td{padding:10px;text-align:center;border-bottom:1px solid rgba(255,255,255,0.2)}
th{background:linear-gradient(45deg,rgba(255,0,255,0.4),rgba(0,255,255,0.4));font-weight:700}
.tour-table{background:rgba(0,255,0,0.2);margin:10px 0}
.tour-table h4{color:#00ff00;text-shadow:0 0 10px #00ff00}
#statusBar{position:fixed;top:10px;right:10px;background:rgba(0,255,0,0.3);padding:10px;border-radius:10px;font-weight:700;z-index:1000}
#logoutContainer{position:fixed;top:10px;left:10px;z-index:9999;background:rgba(0,0,0,0.8);padding:10px;border-radius:15px}
#logoutBtn{display:none}#logoutBtn.active{display:inline-block !important}
#authSection{position:relative;margin:40px auto;max-width:400px;background:rgba(0,0,0,0.9);padding:30px;border-radius:20px;box-shadow:0 0 50px rgba(255,0,255,0.5);display:none}
#authSection.active{display:block}
input{padding:12px;margin:10px;border:2px solid rgba(255,255,255,0.3);border-radius:10px;background:rgba(255,255,255,0.1);color:#fff;font-family:inherit;width:calc(100% - 24px)}
#tourTimer{font-size:2.5rem;color:#00ff00;text-shadow:0 0 20px #00ff00;animation:pulse 1s infinite}
@keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.05)}}
/* ‚úÖ –ú–û–ë–ê–ô–õ –§–ò–ö–°–´ */
@media (max-width: 768px) {
    .mobile-hide { display: none !important; }
    .container { padding: 10px; }
    canvas { width: 95vw !important; height: 50vh !important; max-width: 400px; max-height: 400px; }
    #statusBar, #logoutContainer { font-size: 0.8rem; padding: 5px; }
    .btn { padding: 10px 18px; font-size: 0.9rem; }
}
/* ‚úÖ –ó–ú–ï–ô–ö–ê: –î–ò–ù–ê–ú–ò–ß–ï–°–ö–ò–ô –°–ö–†–û–õ–õ */
body.snake-playing { overflow: hidden !important; touch-action: none !important; }
body.snake-stopped { overflow: auto !important; touch-action: auto !important; }
</style>
</head>
<body class="snake-stopped">
<div id="statusBar">üëã –ì–æ—Å—Ç—å</div>
<div id="logoutContainer">
<button class="btn mobile-hide" id="logoutBtn" onclick="logout()">üëã –í–´–ô–¢–ò</button>
</div>

<div class="container">
<div id="authSection" class="section active">
<h2>üîê –ê–¥–º–∏–Ω, –í—Ö–æ–¥ / –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h2>
<input type="text" id="usernameInput" placeholder="test" value="test">
<input type="password" id="passwordInput" placeholder="123456" value="123456">
<button class="btn" onclick="login()">üöÄ –í–û–ô–¢–ò</button>
<div class="daily-bonus" id="dailyBonus" style="display:none">
üéÅ <span id="dailyBonusText">–ï–ñ–ï–î–ù–ï–í–ù–´–ô –ë–û–ù–£–°: +50% –æ—á–∫–æ–≤!</span>
</div>
</div>

<h1>üöÄ ALEKSIN GAMES HUB v4.1 ‚úÖ –ú–û–ë–ê–ô–õ 100% | –ê–¥–º–∏–Ω</h1>

<div class="game-grid">
<button class="btn" onclick="showGame('leaderboards')">üèÜ –õ–ò–î–ï–†–ë–û–†–î–´</button>
<button class="btn" onclick="showGame('tournament')">‚öîÔ∏è –¢–£–†–ù–ò–†</button>
<button class="btn" onclick="showGame('chat')">üí¨ –ß–ê–¢</button>
<button class="btn" onclick="showGame('profile')">üë§ –ü–†–û–§–ò–õ–¨</button>
<button class="btn" onclick="showGame('snake')">üêç –ó–ú–ï–ô–ö–ê</button>
<button class="btn" onclick="showGame('guess')">üéØ –£–ì–ê–î–ê–ô</button>
</div>

<!-- –õ–ò–î–ï–†–ë–û–†–î–´ -->
<div id="leaderboardTables" class="section">
<h2>üèÜ –ì–õ–û–ë–ê–õ–¨–ù–´–ï –õ–ò–î–ï–†–ë–û–†–î–´</h2>
<div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:20px">
<table><thead><tr><th>üêç –ó–º–µ–π–∫–∞ –õ—ë–≥–∫–∞—è</th></tr></thead><tbody id="snakeEasyLB"></tbody></table>
<table><thead><tr><th>üêç –ó–º–µ–π–∫–∞ –°—Ä–µ–¥–Ω—è—è</th></tr></thead><tbody id="snakeNormalLB"></tbody></table>
<table><thead><tr><th>üêç –ó–º–µ–π–∫–∞ –°–ª–æ–∂–Ω–∞—è</th></tr></thead><tbody id="snakeHardLB"></tbody></table>
<table><thead><tr><th>üéØ –£–≥–∞–¥–∞–π–∫–∞ –õ—ë–≥–∫–∞—è</th></tr></thead><tbody id="guessEasyLB"></tbody></table>
</div>
</div>

<!-- –¢–£–†–ù–ò–† -->
<div id="tournamentSection" class="section">
<h2>‚öîÔ∏è –¢–£–†–ù–ò–† 24—á (00:00 –ú–°–ö)</h2>
<div>‚è∞ –î–æ –∫–æ–Ω—Ü–∞: <span id="tourTimer">07:36:00</span></div>
<div id="tournamentTables" style="display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:20px">
<table class="tour-table"><thead><tr><th>‚öîÔ∏è –¢–û–ü-100 –¢–£–†–ù–ò–†</th></tr></thead><tbody id="tournamentLB"></tbody></table>
</div>
</div>

<!-- –ß–ê–¢ -->
<div id="chatSection" class="section">
<h2>üí¨ –ì–õ–û–ë–ê–õ–¨–ù–´–ô –ß–ê–¢</h2>
<div id="chatMessages" style="height:300px;overflow-y:auto;border:2px solid #00ff00;margin:10px auto;padding:15px;background:rgba(0,0,0,0.7);border-radius:15px;max-width:500px;font-size:0.9rem"></div>
<input id="chatInput" placeholder="–ù–∞–ø–∏—à–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ... (Enter)" style="width:70%;max-width:350px">
<button class="btn" onclick="sendMessage()">üì§ –û–¢–ü–†–ê–í–ò–¢–¨</button>
<button class="btn" onclick="clearChat()">üóëÔ∏è –û–ß–ò–°–¢–ò–¢–¨</button>
</div>

<!-- –ü–†–û–§–ò–õ–¨ -->
<div id="profileSection" class="section">
<h2>üë§ –ü–†–û–§–ò–õ–¨ <span id="profileUsername"></span></h2>
<div class="profile-stats">
<div>üèÜ –¢–æ—Ç–∞–ª –æ—á–∫–æ–≤: <span id="totalScore">0</span></div>
<div>‚öîÔ∏è –õ–∏–≥–∞: <span id="leagueBadge" class="league-badge bronze">–ë–†–û–ù–ó–ê</span></div>
<div>üéÆ –ü–æ–±–µ–¥: <span id="totalWins">0</span> | üíÄ –ü–æ—Ä–∞–∂–µ–Ω–∏–π: <span id="totalLosses">0</span></div>
<div>üìä –í–∏–Ω—Ä–µ–π—Ç: <span id="winrate">0%</span></div>
</div>
<h3>üèÖ –î–û–°–¢–ò–ñ–ï–ù–ò–Ø</h3>
<div id="achievements" style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:10px"></div>
</div>

<!-- –ó–ú–ï–ô–ö–ê -->
<div id="snakeSection" class="section">
<h2>üêç –ó–ú–ï–ô–ö–ê PRO</h2>
<div class="game-grid">
<button class="btn" onclick="startSnake('easy')">–õ—ë–≥–∫–∞—è</button>
<button class="btn" onclick="startSnake('normal')">–°—Ä–µ–¥–Ω—è—è</button>
<button class="btn" onclick="startSnake('hard')">–°–ª–æ–∂–Ω–∞—è</button>
</div>
<div style="position:relative;display:inline-block">
<canvas id="gameCanvas" width="400" height="400" tabindex="0"></canvas>
<div id="snakeScore" style="position:absolute;top:10px;left:10px;font-size:1.5rem;font-weight:700;color:#00ff00">–°—á—ë—Ç: 0</div>
</div>
<button class="btn mobile-hide" onclick="toggleSnakePause()">‚è∏Ô∏è –ü–ê–£–ó–ê</button>
</div>

<!-- –£–ì–ê–î–ê–ô–ö–ê -->
<div id="guessSection" class="section">
<h2>üéØ –£–ì–ê–î–ê–ô –ß–ò–°–õ–û</h2>
<div class="game-grid">
<button class="btn" onclick="setDifficulty('guess','easy')">–õ—ë–≥–∫–∞—è (1-1K)</button>
<button class="btn" onclick="setDifficulty('guess','normal')">–°—Ä–µ–¥–Ω—è—è (1-10K)</button>
<button class="btn" onclick="setDifficulty('guess','hard')">–°–ª–æ–∂–Ω–∞—è (1-100K)</button>
</div>
<div style="font-size:2rem;margin:20px">–ß–∏—Å–ª–æ –æ—Ç <span id="rangeMin">1</span> –¥–æ <span id="rangeMax">1000</span></div>
<input type="number" id="guessInput" placeholder="–¢–≤–æ—ë —á–∏—Å–ª–æ">
<button class="btn" onclick="makeGuess()">–£–ì–ê–î–ê–¢–¨</button>
<div id="guessResult"></div>
<div id="guessAttempts">–ü–æ–ø—ã—Ç–æ–∫: 0</div>
</div>

<div id="achievementPopup" class="achievement"></div>
</div>

<script>
// –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï
let currentUser = localStorage.getItem('aleksinUser') || null;
let leaderboards = JSON.parse(localStorage.getItem('aleksinLeaderboards')) || {};
let tournamentScores = JSON.parse(localStorage.getItem('aleksinTournaments')) || {};
let chatMessages = JSON.parse(localStorage.getItem('aleksinChat')) || [];
let achievements = JSON.parse(localStorage.getItem('aleksinAchievements')) || {};
let stats = JSON.parse(localStorage.getItem('aleksinStats')) || {};
let dailyBonusClaimed = localStorage.getItem('dailyBonus') === new Date().toDateString();

// –ó–ú–ï–ô–ö–ê
let snake = [{x:10,y:10}], snakeDirection = {x:1,y:0}, snakeScore = 0, gameRunning = false, food = {}, snakeInterval = null;
let currentSnakeDifficulty = 'easy', speeds = {easy:200, normal:150, hard:100};
let snakeRunning = false;

// –£–ì–ê–î–ê–ô–ö–ê
let currentGameType = '', currentDifficulty = '', secretNumber, guessCount = 0;

// –ó–í–£–ö–ò
let audioContext = new (window.AudioContext || window.webkitAudioContext)();

// ‚úÖ –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø
document.addEventListener('DOMContentLoaded', function() {
    if (currentUser) {
        document.getElementById('statusBar').textContent = `üëã ${currentUser}`;
        document.getElementById('logoutBtn').classList.add('active');
    }
    setInterval(updateTournament, 1000);
    window.addEventListener('beforeunload', saveAllData);
    updateChat();
    loadProfile();
    updateLeaderboards();
    
    // ‚úÖ –ë–õ–û–ö–ò–†–£–ï–ú –ü–†–û–ú–ê–¢–´–í–ê–ù–ò–ï –ù–ê –í–°–ï–• –ö–ù–û–ü–ö–ê–•
    document.querySelectorAll('.btn').forEach(btn => {
        btn.addEventListener('touchstart', (e) => e.preventDefault(), { passive: false });
        btn.addEventListener('touchmove', (e) => e.preventDefault(), { passive: false });
    });
});

// ‚úÖ –û–°–ù–û–í–ù–´–ï –§–£–ù–ö–¶–ò–ò
function saveAllData() {
    localStorage.setItem('aleksinUser', currentUser);
    localStorage.setItem('aleksinLeaderboards', JSON.stringify(leaderboards));
    localStorage.setItem('aleksinTournaments', JSON.stringify(tournamentScores));
    localStorage.setItem('aleksinChat', JSON.stringify(chatMessages.slice(-500)));
    localStorage.setItem('aleksinAchievements', JSON.stringify(achievements));
    localStorage.setItem('aleksinStats', JSON.stringify(stats));
}

function login() {
    const username = document.getElementById('usernameInput').value.trim();
    const password = document.getElementById('passwordInput').value;
    if (username && password) {
        currentUser = username;
        stats[currentUser] = stats[currentUser] || {wins:0, losses:0, total:0};
        document.getElementById('statusBar').textContent = `üëã ${currentUser}`;
        document.getElementById('logoutBtn').classList.add('active');
        document.getElementById('authSection').classList.remove('active');
        saveAllData();
        loadProfile();
        playSound('login');
        showAchievement('firstLogin');
    }
}

function logout() {
    if (snakeInterval) clearInterval(snakeInterval);
    gameRunning = false; snakeRunning = false; snake = []; snakeScore = 0;
    document.body.classList.remove('snake-playing');
    document.body.classList.add('snake-stopped');
    currentUser = null;
    document.getElementById('statusBar').textContent = 'üëã –ì–æ—Å—Ç—å';
    document.getElementById('logoutBtn').classList.remove('active');
    document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
    document.getElementById('authSection').classList.add('active');
    saveAllData();
}

// ‚úÖ –ù–ê–í–ò–ì–ê–¶–ò–Ø
function showGame(game) {
    document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
    if (game === 'snake') document.getElementById('snakeSection').classList.add('active');
    else if (game === 'guess') document.getElementById('guessSection').classList.add('active');
    else if (game === 'chat') document.getElementById('chatSection').classList.add('active');
    else if (game === 'profile') document.getElementById('profileSection').classList.add('active');
    else if (game === 'tournament') document.getElementById('tournamentSection').classList.add('active');
    else if (game === 'leaderboards') {
        document.getElementById('leaderboardTables').classList.add('active');
        updateLeaderboards();
    }
}

// ‚úÖ –ó–ú–ï–ô–ö–ê v4.1 –ú–û–ë–ê–ô–õ
function startSnake(difficulty) {
    if (!currentUser) { alert('üîê –ê–¥–º–∏–Ω, –≤–æ–π–¥–∏ —Å–Ω–∞—á–∞–ª–∞!'); return; }
    
    currentSnakeDifficulty = difficulty;
    snakeRunning = true;
    document.body.classList.remove('snake-stopped');
    document.body.classList.add('snake-playing');
    
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    canvas.width = Math.min(400, window.innerWidth * 0.9);
    canvas.height = canvas.width;
    const gridSize = canvas.width / 20;
    
    snake = [{x:10,y:10}];
    snakeDirection = {x:1,y:0};
    snakeScore = 0;
    gameRunning = true;
    
    function generateFood() {
        food = {
            x: Math.floor(Math.random() * 20),
            y: Math.floor(Math.random() * 20)
        };
    }
    generateFood();
    
    function gameLoop() {
        if (!gameRunning) return;
        
        ctx.fillStyle = '#000';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        
        // –î–≤–∏–∂–µ–Ω–∏–µ –∑–º–µ–π–∫–∏
        const head = {x: snake[0].x + snakeDirection.x, y: snake[0].y + snakeDirection.y};
        
        // –°—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏—è
        if (head.x < 0 || head.x >= 20 || head.y < 0 || head.y >= 20 || 
            snake.find(s => s.x === head.x && s.y === head.y)) {
            gameOver();
            return;
        }
        
        snake.unshift(head);
        
        // –ï–¥–∞
        if (head.x === food.x && head.y === food.y) {
            snakeScore += 100;
            playSound('eat');
            generateFood();
            showAchievement('snakeMaster');
        } else {
            snake.pop();
        }
        
        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞
        ctx.fillStyle = '#00ff00';
        snake.forEach((segment, i) => {
            ctx.fillStyle = i === 0 ? '#ff00ff' : '#00ff00';
            ctx.fillRect(segment.x * gridSize, segment.y * gridSize, gridSize-2, gridSize-2);
        });
        
        ctx.fillStyle = '#ff0000';
        ctx.fillRect(food.x * gridSize, food.y * gridSize, gridSize-2, gridSize-2);
        
        document.getElementById('snakeScore').textContent = `–°—á—ë—Ç: ${snakeScore}`;
    }
    
    gameLoop();
    snakeInterval = setInterval(gameLoop, speeds[difficulty]);
    
    // ‚úÖ –ö–õ–ê–í–ò–ê–¢–£–†–ê
    document.addEventListener('keydown', (e) => {
        e.preventDefault();
        if (e.key === 'ArrowUp' && snakeDirection.y !== 1) snakeDirection = {x:0,y:-1};
        if (e.key === 'ArrowDown' && snakeDirection.y !== -1) snakeDirection = {x:0,y:1};
        if (e.key === 'ArrowLeft' && snakeDirection.x !== 1) snakeDirection = {x:-1,y:0};
        if (e.key === 'ArrowRight' && snakeDirection.x !== -1) snakeDirection = {x:1,y:0};
    });
    
    // ‚úÖ –°–í–ê–ô–ü–´ –ú–û–ë–ê–ô–õ
    let touchStartX, touchStartY;
    canvas.addEventListener('touchstart', (e) => {
        e.preventDefault();
        touchStartX = e.touches[0].clientX;
        touchStartY = e.touches[0].clientY;
    });
    canvas.addEventListener('touchend', (e) => {
        e.preventDefault();
        const touchEndX = e.changedTouches[0].clientX;
        const touchEndY = e.changedTouches[0].clientY;
        const diffX = touchStartX - touchEndX;
        const diffY = touchStartY - touchEndY;
        
        if (Math.abs(diffX) > Math.abs(diffY) && Math.abs(diffX) > 30) {
            if (diffX > 0 && snakeDirection.x !== 1) snakeDirection = {x:-1,y:0};
            else if (diffX < 0 && snakeDirection.x !== -1) snakeDirection = {x:1,y:0};
        } else if (Math.abs(diffY) > 30) {
            if (diffY > 0 && snakeDirection.y !== 1) snakeDirection = {x:0,y:-1};
            else if (diffY < 0 && snakeDirection.y !== -1) snakeDirection = {x:0,y:1};
        }
    });
}

function gameOver() {
    document.body.classList.remove('snake-playing');
    document.body.classList.add('snake-stopped');
    snakeRunning = false;
    clearInterval(snakeInterval);
    
    if (snakeScore > 0 && currentUser) {
        leaderboards.snake = leaderboards.snake || {};
        leaderboards.snake[currentSnakeDifficulty] = leaderboards.snake[currentSnakeDifficulty] || {};
        leaderboards.snake[currentSnakeDifficulty][currentUser] = Math.max(
            leaderboards.snake[currentSnakeDifficulty][currentUser] || 0, snakeScore
        );
        saveScore('snake', snakeScore);
        updateLeaderboards();
    }
    
    alert(`Game Over, –ê–¥–º–∏–Ω! –°—á—ë—Ç: ${snakeScore}`);
}

function toggleSnakePause() {
    gameRunning = !gameRunning;
}

// ‚úÖ –£–ì–ê–î–ê–ô–ö–ê
function setDifficulty(game, diff) {
    currentGameType = game;
    currentDifficulty = diff;
    const ranges = {easy:1000, normal:10000, hard:100000};
    secretNumber = Math.floor(Math.random() * ranges[diff]) + 1;
    guessCount = 0;
    document.getElementById('rangeMin').textContent = 1;
    document.getElementById('rangeMax').textContent = ranges[diff];
    document.getElementById('guessResult').textContent = '';
    document.getElementById('guessAttempts').textContent = '–ü–æ–ø—ã—Ç–æ–∫: 0';
}

function makeGuess() {
    if (!currentUser) { alert('üîê –ê–¥–º–∏–Ω, –≤–æ–π–¥–∏ —Å–Ω–∞—á–∞–ª–∞!'); return; }
    const guess = parseInt(document.getElementById('guessInput').value);
    guessCount++;
    
    if (guess === secretNumber) {
        const attempts = guessCount <= 5 ? guessCount : '–ú–Ω–æ–≥–æ';
        document.getElementById('guessResult').innerHTML = `‚úÖ –£–≥–∞–¥–∞–ª –∑–∞ ${attempts} –ø–æ–ø—ã—Ç–æ–∫!`;
        stats[currentUser].wins = (stats[currentUser].wins || 0) + 1;
        saveScore('guess', 1000 / guessCount);
        showAchievement('guessPro');
    } else {
        let hint = guess < secretNumber ? 'üìà –ë–æ–ª—å—à–µ' : 'üìâ –ú–µ–Ω—å—à–µ';
        const diff = Math.abs(guess - secretNumber);
        if (diff <= 10) hint += ' (–û–ß–ï–ù–¨ –±–ª–∏–∑–∫–æ!)';
        else if (diff <= 50) hint += ' (–±–ª–∏–∑–∫–æ)';
        document.getElementById('guessResult').textContent = hint;
        stats[currentUser].losses = (stats[currentUser].losses || 0) + 1;
    }
    
    document.getElementById('guessAttempts').textContent = `–ü–æ–ø—ã—Ç–æ–∫: ${guessCount}`;
    document.getElementById('guessInput').value = '';
    saveAllData();
}

// ‚úÖ –õ–ò–î–ï–†–ë–û–†–î–´
function updateLeaderboards() {
    const lbs = ['snakeEasyLB', 'snakeNormalLB', 'snakeHardLB', 'guessEasyLB'];
    lbs.forEach(id => {
        const table = document.getElementById(id);
        const game = id.replace('LB', '');
        const data = leaderboards.snake?.[game.replace('snake', 'easy')];
        
        if (!data || Object.keys(data).length === 0) {
            table.innerHTML = '<tr><td>üëë –ë–£–î–¨ –ü–ï–†–í–´–ú!</td></tr>';
            return;
        }
        
        const sorted = Object.entries(data)
            .sort(([,a], [,b]) => b - a)
            .slice(0, 10);
            
        table.innerHTML = sorted.map(([user, score], i) =>
            `<tr><td>${i+1}. ${user}: ${score}</td></tr>`
        ).join('');
    });
}

function saveScore(game, score) {
    if (!currentUser) return;
    leaderboards[game] = leaderboards[game] || {};
    leaderboards[game][currentDifficulty] = leaderboards[game][currentDifficulty] || {};
    leaderboards[game][currentDifficulty][currentUser] = Math.max(
        leaderboards[game][currentDifficulty][currentUser] || 0, score
    );
    saveAllData();
    loadProfile();
}

// ‚úÖ –ß–ê–¢
function sendMessage() {
    const msg = document.getElementById('chatInput').value.trim();
    if (msg && currentUser) {
        chatMessages.push({user: currentUser, msg: msg, time: new Date().toLocaleTimeString(), id: Date.now()});
        document.getElementById('chatInput').value = '';
        updateChat();
        playSound('chat');
    }
}

function updateChat() {
    const chat = document.getElementById('chatMessages');
    chat.innerHTML = chatMessages.slice(-50).map(m =>
        `<div><strong>${m.user}</strong> <small>${m.time}</small><br>${m.msg}</div>`
    ).join('');
    chat.scrollTop = chat.scrollHeight;
    localStorage.setItem('aleksinChat', JSON.stringify(chatMessages));
}

function clearChat() {
    chatMessages = [];
    updateChat();
}

// ‚úÖ –¢–£–†–ù–ò–† MSK
function updateTournament() {
    const now = new Date();
    const mskTime = new Date(now.toLocaleString("en-US", {timeZone: "Europe/Moscow"}));
    const nextMidnight = new Date(mskTime.getFullYear(), mskTime.getMonth(), mskTime.getDate() + 1, 0, 0, 0);
    const timeLeft = nextMidnight - mskTime;

    const hours = Math.floor(timeLeft / (1000*60*60)).toString().padStart(2,'0');
    const minutes = Math.floor((timeLeft % (1000*60*60)) / (1000*60)).toString().padStart(2,'0');
    const seconds = Math.floor((timeLeft % (1000*60)) / 1000).toString().padStart(2,'0');
    document.getElementById('tourTimer').textContent = `${hours}:${minutes}:${seconds}`;
}

// ‚úÖ –ü–†–û–§–ò–õ–¨
function loadProfile() {
    if (!currentUser) return;
    const userStats = stats[currentUser] || {wins:0, losses:0, total:0};
    
    document.getElementById('profileUsername').textContent = currentUser;
    document.getElementById('totalWins').textContent = userStats.wins || 0;
    document.getElementById('totalLosses').textContent = userStats.losses || 0;
    document.getElementById('winrate').textContent = userStats.wins ? Math.round((userStats.wins/(userStats.wins+userStats.losses))*100) : 0 + '%';
    
    const total = Object.values(leaderboards).flatMap(lb => Object.values(lb)).reduce((sum, lb) => 
        sum + (lb[currentUser] || 0), 0);
    document.getElementById('totalScore').textContent = total;
    
    const league = total > 10000 ? 'gold' : total > 1000 ? 'silver' : 'bronze';
    document.getElementById('leagueBadge').textContent = league.toUpperCase();
    document.getElementById('leagueBadge').className = `league-badge ${league}`;
    
    updateAchievements();
}

function updateAchievements() {
    const achList = document.getElementById('achievements');
    const achDefs = {
        firstLogin: 'üéâ –ü–µ—Ä–≤—ã–π –≤—Ö–æ–¥',
        snakeMaster: 'üêç –ú–∞—Å—Ç–µ—Ä –ó–º–µ–π–∫–∏ (1000+ –æ—á–∫–æ–≤)',
        guessPro: 'üéØ –ü—Ä–æ—Ñ–∏ –£–≥–∞–¥–∞–π–∫–∏ (—Ä–µ—à–µ–Ω–∏–µ –∑–∞ 5 –ø–æ–ø—ã—Ç–æ–∫)',
        chatty: 'üí¨ –ë–æ–ª—Ç—É–Ω (50+ —Å–æ–æ–±—â–µ–Ω–∏–π)'
    };
    achList.innerHTML = Object.entries(achDefs).map(([id, name]) =>
        `<div style="background:rgba(255,255,255,0.1);padding:10px;border-radius:10px">
            ${achievements[currentUser]?.[id] ? '‚úÖ' : 'üîí'} ${name}
        </div>`
    ).join('');
}

function showAchievement(id) {
    if (!currentUser || achievements[currentUser]?.[id]) return;
    achievements[currentUser] = achievements[currentUser] || {};
    achievements[currentUser][id] = true;
    saveAllData();
}

// ‚úÖ –ó–í–£–ö–ò
function playSound(type) {
    try {
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        const oscillator = audioCtx.createOscillator();
        const gainNode = audioCtx.createGain();
        oscillator.connect(gainNode);
        gainNode.connect(audioCtx.destination);

        const frequencies = {eat:800, login:523, chat:659};
        oscillator.frequency.setValueAtTime(frequencies[type] || 440, audioCtx.currentTime);
        gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime);

        oscillator.start();
        gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.2);
        oscillator.stop(audioCtx.currentTime + 0.2);
    } catch(e) {}
}

function toggleFullscreen() {
    if (!document.fullscreenElement) document.documentElement.requestFullscreen();
    else document.exitFullscreen();
}
</script>
</body>
</html>
