<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸš€ ALEKSIN GAMES v5.2 âœ… Ğ‘Ğ•Ğ— Ğ Ğ•Ğ“Ğ˜Ğ¡Ğ¢Ğ ĞĞ¦Ğ˜Ğ˜</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap');
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Orbitron',monospace;background:linear-gradient(135deg,#0a0a23 0%,#1a0a3a 50%,#0f0f4f 100%);color:#fff;min-height:100vh;overflow-y:auto;padding:20px}
.container{max-width:1400px;margin:0 auto}
h1{font-size:clamp(2rem,5vw,4rem);text-align:center;background:linear-gradient(45deg,#ff00ff,#00ffff,#ffff00);background-size:300% 300%;-webkit-background-clip:text;-webkit-text-fill-color:transparent;animation:gradient 3s ease infinite}
@keyframes gradient{0%,100%{background-position:0% 50%}50%{background-position:100% 50%}}
.btn{display:inline-block;padding:12px 24px;background:linear-gradient(45deg,rgba(255,0,255,0.3),rgba(0,255,255,0.3));border:2px solid rgba(255,255,255,0.3);border-radius:15px;font-weight:700;cursor:pointer;transition:all 0.3s ease;margin:5px}
.btn:hover{transform:translateY(-3px);box-shadow:0 12px 35px rgba(255,0,255,0.4)}
.section{display:none;text-align:center}
.section.active{display:block}
.game-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:15px;margin:20px 0}
canvas{border:3px solid rgba(255,255,255,0.3);border-radius:15px;background:#000;display:block;margin:10px auto;max-width:100%}
table{width:100%;max-width:400px;margin:10px auto;border-collapse:collapse;background:rgba(255,255,255,0.1);border-radius:15px}
th,td{padding:12px;text-align:center;border-bottom:1px solid rgba(255,255,255,0.2)}
th{background:linear-gradient(45deg,rgba(255,0,255,0.4),rgba(0,255,255,0.4))}
.tour-table{background:rgba(0,255,0,0.3)}
#statusBar{position:fixed;top:10px;right:10px;background:rgba(0,255,0,0.3);padding:10px;border-radius:10px;z-index:1000}
#chatMessages{height:300px;overflow-y:auto;border:2px solid #00ff00;margin:10px auto;padding:15px;background:rgba(0,0,0,0.7);border-radius:15px;max-width:500px}
input{padding:12px;border:2px solid rgba(255,255,255,0.3);border-radius:10px;background:rgba(255,255,255,0.1);color:#fff;font-family:inherit;font-size:16px}
@media (max-width:768px){.container{padding:10px}.btn{padding:10px 18px;font-size:0.9rem}}
</style>
</head>
<body>
<div id="statusBar">ğŸš€ v5.2 - Ğ˜Ğ“Ğ ĞĞ™ Ğ‘Ğ•Ğ— Ğ Ğ•Ğ“Ğ˜Ğ¡Ğ¢Ğ ĞĞ¦Ğ˜Ğ˜!</div>

<div class="container">
<h1>ğŸš€ ALEKSIN GAMES v5.2 âœ… Ğ ĞĞ‘ĞĞ¢ĞĞ•Ğ¢!</h1>

<div class="game-grid">
<button class="btn" onclick="showGame('leaderboards')">ğŸ† Ğ›Ğ˜Ğ”Ğ•Ğ Ğ‘ĞĞ Ğ”Ğ«</button>
<button class="btn" onclick="showGame('tournament')">âš”ï¸ Ğ¢Ğ£Ğ ĞĞ˜Ğ </button>
<button class="btn" onclick="showGame('chat')">ğŸ’¬ Ğ§ĞĞ¢</button>
<button class="btn" onclick="showGame('snake')">ğŸ Ğ—ĞœĞ•Ğ™ĞšĞ</button>
<button class="btn" onclick="showGame('guess')">ğŸ¯ Ğ£Ğ“ĞĞ”ĞĞ™</button>
</div>

<div id="leaderboardTables" class="section">
<h2>ğŸ† Ğ¢ĞĞŸ-10</h2>
<div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:20px">
<table><thead><tr><th>ğŸ Ğ›Ñ‘Ğ³ĞºĞ°Ñ</th></tr></thead><tbody id="snakeEasyLB"></tbody></table>
<table><thead><tr><th>ğŸ Ğ¡Ñ€ĞµĞ´Ğ½ÑÑ</th></tr></thead><tbody id="snakeNormalLB"></tbody></table>
<table><thead><tr><th>ğŸ Ğ¡Ğ»Ğ¾Ğ¶Ğ½Ğ°Ñ</th></tr></thead><tbody id="snakeHardLB"></tbody></table>
<table><thead><tr><th>ğŸ¯ Ğ›Ñ‘Ğ³ĞºĞ°Ñ</th></tr></thead><tbody id="guessEasyLB"></tbody></table>
</div>
</div>

<div id="tournamentSection" class="section">
<h2>âš”ï¸ Ğ¢Ğ£Ğ ĞĞ˜Ğ  24Ñ‡</h2>
<div style="font-size:1.5rem">â° <span id="tourTimer">--:--</span></div>
<table class="tour-table"><thead><tr><th>#</th><th>Ğ˜Ğ“Ğ ĞĞš</th><th>ĞĞ§ĞšĞ˜</th></tr></thead><tbody id="tournamentLB"></tbody></table>
<button class="btn" onclick="resetTournament()">ğŸ”„ Ğ¡Ğ‘Ğ ĞĞ¡Ğ˜Ğ¢Ğ¬</button>
</div>

<div id="chatSection" class="section">
<h2>ğŸ’¬ Ğ“Ğ›ĞĞ‘ĞĞ›Ğ¬ĞĞ«Ğ™ Ğ§ĞĞ¢</h2>
<div id="chatMessages"></div>
<div style="margin:20px">
<input id="chatInput" placeholder="ĞĞ°Ğ¿Ğ¸ÑˆĞ¸..." style="width:60%">
<button class="btn" onclick="sendMessage()">ğŸ“¤</button>
</div>
</div>

<div id="snakeSection" class="section">
<h2>ğŸ Ğ—ĞœĞ•Ğ™ĞšĞ</h2>
<div class="game-grid">
<button class="btn" onclick="startSnake('easy')">Ğ›Ñ‘Ğ³ĞºĞ°Ñ</button>
<button class="btn" onclick="startSnake('normal')">Ğ¡Ñ€ĞµĞ´Ğ½ÑÑ</button>
<button class="btn" onclick="startSnake('hard')">Ğ¡Ğ»Ğ¾Ğ¶Ğ½Ğ°Ñ</button>
</div>
<canvas id="gameCanvas" width="400" height="400" style="position:relative;display:block;margin:10px auto"></canvas>
<div id="snakeScore" style="position:absolute;top:10px;left:10px;font-size:1.5rem;color:#00ff00;font-weight:700;background:rgba(0,0,0,0.7);padding:5px">Ğ¡Ñ‡Ñ‘Ñ‚: 0</div>
<button class="btn" onclick="stopSnake()" style="position:absolute;top:10px;right:10px">â¹ï¸</button>
</div>

<div id="guessSection" class="section">
<h2>ğŸ¯ Ğ£Ğ“ĞĞ”ĞĞ™ Ğ§Ğ˜Ğ¡Ğ›Ğ</h2>
<div class="game-grid">
<button class="btn" onclick="setDifficulty('easy')">Ğ›Ñ‘Ğ³ĞºĞ°Ñ (1-1000)</button>
<button class="btn" onclick="setDifficulty('normal')">Ğ¡Ñ€ĞµĞ´Ğ½ÑÑ (1-10000)</button>
<button class="btn" onclick="setDifficulty('hard')">Ğ¡Ğ»Ğ¾Ğ¶Ğ½Ğ°Ñ (1-100000)</button>
</div>
<div style="font-size:2rem;margin:20px">Ğ§Ğ¸ÑĞ»Ğ¾ Ğ¾Ñ‚ 1 Ğ´Ğ¾ <span id="rangeMax">1000</span></div>
<input type="number" id="guessInput" placeholder="Ğ¢Ğ²Ğ¾Ñ‘ Ñ‡Ğ¸ÑĞ»Ğ¾" style="width:200px">
<button class="btn" onclick="makeGuess()">ğŸ” Ğ£Ğ“ĞĞ”ĞĞ¢Ğ¬</button>
<div id="guessResult" style="font-size:1.5rem;margin:20px"></div>
<div id="guessAttempts">ĞŸĞ¾Ğ¿Ñ‹Ñ‚Ğ¾Ğº: 0</div>
</div>
</div>

<script>
let snake = [{x:10,y:10}], snakeDir = {x:1,y:0}, snakeScore = 0, snakeRunning = false, snakeInterval;
let currentSnakeDiff = 'easy', speeds = {easy:200, normal:150, hard:100};
let secretNumber, guessCount = 0, currentGuessDiff = 'easy';
const ranges = {easy:1000, normal:10000, hard:100000};

async function api(endpoint, options = {}) {
    try {
        const res = await fetch('/api' + endpoint, {
            method: options.method || 'GET',
            headers: {'Content-Type': 'application/json'},
            body: options.body
        });
        return await res.json();
    } catch {
        return {error: 'Ğ¡ĞµÑ€Ğ²ĞµÑ€ Ğ½ĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½'};
    }
}

function showGame(game) {
    document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
    document.getElementById(game + 'Section' || 'leaderboardTables').classList.add('active');
    if (game === 'leaderboards') updateLeaderboards();
    if (game === 'tournament') updateTournamentTable();
    if (game === 'chat') updateChat();
}

async function startSnake(diff) {
    currentSnakeDiff = diff;
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const grid = 20;
    
    snake = [{x:10,y:10}]; snakeDir = {x:1,y:0}; snakeScore = 0; snakeRunning = true;
    let food = {x:Math.floor(Math.random()*19), y:Math.floor(Math.random()*19)};
    
    function gameLoop() {
        if (!snakeRunning) return;
        ctx.fillStyle = '#000'; ctx.fillRect(0,0,400,400);
        
        const head = {x:snake[0].x + snakeDir.x, y:snake[0].y + snakeDir.y};
        if (head.x < 0 || head.x > 19 || head.y < 0 || head.y > 19 || snake.some(s => s.x === head.x && s.y === head.y)) {
            gameOver(); return;
        }
        
        snake.unshift(head);
        if (head.x === food.x && head.y === food.y) {
            snakeScore += 100;
            food = {x:Math.floor(Math.random()*19), y:Math.floor(Math.random()*19)};
        } else snake.pop();
        
        snake.forEach((s,i) => {
            ctx.fillStyle = i === 0 ? '#ff00ff' : '#00ff00';
            ctx.fillRect(s.x*grid, s.y*grid, grid-2, grid-2);
        });
        ctx.fillStyle = '#ff0000';
        ctx.fillRect(food.x*grid, food.y*grid, grid-2, grid-2);
        
        document.getElementById('snakeScore').textContent = `Ğ¡Ñ‡Ñ‘Ñ‚: ${snakeScore}`;
    }
    
    // Touch controls
    let touchStart = {x:0,y:0};
    canvas.ontouchstart = e => touchStart = {x:e.touches[0].clientX, y:e.touches[0].clientY};
    canvas.ontouchend = e => {
        const dx = touchStart.x - e.changedTouches[0].clientX;
        const dy = touchStart.y - e.changedTouches[0].clientY;
        if (Math.abs(dx) > Math.abs(dy) && Math.abs(dx) > 30) {
            snakeDir = dx > 0 && snakeDir.x !== 1 ? {x:-1,y:0} : dx < 0 && snakeDir.x !== -1 ? {x:1,y:0} : snakeDir;
        } else if (Math.abs(dy) > 30) {
            snakeDir = dy > 0 && snakeDir.y !== 1 ? {x:0,y:-1} : dy < 0 && snakeDir.y !== -1 ? {x:0,y:1} : snakeDir;
        }
    };
    
    canvas.onkeydown = e => {
        if (e.key === 'ArrowUp' && snakeDir.y !== 1) snakeDir = {x:0,y:-1};
        if (e.key === 'ArrowDown' && snakeDir.y !== -1) snakeDir = {x:0,y:1};
        if (e.key === 'ArrowLeft' && snakeDir.x !== 1) snakeDir = {x:-1,y:0};
        if (e.key === 'ArrowRight' && snakeDir.x !== -1) snakeDir = {x:1,y:0};
    };
    
    gameLoop();
    snakeInterval = setInterval(gameLoop, speeds[diff]);
}

function stopSnake() { snakeRunning = false; if (snakeInterval) clearInterval(snakeInterval); }

async function gameOver() {
    snakeRunning = false; if (snakeInterval) clearInterval(snakeInterval);
    if (snakeScore > 0) {
        await api('/scores', {method: 'POST', body: JSON.stringify({game: 'snake', difficulty: currentSnakeDiff, score: snakeScore})});
        await api('/tournament', {method: 'POST', body: JSON.stringify({score: snakeScore})});
        updateLeaderboards(); updateTournamentTable();
    }
    alert(`ğŸ® ${snakeScore} Ğ¾Ñ‡ĞºĞ¾Ğ²!`);
}

function setDifficulty(diff) {
    currentGuessDiff = diff; secretNumber = Math.floor(Math.random() * ranges[diff]) + 1;
    guessCount = 0; document.getElementById('rangeMax').textContent = ranges[diff];
    document.getElementById('guessResult').textContent = ''; document.getElementById('guessAttempts').textContent = 'ĞŸĞ¾Ğ¿Ñ‹Ñ‚Ğ¾Ğº: 0';
}

async function makeGuess() {
    const guess = parseInt(document.getElementById('guessInput').value);
    if (!guess) return alert('Ğ’Ğ²ĞµĞ´Ğ¸ Ñ‡Ğ¸ÑĞ»Ğ¾!');
    
    guessCount++;
    if (guess === secretNumber) {
        const score = Math.max(1000 - guessCount * 100, 100);
        document.getElementById('guessResult').innerHTML = `âœ… +${score} Ğ¾Ñ‡ĞºĞ¾Ğ²!`;
        await api('/scores', {method: 'POST', body: JSON.stringify({game: 'guess', difficulty: currentGuessDiff, score: score})});
        await api('/tournament', {method: 'POST', body: JSON.stringify({score: score})});
        updateLeaderboards(); updateTournamentTable();
        setTimeout(() => setDifficulty(currentGuessDiff), 1500);
    } else {
        document.getElementById('guessResult').textContent = guess < secretNumber ? 'ğŸ“ˆ Ğ‘Ğ¾Ğ»ÑŒÑˆĞµ!' : 'ğŸ“‰ ĞœĞµĞ½ÑŒÑˆĞµ!';
    }
    document.getElementById('guessAttempts').textContent = `ĞŸĞ¾Ğ¿Ñ‹Ñ‚Ğ¾Ğº: ${guessCount}`;
    document.getElementById('guessInput').value = '';
}

async function updateLeaderboards() {
    const tables = {snakeEasyLB:['snake','easy'], snakeNormalLB:['snake','normal'], snakeHardLB:['snake','hard'], guessEasyLB:['guess','easy']};
    for (let [id,[game,diff]] of Object.entries(tables)) {
        const data = await api(`/leaderboards/${game}/${diff}`);
        const table = document.getElementById(id);
        table.innerHTML = Object.keys(data || {}).length ? 
            Object.entries(data).sort(([,a],[,b])=>b-a).slice(0,10).map(([u,s],i)=>`<tr><td>${i+1} ${u}: ${s}</td></tr>`).join('') :
            '<tr><td>ğŸ‘‘ Ğ‘ÑƒĞ´ÑŒ Ğ¿ĞµÑ€Ğ²Ñ‹Ğ¼!</td></tr>';
    }
}

async function updateTournamentTable() {
    const data = await api('/tournament');
    const table = document.getElementById('tournamentLB');
    table.innerHTML = Object.keys(data || {}).length ? 
        Object.entries(data).sort(([,a],[,b])=>b-a).slice(0,20).map(([u,s],i)=>{
            const medal = i<3 ? ['ğŸ¥‡','ğŸ¥ˆ','ğŸ¥‰'][i] : `${i+1}`;
            return `<tr><td>${medal}</td><td>${u}</td><td>${s}</td></tr>`;
        }).join('') : '<tr><td colspan="3">âš”ï¸ Ğ¢ÑƒÑ€Ğ½Ğ¸Ñ€ Ğ¿ÑƒÑÑ‚!</td></tr>';
}

async function sendMessage() {
    const msg = document.getElementById('chatInput').value.trim();
    if (msg) {
        await api('/chat', {method: 'POST', body: JSON.stringify({message: msg})});
        document.getElementById('chatInput').value = '';
        updateChat();
    }
}

async function updateChat() {
    const msgs = await api('/chat');
    document.getElementById('chatMessages').innerHTML = (msgs || []).map(m=>`<div><strong>${m.user}</strong> ${m.time}<br>${m.message}</div>`).join('');
}

async function resetTournament() {
    await api('/tournament/reset');
    updateTournamentTable();
}

// Ğ—Ğ°Ğ¿ÑƒÑĞº
setInterval(() => {
    document.getElementById('tourTimer').textContent = new Date().toLocaleTimeString('ru-RU',{timeZone:'Europe/Moscow',hour12:false});
}, 1000);
document.getElementById('chatInput').onkeypress = e => e.key === 'Enter' && sendMessage();
updateChat(); updateLeaderboards(); updateTournamentTable();
showGame('leaderboards');
</script>
</body>
</html>
