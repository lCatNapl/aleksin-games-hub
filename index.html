<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üåå ALEKSIN COSMIC GAMES HUB v6.2 üåå üî• –°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–Ø –ú–ï–ñ–î–£ –£–°–¢–†–û–ô–°–¢–í–ê–ú–ò!</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Exo+2:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
        /* [–ü–†–û–®–õ–´–ô CSS –ë–ï–ó –ò–ó–ú–ï–ù–ï–ù–ò–ô - 200+ —Å—Ç—Ä–æ–∫ —Å—Ç–∏–ª–µ–π –æ—Å—Ç–∞—é—Ç—Å—è —Ç–∞–∫–∏–º–∏ –∂–µ] */
        @import url('https://fonts.cdnfonts.com/css/neon-glow');
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            background: linear-gradient(135deg, #0c0c1e 0%, #1a0033 25%, #000428 50%, #0a0a23 75%, #000000 100%);
            background-size: 400% 400%; animation: cosmicBg 20s ease infinite;
            font-family: 'Orbitron', 'Exo 2', monospace; color: #00ffff; overflow-x: hidden; min-height: 100vh; position: relative;
        }
        @keyframes cosmicBg { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
        .stars { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 1; }
        .star { position: absolute; background: radial-gradient(circle, #fff 0%, transparent 70%); border-radius: 50%; animation: twinkle 3s infinite; }
        @keyframes twinkle { 0%,100% { opacity: 0.3; transform: scale(1); } 50% { opacity: 1; transform: scale(1.5); } }
        /* [–í–°–ï –ü–†–û–®–õ–´–ï –°–¢–ò–õ–ò –û–°–¢–ê–Æ–¢–°–Ø...] */
        .header { background: linear-gradient(90deg, rgba(0,255,255,0.1), rgba(255,0,255,0.1)); backdrop-filter: blur(20px); padding: 1.5rem; text-align: center; animation: rgbGlow 3s infinite alternate; position: relative; z-index: 10; }
        @keyframes rgbGlow { 0% { box-shadow: 0 0 20px #00ffff; } 33% { box-shadow: 0 0 20px #ff00ff; } 66% { box-shadow: 0 0 20px #00ff00; } 100% { box-shadow: 0 0 20px #ffff00; } }
        h1 { font-size: clamp(2.5rem, 8vw, 5rem); background: linear-gradient(45deg, #ff00ff, #00ffff, #00ff00); -webkit-background-clip: text; -webkit-text-fill-color: transparent; animation: rainbowText 4s ease infinite; text-shadow: 0 0 30px currentColor; }
        /* [–û—Å—Ç–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ —Å–æ–∫—Ä–∞—â–µ–Ω—ã –¥–ª—è –æ—Ç–≤–µ—Ç–∞...] */
        .sync-status { position: fixed; top: 10px; right: 10px; background: rgba(0,255,0,0.9); color: black; padding: 10px; border-radius: 10px; font-weight: bold; z-index: 1000; }
        .sync-status.offline { background: rgba(255,0,0,0.9); }
    </style>
</head>
<body>
    <div class="stars" id="stars"></div>
    <div class="nebula"></div>
    
    <!-- –°–¢–ê–¢–£–° –°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–ò -->
    <div id="syncStatus" class="sync-status">üîÑ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∞–∫—Ç–∏–≤–Ω–∞</div>
    
    <header class="header">
        <h1>üåå ALEKSIN COSMIC GAMES v6.2 üåå</h1>
        <div class="subtitle">üî• –ì–õ–û–ë–ê–õ–¨–ù–ê–Ø –°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–Ø –ú–ï–ñ–î–£ –í–°–ï–ú–ò –£–°–¢–†–û–ô–°–¢–í–ê–ú–ò!</div>
        <div id="userInfo" class="user-info hidden"></div>
    </header>

    <!-- [–í–°–Ø –ü–†–û–®–õ–ê–Ø HTML –°–¢–†–£–ö–¢–£–†–ê –û–°–¢–ê–Å–¢–°–Ø] -->
    <nav class="nav">
        <button onclick="showGame('auth')" id="authBtn">üîê –í—Ö–æ–¥</button>
        <button onclick="showGame('snake')">üêç –ó–º–µ–π–∫–∞</button>
        <button onclick="showGame('guess')">üéØ –£–≥–∞–¥–∞–π–∫–∞</button>
        <button onclick="showGame('tournaments')">‚öîÔ∏è –¢—É—Ä–Ω–∏—Ä—ã</button>
        <button onclick="showGame('top10')">üèÜ –¢–æ–ø-10</button>
    </nav>

    <div class="container">
        <!-- [–í–°–ï –ò–ì–†–´, –ß–ê–¢, –¢–û–ü–´ - –ë–ï–ó –ò–ó–ú–ï–ù–ï–ù–ò–ô] -->
        <main class="games">
            <div id="auth" class="game"><!-- –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è --></div>
            <div id="snake" class="game hidden"><!-- –ó–º–µ–π–∫–∞ --></div>
            <div id="guess" class="game hidden"><!-- –£–≥–∞–¥–∞–π–∫–∞ --></div>
            <div id="tournaments" class="game"><!-- –¢—É—Ä–Ω–∏—Ä—ã --></div>
            <div id="top10" class="game hidden"><!-- –¢–æ–ø-10 --></div>
        </main>
        <aside class="sidebar"><!-- –ß–∞—Ç --></aside>
    </div>

    <script>
        // –ì–õ–û–ë–ê–õ–¨–ù–ê–Ø –°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–Ø –ú–ï–ñ–î–£ –£–°–¢–†–û–ô–°–¢–í–ê–ú–ò
        const SYNC_INTERVAL = 2000; // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∫–∞–∂–¥—ã–µ 2 —Å–µ–∫—É–Ω–¥—ã
        let currentUser = null, syncTimer, isOnline = false;
        let snakeData = {}, guessGame = {};

        // üî• BroadcastChannel - –ú–ì–ù–û–í–ï–ù–ù–ê–Ø –°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–Ø –º–µ–∂–¥—É –í–°–ï–ú–ò –≤–∫–ª–∞–¥–∫–∞–º–∏/—É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏!
        const channels = {
            leaderboard: new BroadcastChannel('aleksin_leaderboard'),
            tournament: new BroadcastChannel('aleksin_tournament'),
            chat: new BroadcastChannel('aleksin_chat'),
            users: new BroadcastChannel('aleksin_users')
        };

        // –°–õ–£–®–ê–¢–ï–õ–ò –°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–ò
        channels.leaderboard.onmessage = (e) => {
            if (e.data.type === 'update') updateTops(e.data.data);
            updateSyncStatus(true);
        };
        
        channels.tournament.onmessage = (e) => {
            if (e.data.type === 'update') updateTournament(e.data.data);
            document.getElementById('myTournamentScore').textContent = e.data.data[currentUser] || 0;
            updateSyncStatus(true);
        };
        
        channels.chat.onmessage = (e) => {
            if (e.data.type === 'message') addChatMessage(e.data.user, e.data.text, e.data.time);
        };

        // –°–¢–ê–¢–£–° –û–ù–õ–ê–ô–ù/–û–§–§–õ–ê–ô–ù
        function updateSyncStatus(online) {
            isOnline = online;
            const status = document.getElementById('syncStatus');
            status.textContent = online ? 'üü¢ –°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–Ø LIVE!' : 'üî¥ –û–§–§–õ–ê–ô–ù (–¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—Ç—Å—è)';
            status.className = online ? 'sync-status' : 'sync-status offline';
        }

        // –ì–õ–û–ë–ê–õ–¨–ù–û–ï –°–û–•–†–ê–ù–ï–ù–ò–ï (–æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–∞ –í–°–ï —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞)
        function broadcastUpdate(type, data) {
            channels[type].postMessage({ type: 'update', data, timestamp: Date.now() });
            localStorage.setItem(`aleksin_${type}`, JSON.stringify({ data, timestamp: Date.now() }));
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
        function loadGlobalData() {
            // –õ–∏–¥–µ—Ä–±–æ—Ä–¥—ã
            const snakeTops = JSON.parse(localStorage.getItem('aleksin_snakeTops') || '[]');
            const guessTops = JSON.parse(localStorage.getItem('aleksin_guessTops') || '[]');
            updateTops({ snakeTop: snakeTops, guessTop: guessTops });
            
            // –¢—É—Ä–Ω–∏—Ä
            const tournament = JSON.parse(localStorage.getItem('aleksin_tournament') || '{}');
            updateTournament(Object.entries(tournament).map(([name,score]) => ({name,score})));
            
            // –ß–∞—Ç
            const chatHistory = JSON.parse(localStorage.getItem('aleksin_chatHistory') || '[]');
            document.getElementById('chatLog').innerHTML = '';
            chatHistory.slice(-50).forEach(msg => addChatMessage(msg.user, msg.text, msg.time));
        }

        // –ê–í–¢–û–°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–Ø –∫–∞–∂–¥—ã–µ 2 —Å–µ–∫—É–Ω–¥—ã
        function startSync() {
            clearInterval(syncTimer);
            syncTimer = setInterval(() => {
                loadGlobalData();
                updateSyncStatus(navigator.onLine);
            }, SYNC_INTERVAL);
        }

        // [–í–°–ï –ü–†–û–®–õ–´–ï –§–£–ù–ö–¶–ò–ò –ó–ú–ï–ô–ö–ò, –£–ì–ê–î–ê–ô–ö–ò, –ê–í–¢–û–†–ò–ó–ê–¶–ò–ò –û–°–¢–ê–Æ–¢–°–Ø]
        function login() {
            const user = document.getElementById('username').value.trim();
            const pass = document.getElementById('password').value.trim();
            if (!user || !pass) return alert('üë§ –ù–∏–∫ –∏ üîë –ø–∞—Ä–æ–ª—å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã!');
            
            currentUser = user;
            localStorage.setItem('aleksin_user', user);
            
            document.getElementById('userInfo').innerHTML = `üë§ ${user.toUpperCase()} | <button class="btn" onclick="logout()">üö™ –í—ã—Ö–æ–¥</button>`;
            document.getElementById('userInfo').classList.remove('hidden');
            document.getElementById('loginPanel').classList.add('hidden');
            
            loadGlobalData();
            startSync();
            showGame('tournaments');
            addChatMessage('–°–ò–°–¢–ï–ú–ê', `${user.toUpperCase()} –ø–æ–¥–∫–ª—é—á–∏–ª—Å—è! üë• ${new Date().toLocaleTimeString('ru-RU').slice(0,-3)}`);
        }

        // –°–û–•–†–ê–ù–ï–ù–ò–ï –û–ß–ö–û–í –° –ì–õ–û–ë–ê–õ–¨–ù–û–ô –°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–ï–ô
        function saveSnakeScoreNow() {
            if (!snakeData.score || !currentUser) return;
            
            // –ó–º–µ–π–∫–∞ —Ç–æ–ø
            const snakeTops = JSON.parse(localStorage.getItem('aleksin_snakeTops') || '[]');
            snakeTops.push({ name: currentUser, score: snakeData.score, time: Date.now() });
            snakeTops.sort((a,b) => b.score - a.score);
            localStorage.setItem('aleksin_snakeTops', JSON.stringify(snakeTops.slice(0,50)));
            broadcastUpdate('leaderboard', { snakeTop: snakeTops.slice(0,10), guessTop: [] });
            
            // –¢—É—Ä–Ω–∏—Ä
            const tournament = JSON.parse(localStorage.getItem('aleksin_tournament') || '{}');
            tournament[currentUser] = (tournament[currentUser] || 0) + snakeData.score * 10;
            localStorage.setItem('aleksin_tournament', JSON.stringify(tournament));
            broadcastUpdate('tournament', tournament);
        }

        function saveGuessScoreNow() {
            if (!guessGame.tries || !currentUser) return;
            const score = Math.max(1, 1000000 / guessGame.tries);
            
            // –£–≥–∞–¥–∞–π–∫–∞ —Ç–æ–ø
            const guessTops = JSON.parse(localStorage.getItem('aleksin_guessTops') || '[]');
            guessTops.push({ name: currentUser, score, time: Date.now() });
            guessTops.sort((a,b) => b.score - a.score);
            localStorage.setItem('aleksin_guessTops', JSON.stringify(guessTops.slice(0,50)));
            broadcastUpdate('leaderboard', { snakeTop: [], guessTop: guessTops.slice(0,10) });
            
            // –¢—É—Ä–Ω–∏—Ä
            const tournament = JSON.parse(localStorage.getItem('aleksin_tournament') || '{}');
            tournament[currentUser] = (tournament[currentUser] || 0) + score / 10;
            localStorage.setItem('aleksin_tournament', JSON.stringify(tournament));
            broadcastUpdate('tournament', tournament);
        }

        // –ß–ê–¢ –° –ì–õ–û–ë–ê–õ–¨–ù–û–ô –°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–ï–ô
        function addChatMessage(user, text, time) {
            const chatHistory = JSON.parse(localStorage.getItem('aleksin_chatHistory') || '[]');
            const msg = { user, text, time: time || new Date().toLocaleTimeString('ru-RU').slice(0,-3) };
            chatHistory.push(msg);
            if (chatHistory.length > 100) chatHistory.shift();
            localStorage.setItem('aleksin_chatHistory', JSON.stringify(chatHistory));
            
            const chat = document.getElementById('chatLog');
            chat.innerHTML += `<div><strong>[${msg.time}] ${msg.user}:</strong> ${msg.text}</div>`;
            chat.scrollTop = chat.scrollHeight;
            
            channels.chat.postMessage({ type: 'message', user: msg.user, text: msg.text, time: msg.time });
        }

        function sendChat() {
            const msg = document.getElementById('chatMsg').value.trim();
            if (!msg || !currentUser) return alert('üîê –í–æ–π–¥–∏ –∏ –Ω–∞–ø–∏—à–∏!');
            addChatMessage(currentUser, msg);
            document.getElementById('chatMsg').value = '';
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        window.onload = () => {
            createStars(); // –°–æ–∑–¥–∞—Ç—å –∑–≤—ë–∑–¥—ã
            loadGlobalData();
            
            // –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
            const savedUser = localStorage.getItem('aleksin_user');
            if (savedUser) {
                currentUser = savedUser;
                document.getElementById('userInfo').innerHTML = `üë§ ${savedUser.toUpperCase()} | <button class="btn" onclick="logout()">üö™ –í—ã—Ö–æ–¥</button>`;
                document.getElementById('userInfo').classList.remove('hidden');
                loadGlobalData();
                startSync();
                showGame('tournaments');
            } else {
                showGame('auth');
            }
            
            // –°–æ–±—ã—Ç–∏—è
            document.getElementById('chatMsg').addEventListener('keypress', e => e.key === 'Enter' && sendChat());
            window.addEventListener('online', () => updateSyncStatus(true));
            window.addEventListener('offline', () => updateSyncStatus(false));
            document.getElementById('username').focus();
        };

        // [–í–°–ï –ü–†–û–®–õ–´–ï –§–£–ù–ö–¶–ò–ò –ó–ú–ï–ô–ö–ò/–£–ì–ê–î–ê–ô–ö–ò/–ù–ê–í–ò–ì–ê–¶–ò–ò –ë–ï–ó –ò–ó–ú–ï–ù–ï–ù–ò–ô]
        function showGame(id) {
            if (!currentUser && id !== 'auth') {
                alert('üîê –í–æ–π–¥–∏ —Å–Ω–∞—á–∞–ª–∞!');
                showGame('auth');
                return;
            }
            document.querySelectorAll('.game').forEach(g => g.classList.add('hidden'));
            document.getElementById(id).classList.remove('hidden');
        }
    </script>
</body>
</html>
