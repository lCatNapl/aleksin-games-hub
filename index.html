<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>ğŸš€ ALEKSIN GAMES HUB v4.3 âœ… Ğ¢Ğ£Ğ ĞĞ˜Ğ Ğ«+Ğ§ĞĞ¢+ĞĞ§Ğ˜Ğ’ĞšĞ˜</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap');
*{margin:0;padding:0;box-sizing:border-box}
html{height:100%;overflow:auto}
body{font-family:'Orbitron',monospace;background:linear-gradient(135deg,#0a0a23 0%,#1a0a3a 50%,#0f0f4f 100%);color:#fff;min-height:100vh;overflow-y:auto}
.container{max-width:1400px;margin:0 auto;padding:20px}
h1{font-size:clamp(2rem,5vw,4rem);text-align:center;background:linear-gradient(45deg,#ff00ff,#00ffff,#ffff00);background-size:300% 300%;-webkit-background-clip:text;-webkit-text-fill-color:transparent;animation:gradient 3s ease infinite}
@keyframes gradient{0%,100%{background-position:0% 50%}50%{background-position:100% 50%}}
.btn{display:inline-block;padding:12px 24px;background:linear-gradient(45deg,rgba(255,0,255,0.3),rgba(0,255,255,0.3));border:2px solid rgba(255,255,255,0.3);border-radius:15px;font-size:1rem;font-weight:700;cursor:pointer;transition:all 0.3s ease;margin:5px;box-shadow:0 8px 25px rgba(0,0,0,0.5)}
.btn:hover{background:linear-gradient(45deg,rgba(255,0,255,0.6),rgba(0,255,255,0.6));transform:translateY(-3px);box-shadow:0 12px 35px rgba(255,0,255,0.4)}
.section{display:none;text-align:center}
.section.active{display:block;animation:fadeIn 0.5s ease}
@keyframes fadeIn{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
.game-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:15px;margin:20px 0}
canvas{border:3px solid rgba(255,255,255,0.3);border-radius:15px;background:#000;box-shadow:0 0 30px rgba(0,255,255,0.5);max-width:100%;height:auto;display:block;margin:10px auto}
table{width:100%;max-width:400px;margin:10px auto;border-collapse:collapse;background:rgba(255,255,255,0.1);border-radius:15px;overflow:hidden;box-shadow:0 10px 30px rgba(0,0,0,0.5)}
th,td{padding:12px;text-align:center;border-bottom:1px solid rgba(255,255,255,0.2);font-size:0.9rem}
th{background:linear-gradient(45deg,rgba(255,0,255,0.4),rgba(0,255,255,0.4));font-weight:700}
.tour-table{background:rgba(0,255,0,0.3)}
#statusBar{position:fixed;top:10px;right:10px;background:rgba(0,255,0,0.3);padding:10px;border-radius:10px;font-weight:700;z-index:1000}
#logoutContainer{position:fixed;top:10px;left:10px;z-index:9999;background:rgba(0,0,0,0.8);padding:10px;border-radius:15px}
#logoutBtn{display:none}#logoutBtn.active{display:inline-block !important}
#authSection{position:relative;margin:40px auto;max-width:400px;background:rgba(0,0,0,0.9);padding:30px;border-radius:20px;box-shadow:0 0 50px rgba(255,0,255,0.5)}
#authSection.active{display:block}
input{padding:12px;margin:10px;border:2px solid rgba(255,255,255,0.3);border-radius:10px;background:rgba(255,255,255,0.1);color:#fff;font-family:inherit;width:calc(100% - 24px);font-size:16px}
#tourTimer{font-size:2.5rem;color:#00ff00;text-shadow:0 0 20px #00ff00;animation:pulse 1s infinite}
@keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.05)}}
#chatMessages{height:300px;overflow-y:auto;border:2px solid #00ff00;margin:10px auto;padding:15px;background:rgba(0,0,0,0.7);border-radius:15px;max-width:500px;font-size:0.9rem}
.league-badge{display:inline-block;padding:5px 12px;border-radius:20px;font-size:0.8rem;font-weight:700;margin:2px}
.bronze{background:#cd7f32;color:#fff}.silver{background:#c0c0c0;color:#000}.gold{background:#ffd700;color:#000}
.achievement{position:fixed;top:20px;left:50%;transform:translateX(-50%);background:linear-gradient(45deg,#ffd700,#ffed4e);color:#000;padding:15px 25px;border-radius:25px;font-weight:900;font-size:1.2rem;z-index:10000;display:none;animation:achievePop 0.5s ease}
@keyframes achievePop{0%{transform:translateX(-50%) scale(0.5);opacity:0}50%{transform:translateX(-50%) scale(1.1)}100%{transform:translateX(-50%) scale(1);opacity:1}}
@media (max-width:768px){.container{padding:10px}.btn{padding:10px 18px;font-size:0.9rem}}
</style>
</head>
<body>
<div id="statusBar">ğŸ‘‹ Ğ“Ğ¾ÑÑ‚ÑŒ</div>
<div id="logoutContainer">
<button class="btn" id="logoutBtn" onclick="logout()">ğŸ‘‹ Ğ’Ğ«Ğ™Ğ¢Ğ˜</button>
</div>

<div class="container">
<div id="authSection" class="section active">
<h2>ğŸ” ĞĞ´Ğ¼Ğ¸Ğ½, Ğ’Ñ…Ğ¾Ğ´</h2>
<input type="text" id="usernameInput" placeholder="test" value="test">
<input type="password" id="passwordInput" placeholder="123456" value="123456">
<button class="btn" onclick="login()">ğŸš€ Ğ’ĞĞ™Ğ¢Ğ˜</button>
</div>

<h1>ğŸš€ ALEKSIN GAMES HUB v4.3 âœ… Ğ¢Ğ£Ğ ĞĞ˜Ğ Ğ«+Ğ§ĞĞ¢+ĞĞ§Ğ˜Ğ’ĞšĞ˜</h1>

<div class="game-grid">
<button class="btn" onclick="showGame('leaderboards')">ğŸ† Ğ›Ğ˜Ğ”Ğ•Ğ Ğ‘ĞĞ Ğ”Ğ«</button>
<button class="btn" onclick="showGame('tournament')">âš”ï¸ Ğ¢Ğ£Ğ ĞĞ˜Ğ </button>
<button class="btn" onclick="showGame('chat')">ğŸ’¬ Ğ§ĞĞ¢</button>
<button class="btn" onclick="showGame('profile')">ğŸ‘¤ ĞŸĞ ĞĞ¤Ğ˜Ğ›Ğ¬</button>
<button class="btn" onclick="showGame('snake')">ğŸ Ğ—ĞœĞ•Ğ™ĞšĞ</button>
<button class="btn" onclick="showGame('guess')">ğŸ¯ Ğ£Ğ“ĞĞ”ĞĞ™</button>
</div>

<!-- Ğ›Ğ˜Ğ”Ğ•Ğ Ğ‘ĞĞ Ğ”Ğ« -->
<div id="leaderboardTables" class="section">
<h2>ğŸ† Ğ¢ĞĞŸ-10 ĞŸĞ Ğ’Ğ¡Ğ•Ğœ Ğ˜Ğ“Ğ ĞĞœ</h2>
<div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:20px;max-height:600px;overflow-y:auto">
<table><thead><tr><th>ğŸ Ğ—Ğ¼ĞµĞ¹ĞºĞ° Ğ›Ñ‘Ğ³ĞºĞ°Ñ</th></tr></thead><tbody id="snakeEasyLB"></tbody></table>
<table><thead><tr><th>ğŸ Ğ—Ğ¼ĞµĞ¹ĞºĞ° Ğ¡Ñ€ĞµĞ´Ğ½ÑÑ</th></tr></thead><tbody id="snakeNormalLB"></tbody></table>
<table><thead><tr><th>ğŸ Ğ—Ğ¼ĞµĞ¹ĞºĞ° Ğ¡Ğ»Ğ¾Ğ¶Ğ½Ğ°Ñ</th></tr></thead><tbody id="snakeHardLB"></tbody></table>
<table><thead><tr><th>ğŸ¯ Ğ£Ğ³Ğ°Ğ´Ğ°Ğ¹ĞºĞ° Ğ›Ñ‘Ğ³ĞºĞ°Ñ</th></tr></thead><tbody id="guessEasyLB"></tbody></table>
<table><thead><tr><th>ğŸ¯ Ğ£Ğ³Ğ°Ğ´Ğ°Ğ¹ĞºĞ° Ğ¡Ñ€ĞµĞ´Ğ½ÑÑ</th></tr></thead><tbody id="guessNormalLB"></tbody></table>
<table><thead><tr><th>ğŸ¯ Ğ£Ğ³Ğ°Ğ´Ğ°Ğ¹ĞºĞ° Ğ¡Ğ»Ğ¾Ğ¶Ğ½Ğ°Ñ</th></tr></thead><tbody id="guessHardLB"></tbody></table>
</div>
</div>

<!-- Ğ¢Ğ£Ğ ĞĞ˜Ğ  âœ… Ğ¤Ğ˜ĞšĞ¡ -->
<div id="tournamentSection" class="section">
<h2>âš”ï¸ Ğ¢Ğ£Ğ ĞĞ˜Ğ  24Ñ‡ (00:00 ĞœĞ¡Ğš)</h2>
<div style="font-size:1.5rem;margin:20px">â° Ğ”Ğ¾ ĞºĞ¾Ğ½Ñ†Ğ°: <span id="tourTimer">--:--:--</span></div>
<h3 style="color:#00ff00">ğŸ† Ğ¢ĞĞŸ-100 (Ğ¢ĞĞŸ-5 = ĞŸĞ Ğ˜Ğ—Ğ« ğŸ¥‡ğŸ¥ˆğŸ¥‰)</h3>
<div style="max-height:500px;overflow-y:auto">
<table class="tour-table" style="width:100%">
<thead><tr><th>ĞœĞ•Ğ¡Ğ¢Ğ</th><th>Ğ˜Ğ“Ğ ĞĞš</th><th>ĞĞ§ĞšĞ˜</th></tr></thead>
<tbody id="tournamentLB"></tbody>
</table>
</div>
<button class="btn" onclick="resetTournament()" style="margin:20px">ğŸ”„ Ğ¡Ğ‘Ğ ĞĞ¡Ğ˜Ğ¢Ğ¬ Ğ¢Ğ£Ğ ĞĞ˜Ğ  (ĞĞ´Ğ¼Ğ¸Ğ½)</button>
</div>

<!-- Ğ§ĞĞ¢ âœ… Ğ¤Ğ˜ĞšĞ¡ -->
<div id="chatSection" class="section">
<h2>ğŸ’¬ Ğ“Ğ›ĞĞ‘ĞĞ›Ğ¬ĞĞ«Ğ™ Ğ§ĞĞ¢ (Ğ²ÑĞµ Ğ²Ğ¸Ğ´ÑÑ‚ Ğ²ÑĞµÑ…)</h2>
<div id="chatMessages"></div>
<div style="margin:20px">
<input id="chatInput" placeholder="ĞĞ°Ğ¿Ğ¸ÑˆĞ¸ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ... (Enter)" style="width:60%;font-size:16px">
<button class="btn" onclick="sendMessage()">ğŸ“¤ ĞĞ¢ĞŸĞ ĞĞ’Ğ˜Ğ¢Ğ¬</button>
<button class="btn" onclick="clearChat()">ğŸ—‘ï¸ ĞĞ§Ğ˜Ğ¡Ğ¢Ğ˜Ğ¢Ğ¬</button>
</div>
</div>

<!-- ĞŸĞ ĞĞ¤Ğ˜Ğ›Ğ¬ âœ… ĞĞ§Ğ˜Ğ’ĞšĞ˜ -->
<div id="profileSection" class="section">
<h2>ğŸ‘¤ ĞŸĞ ĞĞ¤Ğ˜Ğ›Ğ¬ <span id="profileUsername"></span></h2>
<div style="background:rgba(0,255,0,0.2);padding:20px;border-radius:15px;margin:20px auto;max-width:500px">
<div>ğŸ† Ğ¢Ğ¾Ñ‚Ğ°Ğ» Ğ¾Ñ‡ĞºĞ¾Ğ²: <span id="totalScore">0</span></div>
<div>âš”ï¸ Ğ›Ğ¸Ğ³Ğ°: <span id="leagueBadge" class="league-badge bronze">Ğ‘Ğ ĞĞĞ—Ğ</span></div>
<div>ğŸ® ĞŸĞ¾Ğ±ĞµĞ´: <span id="totalWins">0</span> | ğŸ’€ ĞŸĞ¾Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğ¹: <span id="totalLosses">0</span></div>
<div>ğŸ“Š Ğ’Ğ¸Ğ½Ñ€ĞµĞ¹Ñ‚: <span id="winrate">0%</span></div>
</div>
<h3>ğŸ… Ğ”ĞĞ¡Ğ¢Ğ˜Ğ–Ğ•ĞĞ˜Ğ¯</h3>
<div id="achievements" style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:10px"></div>
</div>

<!-- Ğ—ĞœĞ•Ğ™ĞšĞ -->
<div id="snakeSection" class="section">
<h2>ğŸ Ğ—ĞœĞ•Ğ™ĞšĞ PRO</h2>
<div class="game-grid">
<button class="btn" onclick="startSnake('easy')">Ğ›Ñ‘Ğ³ĞºĞ°Ñ</button>
<button class="btn" onclick="startSnake('normal')">Ğ¡Ñ€ĞµĞ´Ğ½ÑÑ</button>
<button class="btn" onclick="startSnake('hard')">Ğ¡Ğ»Ğ¾Ğ¶Ğ½Ğ°Ñ</button>
</div>
<div style="position:relative;display:inline-block">
<canvas id="gameCanvas" width="400" height="400"></canvas>
<div id="snakeScore" style="position:absolute;top:10px;left:10px;font-size:1.5rem;font-weight:700;color:#00ff00">Ğ¡Ñ‡Ñ‘Ñ‚: 0</div>
</div>
<button class="btn" onclick="stopSnake()">â¹ï¸ Ğ¡Ğ¢ĞĞŸ</button>
</div>

<!-- Ğ£Ğ“ĞĞ”ĞĞ™ĞšĞ -->
<div id="guessSection" class="section">
<h2>ğŸ¯ Ğ£Ğ“ĞĞ”ĞĞ™ Ğ§Ğ˜Ğ¡Ğ›Ğ</h2>
<div class="game-grid">
<button class="btn" onclick="setDifficulty('easy')">Ğ›Ñ‘Ğ³ĞºĞ°Ñ (1-1000)</button>
<button class="btn" onclick="setDifficulty('normal')">Ğ¡Ñ€ĞµĞ´Ğ½ÑÑ (1-10000)</button>
<button class="btn" onclick="setDifficulty('hard')">Ğ¡Ğ»Ğ¾Ğ¶Ğ½Ğ°Ñ (1-100000)</button>
</div>
<div style="font-size:2rem;margin:20px">Ğ§Ğ¸ÑĞ»Ğ¾ Ğ¾Ñ‚ <span id="rangeMin">1</span> Ğ´Ğ¾ <span id="rangeMax">1000</span></div>
<input type="number" id="guessInput" placeholder="Ğ’Ğ²ĞµĞ´Ğ¸ Ñ‡Ğ¸ÑĞ»Ğ¾">
<button class="btn" onclick="makeGuess()">ğŸ” Ğ£Ğ“ĞĞ”ĞĞ¢Ğ¬</button>
<div id="guessResult"></div>
<div id="guessAttempts">ĞŸĞ¾Ğ¿Ñ‹Ñ‚Ğ¾Ğº: 0</div>
</div>
</div>

<div id="achievementPopup" class="achievement"></div>

<script>
// âœ… Ğ¤Ğ˜ĞšĞ¡ Ğ”ĞĞĞĞ«Ğ¥ - ĞŸĞ Ğ¯ĞœĞ Ğ¡Ğ•Ğ™Ğ§ĞĞ¡!
function initData() {
    if (!localStorage.getItem('aleksinLeaderboards')) localStorage.setItem('aleksinLeaderboards', '{}');
    if (!localStorage.getItem('aleksinTournament')) localStorage.setItem('aleksinTournament', '{}');
    if (!localStorage.getItem('aleksinChat')) localStorage.setItem('aleksinChat', '[]');
    if (!localStorage.getItem('aleksinStats')) localStorage.setItem('aleksinStats', '{}');
    if (!localStorage.getItem('aleksinAchievements')) localStorage.setItem('aleksinAchievements', '{}');
}

// âœ… Ğ“Ğ›ĞĞ‘ĞĞ›Ğ¬ĞĞ«Ğ•
let currentUser = localStorage.getItem('aleksinUser') || null;
let leaderboards = JSON.parse(localStorage.getItem('aleksinLeaderboards') || '{}');
let tournamentScores = JSON.parse(localStorage.getItem('aleksinTournament') || '{}');
let chatMessages = JSON.parse(localStorage.getItem('aleksinChat') || '[]');
let achievements = JSON.parse(localStorage.getItem('aleksinAchievements') || '{}');
let stats = JSON.parse(localStorage.getItem('aleksinStats') || '{}');

// Ğ—ĞœĞ•Ğ™ĞšĞ
let snake = [{x:10,y:10}], snakeDir = {x:1,y:0}, snakeScore = 0, snakeRunning = false, snakeInterval;
let currentSnakeDiff = 'easy', speeds = {easy:200, normal:150, hard:100};
let food = {x:5,y:5};

// Ğ£Ğ“ĞĞ”ĞĞ™ĞšĞ
let secretNumber, guessCount = 0, currentGuessDiff = 'easy';
const ranges = {easy:1000, normal:10000, hard:100000};

// âœ… Ğ¡Ğ¢ĞĞ Ğ¢
initData();
if (currentUser) {
    document.getElementById('statusBar').textContent = `ğŸ‘‹ ${currentUser}`;
    document.getElementById('logoutBtn').classList.add('active');
}
setInterval(updateTournament, 1000);
updateChat();
loadProfile();
updateLeaderboards();
updateTournamentTable();

// âœ… ĞĞĞ’Ğ˜Ğ“ĞĞ¦Ğ˜Ğ¯
function showGame(game) {
    document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
    const sectionMap = {
        'leaderboards': 'leaderboardTables',
        'tournament': 'tournamentSection', 
        'chat': 'chatSection',
        'profile': 'profileSection',
        'snake': 'snakeSection',
        'guess': 'guessSection'
    };
    const sectionId = sectionMap[game] || game + 'Section';
    document.getElementById(sectionId).classList.add('active');
    
    if (game === 'leaderboards') updateLeaderboards();
    if (game === 'tournament') updateTournamentTable();
    if (game === 'chat') updateChat();
    if (game === 'profile') loadProfile();
}

// âœ… Ğ›ĞĞ“Ğ˜Ğ
function login() {
    const username = document.getElementById('usernameInput').value.trim();
    const password = document.getElementById('passwordInput').value;
    if (username && password) {
        currentUser = username;
        stats[currentUser] = stats[currentUser] || {wins:0, losses:0, total:0};
        document.getElementById('statusBar').textContent = `ğŸ‘‹ ${currentUser}`;
        document.getElementById('logoutBtn').classList.add('active');
        document.getElementById('authSection').classList.remove('active');
        localStorage.setItem('aleksinUser', currentUser);
        saveAllData();
        loadProfile();
        showAchievement('firstLogin');
        alert(`âœ… Ğ”Ğ¾Ğ±Ñ€Ğ¾ Ğ¿Ğ¾Ğ¶Ğ°Ğ»Ğ¾Ğ²Ğ°Ñ‚ÑŒ, ĞĞ´Ğ¼Ğ¸Ğ½ ${currentUser}!`);
    }
}

function logout() {
    if (snakeInterval) clearInterval(snakeInterval);
    snakeRunning = false;
    currentUser = null;
    document.getElementById('statusBar').textContent = 'ğŸ‘‹ Ğ“Ğ¾ÑÑ‚ÑŒ';
    document.getElementById('logoutBtn').classList.remove('active');
    document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
    document.getElementById('authSection').classList.add('active');
    localStorage.removeItem('aleksinUser');
    saveAllData();
}

// âœ… Ğ¡ĞĞ¥Ğ ĞĞĞ•ĞĞ˜Ğ•
function saveAllData() {
    localStorage.setItem('aleksinLeaderboards', JSON.stringify(leaderboards));
    localStorage.setItem('aleksinTournament', JSON.stringify(tournamentScores));
    localStorage.setItem('aleksinChat', JSON.stringify(chatMessages));
    localStorage.setItem('aleksinStats', JSON.stringify(stats));
    localStorage.setItem('aleksinAchievements', JSON.stringify(achievements));
}

// âœ… Ğ—ĞœĞ•Ğ™ĞšĞ (ĞĞ¡Ğ¢ĞĞ•Ğ¢Ğ¡Ğ¯ ĞšĞĞš Ğ’ v4.2)
function startSnake(diff) {
    if (!currentUser) { alert('ğŸ” ĞĞ´Ğ¼Ğ¸Ğ½, Ğ²Ğ¾Ğ¹Ğ´Ğ¸!'); return; }
    currentSnakeDiff = diff;
    
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    canvas.width = 400;
    canvas.height = 400;
    const grid = 20;
    
    snake = [{x:10,y:10}];
    snakeDir = {x:1,y:0};
    snakeScore = 0;
    snakeRunning = true;
    
    function generateFood() {
        food = {x:Math.floor(Math.random()*19), y:Math.floor(Math.random()*19)};
    }
    
    function gameLoop() {
        if (!snakeRunning) return;
        
        ctx.fillStyle = '#000';
        ctx.fillRect(0,0,400,400);
        
        const head = {x:snake[0].x + snakeDir.x, y:snake[0].y + snakeDir.y};
        
        if (head.x < 0 || head.x > 19 || head.y < 0 || head.y > 19 || 
            snake.some(s => s.x === head.x && s.y === head.y)) {
            gameOver();
            return;
        }
        
        snake.unshift(head);
        
        if (head.x === food.x && head.y === food.y) {
            snakeScore += 100;
            generateFood();
            if (snakeScore >= 1000) showAchievement('snakeMaster');
        } else {
            snake.pop();
        }
        
        snake.forEach((s,i) => {
            ctx.fillStyle = i === 0 ? '#ff00ff' : '#00ff00';
            ctx.fillRect(s.x*grid, s.y*grid, grid-2, grid-2);
        });
        
        ctx.fillStyle = '#ff0000';
        ctx.fillRect(food.x*grid, food.y*grid, grid-2, grid-2);
        
        document.getElementById('snakeScore').textContent = `Ğ¡Ñ‡Ñ‘Ñ‚: ${snakeScore}`;
    }
    
    gameLoop();
    snakeInterval = setInterval(gameLoop, speeds[diff]);
    
    // Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ
    let touchStart = {x:0,y:0};
    canvas.addEventListener('touchstart', e => {
        e.preventDefault();
        touchStart = {x:e.touches[0].clientX, y:e.touches[0].clientY};
    });
    canvas.addEventListener('touchend', e => {
        e.preventDefault();
        const touchEnd = {x:e.changedTouches[0].clientX, y:e.changedTouches[0].clientY};
        const dx = touchStart.x - touchEnd.x;
        const dy = touchStart.y - touchEnd.y;
        
        if (Math.abs(dx) > Math.abs(dy) && Math.abs(dx) > 30) {
            snakeDir = dx > 0 && snakeDir.x !== 1 ? {x:-1,y:0} : 
                      dx < 0 && snakeDir.x !== -1 ? {x:1,y:0} : snakeDir;
        } else if (Math.abs(dy) > 30) {
            snakeDir = dy > 0 && snakeDir.y !== 1 ? {x:0,y:-1} : 
                      dy < 0 && snakeDir.y !== -1 ? {x:0,y:1} : snakeDir;
        }
    });
    
    document.addEventListener('keydown', e => {
        e.preventDefault();
        if (e.key === 'ArrowUp' && snakeDir.y !== 1) snakeDir = {x:0,y:-1};
        if (e.key === 'ArrowDown' && snakeDir.y !== -1) snakeDir = {x:0,y:1};
        if (e.key === 'ArrowLeft' && snakeDir.x !== 1) snakeDir = {x:-1,y:0};
        if (e.key === 'ArrowRight' && snakeDir.x !== -1) snakeDir = {x:1,y:0};
    });
}

function stopSnake() {
    snakeRunning = false;
    if (snakeInterval) clearInterval(snakeInterval);
}

function gameOver() {
    snakeRunning = false;
    if (snakeInterval) clearInterval(snakeInterval);
    
    if (currentUser && snakeScore > 0) {
        leaderboards.snake = leaderboards.snake || {};
        leaderboards.snake[currentSnakeDiff] = leaderboards.snake[currentSnakeDiff] || {};
        leaderboards.snake[currentSnakeDiff][currentUser] = Math.max(
            leaderboards.snake[currentSnakeDiff][currentUser] || 0, snakeScore
        );
        tournamentScores[currentUser] = (tournamentScores[currentUser] || 0) + snakeScore;
        saveAllData();
        updateLeaderboards();
        updateTournamentTable();
    }
    alert(`Game Over, ĞĞ´Ğ¼Ğ¸Ğ½! Ğ¡Ñ‡Ñ‘Ñ‚: ${snakeScore}`);
}

// âœ… Ğ£Ğ“ĞĞ”ĞĞ™ĞšĞ
function setDifficulty(diff) {
    currentGuessDiff = diff;
    secretNumber = Math.floor(Math.random() * ranges[diff]) + 1;
    guessCount = 0;
    document.getElementById('rangeMin').textContent = 1;
    document.getElementById('rangeMax').textContent = ranges[diff];
    document.getElementById('guessResult').textContent = '';
    document.getElementById('guessAttempts').textContent = 'ĞŸĞ¾Ğ¿Ñ‹Ñ‚Ğ¾Ğº: 0';
}

function makeGuess() {
    if (!currentUser) { alert('ğŸ” ĞĞ´Ğ¼Ğ¸Ğ½, Ğ²Ğ¾Ğ¹Ğ´Ğ¸!'); return; }
    const guess = parseInt(document.getElementById('guessInput').value);
    if (!guess || guess < 1) { alert('Ğ’Ğ²ĞµĞ´Ğ¸ Ñ‡Ğ¸ÑĞ»Ğ¾!'); return; }
    
    guessCount++;
    if (guess === secretNumber) {
        const score = Math.max(1000 - guessCount * 100, 100);
        document.getElementById('guessResult').innerHTML = `âœ… Ğ£Ğ³Ğ°Ğ´Ğ°Ğ» Ğ·Ğ° ${guessCount} Ğ¿Ğ¾Ğ¿Ñ‹Ñ‚Ğ¾Ğº! (+${score})`;
        stats[currentUser].wins = (stats[currentUser].wins || 0) + 1;
        
        leaderboards.guess = leaderboards.guess || {};
        leaderboards.guess[currentGuessDiff] = leaderboards.guess[currentGuessDiff] || {};
        leaderboards.guess[currentGuessDiff][currentUser] = Math.max(
            leaderboards.guess[currentGuessDiff][currentUser] || 0, score
        );
        tournamentScores[currentUser] = (tournamentScores[currentUser] || 0) + score;
        
        if (guessCount <= 5) showAchievement('guessPro');
        saveAllData();
        updateLeaderboards();
        updateTournamentTable();
    } else {
        const diff = Math.abs(guess - secretNumber);
        let hint = guess < secretNumber ? 'ğŸ“ˆ Ğ‘Ğ¾Ğ»ÑŒÑˆĞµ' : 'ğŸ“‰ ĞœĞµĞ½ÑŒÑˆĞµ';
        if (diff <= 10) hint += ' (ĞĞ§Ğ•ĞĞ¬ Ğ±Ğ»Ğ¸Ğ·ĞºĞ¾!)';
        else if (diff <= 50) hint += ' (Ğ±Ğ»Ğ¸Ğ·ĞºĞ¾)';
        document.getElementById('guessResult').textContent = hint;
        stats[currentUser].losses = (stats[currentUser].losses || 0) + 1;
    }
    document.getElementById('guessAttempts').textContent = `ĞŸĞ¾Ğ¿Ñ‹Ñ‚Ğ¾Ğº: ${guessCount}`;
    document.getElementById('guessInput').value = '';
    saveAllData();
}

// âœ… Ğ›Ğ˜Ğ”Ğ•Ğ Ğ‘ĞĞ Ğ”Ğ«
function updateLeaderboards() {
    const tables = {
        snakeEasyLB: leaderboards.snake?.easy || {},
        snakeNormalLB: leaderboards.snake?.normal || {},
        snakeHardLB: leaderboards.snake?.hard || {},
        guessEasyLB: leaderboards.guess?.easy || {},
        guessNormalLB: leaderboards.guess?.normal || {},
        guessHardLB: leaderboards.guess?.hard || {}
    };
    
    Object.entries(tables).forEach(([id, data]) => {
        const table = document.getElementById(id);
        if (!data || Object.keys(data).length === 0) {
            table.innerHTML = '<tr><td colspan="1">ğŸ‘‘ Ğ‘Ğ£Ğ”Ğ¬ ĞŸĞ•Ğ Ğ’Ğ«Ğœ!</td></tr>';
        } else {
            const sorted = Object.entries(data).sort(([,a],[,b]) => b-a).slice(0,10);
            table.innerHTML = sorted.map(([user,score],i) => 
                `<tr><td>${i+1}ğŸ† ${user}<br><small>${score} Ğ¾Ñ‡ĞºĞ¾Ğ²</small></td></tr>`
            ).join('');
        }
    });
}

// âœ… Ğ¢Ğ£Ğ ĞĞ˜Ğ  âœ… Ğ¤Ğ˜ĞšĞ¡ Ğ’Ğ˜Ğ”ĞĞĞ¡Ğ¢Ğ˜
function updateTournamentTable() {
    const table = document.getElementById('tournamentLB');
    if (!tournamentScores || Object.keys(tournamentScores).length === 0) {
        table.innerHTML = '<tr><td colspan="3">âš”ï¸ Ğ¢ÑƒÑ€Ğ½Ğ¸Ñ€ Ğ¿ÑƒÑÑ‚! Ğ˜Ğ³Ñ€Ğ°Ğ¹ Ğ¸ Ğ·Ğ°Ğ¹Ğ¼Ğ¸ 1 Ğ¼ĞµÑÑ‚Ğ¾!</td></tr>';
        return;
    }
    
    const sorted = Object.entries(tournamentScores).sort(([,a],[,b]) => b-a).slice(0,100);
    table.innerHTML = sorted.map(([user,score],i) => {
        const medal = i < 5 ? ['ğŸ¥‡','ğŸ¥ˆ','ğŸ¥‰','ğŸ–ï¸','ğŸ–ï¸'][i] : `${i+1}`;
        return `<tr><td>${medal}</td><td>${user}</td><td>${score}</td></tr>`;
    }).join('');
}

// âœ… Ğ§ĞĞ¢ âœ… Ğ¤Ğ˜ĞšĞ¡ Ğ’Ğ˜Ğ”ĞĞĞ¡Ğ¢Ğ˜
function sendMessage() {
    const msg = document.getElementById('chatInput').value.trim();
    if (msg && currentUser) {
        chatMessages.push({
            user: currentUser, 
            msg: msg, 
            time: new Date().toLocaleTimeString('ru-RU', {timeZone: 'Europe/Moscow'}),
            id: Date.now()
        });
        document.getElementById('chatInput').value = '';
        saveAllData();
        updateChat();
    }
}

function updateChat() {
    const chat = document.getElementById('chatMessages');
    chat.innerHTML = chatMessages.slice(-50).reverse().map(m =>
        `<div style="margin:5px 0"><strong style="color:#00ff00">${m.user}</strong> 
        <span style="color:#888;float:right;font-size:0.8rem">${m.time}</span><br>${m.msg}</div>`
    ).join('');
    chat.scrollTop = 0;
}

function clearChat() {
    chatMessages = [];
    saveAllData();
    updateChat();
}

// âœ… Ğ¢Ğ£Ğ ĞĞ˜Ğ  MSK
function updateTournament() {
    const now = new Date();
    const msk = new Date(now.toLocaleString("en-US", {timeZone: "Europe/Moscow"}));
    const nextMidnight = new Date(msk.getFullYear(), msk.getMonth(), msk.getDate() + 1, 0, 0, 0);
    const timeLeft = nextMidnight - msk;
    
    const h = Math.floor(timeLeft/3600000).toString().padStart(2,'0');
    const m = Math.floor((timeLeft%3600000)/60000).toString().padStart(2,'0');
    const s = Math.floor((timeLeft%60000)/1000).toString().padStart(2,'0');
    document.getElementById('tourTimer').textContent = `${h}:${m}:${s}`;
}

// âœ… ĞŸĞ ĞĞ¤Ğ˜Ğ›Ğ¬ + ĞĞ§Ğ˜Ğ’ĞšĞ˜ âœ… Ğ¤Ğ˜ĞšĞ¡
function loadProfile() {
    if (!currentUser) return;
    
    document.getElementById('profileUsername').textContent = currentUser;
    const userStats = stats[currentUser] || {wins:0, losses:0};
    
    document.getElementById('totalWins').textContent = userStats.wins || 0;
    document.getElementById('totalLosses').textContent = userStats.losses || 0;
    const winrate = userStats.wins ? Math.round(userStats.wins/(userStats.wins+userStats.losses)*100) : 0;
    document.getElementById('winrate').textContent = winrate + '%';
    
    const total = Object.values(leaderboards).flatMap(lb => Object.values(lb))
        .reduce((sum, lb) => sum + (lb[currentUser] || 0), 0) + (tournamentScores[currentUser] || 0);
    document.getElementById('totalScore').textContent = total;
    
    const league = total > 10000 ? 'gold' : total > 1000 ? 'silver' : 'bronze';
    document.getElementById('leagueBadge').textContent = league.toUpperCase();
    document.getElementById('leagueBadge').className = `league-badge ${league}`;
    
    updateAchievements();
}

function updateAchievements() {
    const achList = document.getElementById('achievements');
    const achDefs = {
        firstLogin: 'ğŸ‰ ĞŸĞµÑ€Ğ²Ñ‹Ğ¹ Ğ²Ñ…Ğ¾Ğ´',
        snakeMaster: 'ğŸ ĞœĞ°ÑÑ‚ĞµÑ€ Ğ—Ğ¼ĞµĞ¹ĞºĞ¸ (1000+ Ğ¾Ñ‡ĞºĞ¾Ğ²)',
        guessPro: 'ğŸ¯ ĞŸÑ€Ğ¾Ñ„Ğ¸ Ğ£Ğ³Ğ°Ğ´Ğ°Ğ¹ĞºĞ¸ (5 Ğ¿Ğ¾Ğ¿Ñ‹Ñ‚Ğ¾Ğº)'
    };
    
    if (!achievements[currentUser]) achievements[currentUser] = {};
    
    achList.innerHTML = Object.entries(achDefs).map(([id, name]) => {
        const unlocked = achievements[currentUser][id] || false;
        return `<div style="background:${unlocked ? 'rgba(0,255,0,0.3)' : 'rgba(255,255,255,0.1)'};padding:15px;border-radius:10px;text-align:center">
            ${unlocked ? 'âœ…' : 'ğŸ”’'} ${name}
        </div>`;
    }).join('');
}

function showAchievement(id) {
    if (!currentUser || achievements[currentUser][id]) return;
    achievements[currentUser] = achievements[currentUser] || {};
    achievements[currentUser][id] = true;
    saveAllData();
    updateAchievements();
    
    // Popup
    const popup = document.getElementById('achievementPopup');
    popup.textContent = `ğŸ† Ğ”Ğ¾ÑÑ‚Ğ¸Ğ¶ĞµĞ½Ğ¸Ğµ: ${id.toUpperCase().replace(/([A-Z])/g, ' $1').trim()}!`;
    popup.style.display = 'block';
    setTimeout(() => popup.style.display = 'none', 3000);
}

// âœ… ĞĞ”ĞœĞ˜Ğ
function resetTournament() {
    if (confirm('ğŸ”„ ĞĞ´Ğ¼Ğ¸Ğ½, ÑĞ±Ñ€Ğ¾ÑĞ¸Ñ‚ÑŒ Ñ‚ÑƒÑ€Ğ½Ğ¸Ñ€?')) {
        tournamentScores = {};
        saveAllData();
        updateTournamentTable();
        alert('âœ… Ğ¢ÑƒÑ€Ğ½Ğ¸Ñ€ ÑĞ±Ñ€Ğ¾ÑˆĞµĞ½!');
    }
}
</script>
</body>
</html>
