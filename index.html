<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üåå ALEKSIN COSMIC GAMES HUB v6.0 üåå –°–ê–ú–´–ô –ö–†–ê–°–ò–í–´–ô –í –ú–ò–†–ï!</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.5/socket.io.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Exo+2:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
        @import url('https://fonts.cdnfonts.com/css/neon-glow');
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            background: linear-gradient(135deg, #0c0c1e 0%, #1a0033 25%, #000428 50%, #0a0a23 75%, #000000 100%);
            background-size: 400% 400%;
            animation: cosmicBg 20s ease infinite;
            font-family: 'Orbitron', 'Exo 2', monospace;
            color: #00ffff;
            overflow-x: hidden;
            min-height: 100vh;
            position: relative;
        }
        
        @keyframes cosmicBg {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        /* –ó–≤—ë–∑–¥—ã –∏ —á–∞—Å—Ç–∏—Ü—ã */
        .stars { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 1; }
        .star { position: absolute; background: radial-gradient(circle, #fff 0%, transparent 70%); border-radius: 50%; animation: twinkle 3s infinite; }
        @keyframes twinkle { 0%,100% { opacity: 0.3; transform: scale(1); } 50% { opacity: 1; transform: scale(1.5); } }
        
        .nebula { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: radial-gradient(circle at 20% 80%, rgba(120,119,198,0.3) 0%, transparent 50%), 
            radial-gradient(circle at 80% 20%, rgba(255,0,255,0.2) 0%, transparent 50%); pointer-events: none; z-index: 2; animation: nebulaFloat 30s infinite; }
        @keyframes nebulaFloat { 0%,100% { transform: translate(0,0) scale(1); } 50% { transform: translate(20px, -20px) scale(1.05); } }
        
        .header {
            background: linear-gradient(90deg, rgba(0,255,255,0.1), rgba(255,0,255,0.1), rgba(0,255,0,0.1));
            backdrop-filter: blur(20px);
            padding: 1.5rem;
            text-align: center;
            border-bottom: 2px solid transparent;
            background-clip: padding-box;
            animation: rgbGlow 3s ease-in-out infinite alternate;
            position: relative; z-index: 10;
        }
        @keyframes rgbGlow { 0% { box-shadow: 0 0 20px #00ffff; } 33% { box-shadow: 0 0 20px #ff00ff; } 66% { box-shadow: 0 0 20px #00ff00; } 100% { box-shadow: 0 0 20px #ffff00; } }
        
        h1 { 
            font-size: clamp(2.5rem, 8vw, 5rem); 
            background: linear-gradient(45deg, #ff00ff, #00ffff, #00ff00, #ffff00, #ff0000);
            background-size: 300% 300%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: rainbowText 4s ease infinite, neonFlicker 2s infinite;
            text-shadow: 0 0 30px currentColor;
        }
        @keyframes rainbowText { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
        @keyframes neonFlicker { 0%,100% { opacity: 1; } 50% { opacity: 0.95; } }
        
        .nav { 
            display: flex; justify-content: center; gap: 1rem; margin: 1rem 0; flex-wrap: wrap; 
            position: relative; z-index: 10;
        }
        .nav button { 
            background: rgba(0,0,0,0.7); 
            backdrop-filter: blur(10px);
            color: #00ffff; 
            border: 2px solid transparent; 
            padding: 1rem 1.5rem; 
            cursor: pointer; 
            font-family: 'Orbitron', monospace;
            font-weight: 700;
            border-radius: 15px;
            transition: all 0.3s ease;
            position: relative; overflow: hidden;
        }
        .nav button::before {
            content: ''; position: absolute; top: 0; left: -100%; width: 100%; height: 100%; background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent); transition: 0.5s;
        }
        .nav button:hover::before { left: 100%; }
        .nav button:hover { 
            transform: translateY(-5px) scale(1.05); 
            box-shadow: 0 10px 30px rgba(0,255,255,0.5); 
            border-color: #00ffff;
        }
        
        .container { 
            max-width: 1400px; margin: 0 auto; padding: 2rem; display: grid; 
            grid-template-columns: 1fr 350px; gap: 2rem; position: relative; z-index: 10;
        }
        @media (max-width: 1024px) { .container { grid-template-columns: 1fr; } }
        
        .games { display: grid; grid-template-columns: repeat(auto-fit, minmax(450px, 1fr)); gap: 2rem; }
        .game { 
            background: rgba(0,0,0,0.6); 
            backdrop-filter: blur(20px);
            padding: 2rem; 
            border-radius: 25px; 
            border: 1px solid rgba(0,255,255,0.3);
            box-shadow: 0 20px 40px rgba(0,0,0,0.5), inset 0 1px 0 rgba(255,255,255,0.1);
            transition: all 0.4s ease;
        }
        .game:hover { transform: translateY(-10px); box-shadow: 0 30px 60px rgba(0,255,255,0.3); }
        
        .game canvas { 
            background: radial-gradient(circle, #000 0%, #001100 50%, #000 100%);
            border: 3px solid #00ff00; 
            border-radius: 15px; 
            box-shadow: inset 0 0 30px rgba(0,255,0,0.3), 0 0 30px rgba(0,255,0,0.5);
            display: block; margin: 1rem auto;
        }
        
        .sidebar { 
            background: rgba(0,0,0,0.6); 
            backdrop-filter: blur(20px);
            padding: 2rem; 
            border-radius: 25px; 
            border: 1px solid rgba(255,0,255,0.3);
            height: fit-content;
            box-shadow: 0 20px 40px rgba(0,0,0,0.5);
        }
        
        .auth-panel.hidden { display: none !important; }
        .auth-panel { 
            background: rgba(0,0,0,0.9); 
            padding: 2rem; 
            border-radius: 20px; 
            border: 2px solid #ff00ff;
            margin-bottom: 1rem;
            box-shadow: 0 0 50px rgba(255,0,255,0.5);
            animation: pulseGlow 2s infinite;
        }
        @keyframes pulseGlow { 0% { box-shadow: 0 0 20px #ff00ff; } 50% { box-shadow: 0 0 40px #ff00ff; } 100% { box-shadow: 0 0 20px #ff00ff; } }
        
        .auth-panel input { 
            width: 100%; margin: 0.5rem 0; padding: 1rem; 
            background: rgba(0,0,0,0.8); border: 1px solid #00ffff; 
            color: #00ffff; border-radius: 10px; font-size: 1.1rem;
        }
        .user-info { color: #ffff00; font-weight: bold; text-align: center; margin: 1rem 0; }
        
        .difficulty { display: flex; flex-wrap: wrap; gap: 1rem; margin: 1rem 0; align-items: center; }
        .difficulty select, .btn { 
            background: linear-gradient(45deg, #333, #555); 
            color: #00ffff; border: 2px solid #00ffff; 
            padding: 0.8rem 1.2rem; border-radius: 10px; cursor: pointer; 
            font-family: 'Orbitron', monospace; transition: all 0.3s;
        }
        .btn:hover { background: linear-gradient(45deg, #00ffff, #ff00ff); color: #000; transform: scale(1.05); }
        
        .chat { height: 350px; overflow-y: auto; background: rgba(0,0,0,0.8); border: 2px solid #ff00ff; padding: 1rem; margin-bottom: 1rem; border-radius: 15px; }
        .chat div { margin: 0.3rem 0; padding: 0.5rem; background: rgba(255,255,255,0.05); border-radius: 10px; }
        .chat-input { display: flex; gap: 1rem; }
        .chat-input input { flex: 1; background: rgba(0,0,0,0.8); border: 1px solid #ff00ff; color: #00ffff; padding: 1rem; border-radius: 10px; }
        
        .tournament { background: rgba(0,255,0,0.1); padding: 1.5rem; border-radius: 15px; margin: 1rem 0; border: 2px solid #00ff00; }
        .countdown { font-size: 1.5rem; font-weight: 900; color: #ffff00; text-shadow: 0 0 20px #ffff00; }
        .top10 { font-size: 0.95rem; max-height: 300px; overflow-y: auto; }
        .top10 div { padding: 0.5rem; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .top10 .gold { color: #ffd700; } .top10 .silver { color: #c0c0c0; } .top10 .bronze { color: #cd7f32; }
        
        .score { font-weight: 900; color: #00ff41; text-shadow: 0 0 15px #00ff41; font-size: 1.3rem; }
        .hidden { display: none !important; }
        
        /* –ó–≤—É–∫–æ–≤—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã */
        audio { display: none; }
    </style>
</head>
<body>
    <div class="stars" id="stars"></div>
    <div class="nebula"></div>
    
    <header class="header">
        <h1>üåå ALEKSIN COSMIC GAMES üåå</h1>
        <div id="userInfo" class="user-info hidden">üë§ –ì–æ—Å—Ç—å | <button class="btn" onclick="logout()" style="font-size:0.9rem;">üö™ –í—ã—Ö–æ–¥</button></div>
    </header>

    <nav class="nav">
        <button onclick="showGame('auth')" id="authBtn" style="background: linear-gradient(45deg, #ff0000, #ff6600);">üîê –í—Ö–æ–¥/–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
        <button onclick="showGame('snake')">üêç –ö–æ—Å–º–∏—á–µ—Å–∫–∞—è –ó–º–µ–π–∫–∞</button>
        <button onclick="showGame('guess')">üéØ –ì–∞–ª–∞–∫—Ç–∏—á–µ—Å–∫–∞—è –£–≥–∞–¥–∞–π–∫–∞</button>
        <button onclick="showGame('tournaments')">‚öîÔ∏è –¢—É—Ä–Ω–∏—Ä—ã (–¢–æ–ø-100)</button>
        <button onclick="showGame('top10')">üèÜ –ì–ª–æ–±–∞–ª—å–Ω—ã–π –¢–æ–ø-10</button>
    </nav>

    <div class="container">
        <main class="games">
            <!-- –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è -->
            <div id="auth" class="game">
                <h2>üîê –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π –í—Ö–æ–¥</h2>
                <div class="auth-panel" id="loginPanel">
                    <input id="username" placeholder="üë§ –ù–∏–∫–Ω–µ–π–º (test)" maxlength="20">
                    <input id="password" type="password" placeholder="üîë –ü–∞—Ä–æ–ª—å (123456)" maxlength="20">
                    <button class="btn" style="width:100%; margin-top:1rem;" onclick="login()">üöÄ –í–û–ô–¢–ò</button>
                    <button class="btn" style="width:100%; background: linear-gradient(45deg, #00ff00, #00ff88);" onclick="register()">‚ûï –†–ï–ì–ò–°–¢–†–ê–¶–ò–Ø</button>
                    <div style="text-align:center; margin-top:1rem; color:#ffff00;">test / 123456</div>
                </div>
            </div>

            <!-- –ó–º–µ–π–∫–∞ -->
            <div id="snake" class="game hidden">
                <h2>üêç –ö–æ—Å–º–∏—á–µ—Å–∫–∞—è –ó–º–µ–π–∫–∞</h2>
                <div class="difficulty">
                    <label>‚≠ê –°–ª–æ–∂–Ω–æ—Å—Ç—å:</label>
                    <select id="snakeDiff">
                        <option value="1">üåü –õ–µ–≥–∫–æ (x1 —Å–∫–æ—Ä–æ—Å—Ç—å)</option>
                        <option value="2">‚≠ê‚≠ê –ù–æ—Ä–º–∞–ª—å–Ω–æ (x2)</option>
                        <option value="3">‚≠ê‚≠ê‚≠ê –•–∞—Ä–¥–∫–æ—Ä (x3)</option>
                    </select>
                    <button class="btn" onclick="startSnake()">üöÄ –°–¢–ê–†–¢</button>
                    <button class="btn" onclick="saveSnakeScore()">üíæ –í –¢—É—Ä–Ω–∏—Ä</button>
                </div>
                <canvas id="snakeCanvas" width="500" height="500"></canvas>
                <div>–°—á—ë—Ç: <span id="snakeScore" class="score">0</span> | –†–µ–∫–æ—Ä–¥: <span id="snakeHigh" class="score">0</span></div>
            </div>

            <!-- –£–≥–∞–¥–∞–π–∫–∞ -->
            <div id="guess" class="game hidden">
                <h2>üéØ –ì–∞–ª–∞–∫—Ç–∏—á–µ—Å–∫–∞—è –£–≥–∞–¥–∞–π–∫–∞</h2>
                <div class="difficulty">
                    <label>‚≠ê –£—Ä–æ–≤–µ–Ω—å:</label>
                    <select id="guessDiff">
                        <option value="1000">üåü 1-1,000</option>
                        <option value="10000">‚≠ê‚≠ê 1-10,000</option>
                        <option value="100000">‚≠ê‚≠ê‚≠ê 1-100,000</option>
                    </select>
                    <button class="btn" onclick="startGuess()">üîÑ –ù–û–í–ê–Ø –ò–ì–†–ê</button>
                    <button class="btn" onclick="saveGuessScore()">üíæ –í –¢—É—Ä–Ω–∏—Ä</button>
                </div>
                <div>–ó–∞–≥–∞–¥–∞–Ω–æ: 1 - <span id="guessRange">1000</span> | –ü–æ–ø—ã—Ç–æ–∫: <span id="guessTries" class="score">0</span></div>
                <input type="number" id="guessNum" placeholder="–í–≤–µ–¥–∏ —á–∏—Å–ª–æ" style="width:60%; padding:1rem; font-size:1.2rem;">
                <button class="btn" onclick="checkGuess()" style="width:35%;">üîç –£–ì–ê–î–ê–¢–¨</button>
                <div id="guessHint" style="margin-top:1rem; font-size:1.2rem;"></div>
            </div>

            <!-- –¢—É—Ä–Ω–∏—Ä—ã -->
            <div id="tournaments" class="game">
                <h2>‚öîÔ∏è –ö–û–°–ú–ò–ß–ï–°–ö–ò–ï –¢–£–†–ù–ò–†–´ (–¢–æ–ø-100)</h2>
                <div class="tournament">
                    <div>üïê –°–ª–µ–¥—É—é—â–∏–π —Å–±—Ä–æ—Å: <span class="countdown" id="tournamentTimer">--:--:--</span> (00:00 –ú–°–ö)</div>
                    <div>–¢–≤–æ–∏ –æ—á–∫–∏: <span id="myTournamentScore" class="score">0</span></div>
                </div>
                <div id="tournamentTop" class="top10">–ó–∞–≥—Ä—É–∑–∫–∞ —Ç–æ–ø-100...</div>
            </div>

            <!-- –¢–æ–ø-10 -->
            <div id="top10" class="game hidden">
                <h2>üèÜ –ì–õ–û–ë–ê–õ–¨–ù–´–ô –¢–û–ü-10</h2>
                <div style="display:grid; grid-template-columns:1fr 1fr; gap:2rem;">
                    <div>
                        <h3 style="color:#00ffff;">üêç –ó–º–µ–π–∫–∞ (–í—Å–µ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏)</h3>
                        <div id="snakeTop" class="top10">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                    </div>
                    <div>
                        <h3 style="color:#ff00ff;">üéØ –£–≥–∞–¥–∞–π–∫–∞ (–í—Å–µ —É—Ä–æ–≤–Ω–∏)</h3>
                        <div id="guessTop" class="top10">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                    </div>
                </div>
            </div>
        </main>

        <aside class="sidebar">
            <h3>üåê –ì–ê–õ–ê–ö–¢–ò–ß–ï–°–ö–ò–ô –ß–ê–¢</h3>
            <div id="chatLog" class="chat"></div>
            <div class="chat-input">
                <input id="chatMsg" placeholder="üí¨ –¢–≤–æ—ë —Å–æ–æ–±—â–µ–Ω–∏–µ..." maxlength="120">
                <button class="btn" onclick="sendChat()">üì§ –û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
            </div>
        </aside>
    </div>

    <audio id="eatSound" src="data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+Pwt"></audio>
    <audio id="gameOverSound" src="data:audio/wav;base64,UklGRl4GAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+Pwt"></audio>

    <script>
        const socket = io();
        let currentUser = null, snakeInterval, guessGame = {}, snakeData = {};
        const sounds = { eat: document.getElementById('eatSound'), gameover: document.getElementById('gameOverSound') };

        // –°–æ–∑–¥–∞—Ç—å –∑–≤—ë–∑–¥—ã
        function createStars() {
            const stars = document.getElementById('stars');
            for (let i = 0; i < 200; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.style.left = Math.random() * 100 + '%';
                star.style.top = Math.random() * 100 + '%';
                star.style.width = star.style.height = (Math.random() * 3 + 1) + 'px';
                star.style.animationDelay = Math.random() * 3 + 's';
                stars.appendChild(star);
            }
        }

        // –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
        function login() {
            const user = document.getElementById('username').value.trim();
            const pass = document.getElementById('password').value.trim();
            if (!user || !pass) return alert('üë§ –ù–∏–∫ –∏ üîë –ø–∞—Ä–æ–ª—å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã!');
            
            localStorage.setItem('user', user);
            localStorage.setItem('pass', pass);
            currentUser = user;
            document.getElementById('userInfo').classList.remove('hidden');
            document.getElementById('userInfo').innerHTML = `üë§ ${user.toUpperCase()} | <button class="btn" onclick="logout()">üö™ –í—ã—Ö–æ–¥</button>`;
            document.getElementById('loginPanel').classList.add('hidden');
            document.getElementById('authBtn').style.display = 'none';
            socket.emit('login', user);
            loadAllData();
            playSound('eat');
        }

        function register() { login(); } // –û–¥–Ω–∞ –∫–Ω–æ–ø–∫–∞ –¥–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã
        
        function logout() {
            currentUser = null;
            localStorage.clear();
            document.getElementById('userInfo').classList.add('hidden');
            document.getElementById('loginPanel').classList.remove('hidden');
            document.getElementById('authBtn').style.display = 'block';
            document.querySelectorAll('.game:not(#auth)').forEach(g => g.classList.add('hidden'));
            playSound('gameover');
        }

        // –ó–≤—É–∫–∏
        function playSound(type) { sounds[type].currentTime = 0; sounds[type].play().catch(() => {}); }

        // –ù–∞–≤–∏–≥–∞—Ü–∏—è
        function showGame(id) {
            if (!currentUser && id !== 'auth') return alert('üîê –°–Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏!');
            document.querySelectorAll('.game').forEach(g => g.classList.add('hidden'));
            document.getElementById(id).classList.remove('hidden');
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
        function loadAllData() {
            const data = JSON.parse(localStorage.getItem('globalData') || '{}');
            document.getElementById('snakeHigh').textContent = data.snakeHigh || 0;
            document.getElementById('myTournamentScore').textContent = data.tournament?.[currentUser] || 0;
            updateTops(data.tops || {});
            updateTournament(data.tournamentTop || []);
            updateTimer();
            setInterval(updateTimer, 1000);
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
        function saveGlobalData(key, value) {
            const data = JSON.parse(localStorage.getItem('globalData') || '{}');
            data[key] = value;
            localStorage.setItem('globalData', JSON.stringify(data));
            socket.emit('update_data', data);
        }

        // –ß–∞—Ç
        socket.on('chat_msg', (msg) => {
            const chat = document.getElementById('chatLog');
            chat.innerHTML += `<div><strong>${msg.user}:</strong> ${msg.text}</div>`;
            chat.scrollTop = chat.scrollHeight;
        });

        function sendChat() {
            const msg = document.getElementById('chatMsg').value.trim();
            if (!msg || !currentUser) return;
            socket.emit('chat_msg', { user: currentUser, text: msg });
            document.getElementById('chatMsg').value = '';
        }

        // –¢–∞–π–º–µ—Ä —Ç—É—Ä–Ω–∏—Ä–∞ (00:00 –ú–°–ö)
        function updateTimer() {
            const now = new Date();
            const mskOffset = 3 * 60 * 60 * 1000; // MSK +3
            const mskNow = new Date(now.getTime() + mskOffset);
            const tomorrow = new Date(mskNow);
            tomorrow.setDate(tomorrow.getDate() + 1);
            tomorrow.setHours(0, 0, 0, 0);
            const diff = tomorrow.getTime() - mskNow.getTime();
            const h = Math.floor(diff / 3600000);
            const m = Math.floor((diff % 3600000) / 60000);
            const s = Math.floor((diff % 60000) / 1000);
            document.getElementById('tournamentTimer').textContent = `${h}:${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–ø–æ–≤
        function updateTops(tops) {
            ['snakeTop', 'guessTop'].forEach(id => {
                const el = document.getElementById(id);
                const top = tops[id.replace('Top', '')] || [];
                el.innerHTML = top.slice(0,10).map((p,i) => 
                    `<div class="${['gold','silver','bronze'][i] || ''}"> ${i+1}. ${p.name} - ${p.score}</div>`
                ).join('') || '–ü—É—Å—Ç–æ...';
            });
        }

        function updateTournament(top) {
            const el = document.getElementById('tournamentTop');
            el.innerHTML = top.slice(0,100).map((p,i) => 
                `<div class="${i<5 ? ['gold','silver','bronze'][i] || '' : ''}"> ${i+1}. ${p.name} - ${p.score} (${p.game})</div>`
            ).join('') || '–¢—É—Ä–Ω–∏—Ä –ø—É—Å—Ç...';
        }

        // –ó–º–µ–π–∫–∞
        function startSnake() {
            const diff = parseInt(document.getElementById('snakeDiff').value);
            const canvas = document.getElementById('snakeCanvas');
            const ctx = canvas.getContext('2d');
            canvas.width = canvas.height = 500;
            snakeData = {
                x: 10, y: 10, dx: 1, dy: 0, cells: [{x:10,y:10}], maxCells: 3, score: 0,
                grid: 25, tilesX: 20, tilesY: 20, speed: 150 - (diff * 50), diff
            };
            document.getElementById('snakeScore').textContent = '0';
            snakeInterval = setInterval(() => {
                ctx.clearRect(0,0,500,500);
                
                const head = {x: snakeData.x, y: snakeData.y};
                snakeData.x += snakeData.dx;
                snakeData.y += snakeData.dy;
                
                // –ì—Ä–∞–Ω–∏—Ü—ã
                if (snakeData.x < 0 || snakeData.x >= snakeData.tilesX || snakeData.y < 0 || snakeData.y >= snakeData.tilesY) {
                    gameOverSnake();
                    return;
                }
                
                snakeData.cells.unshift(head);
                if (snakeData.cells.length > snakeData.maxCells) snakeData.cells.pop();
                
                // –ï–¥–∞
                if (!snakeData.foodX) {
                    snakeData.foodX = Math.floor(Math.random() * snakeData.tilesX);
                    snakeData.foodY = Math.floor(Math.random() * snakeData.tilesY);
                }
                
                ctx.fillStyle = 'rgba(0,255,255,0.8)';
                snakeData.cells.forEach((cell,i) => {
                    const g = snakeData.grid;
                    const gradient = ctx.createRadialGradient(cell.x*g + g/4, cell.y*g + g/4, 0, cell.x*g + g/2, cell.y*g + g/2, g/2);
                    gradient.addColorStop(0, i===0 ? '#00ffff' : '#00aa88');
                    gradient.addColorStop(1, 'rgba(0,170,136,0.3)');
                    ctx.fillStyle = gradient;
                    ctx.fillRect(cell.x*g, cell.y*g, g-2, g-2);
                });
                
                // –ö—Ä–∞—Å–∏–≤–∞—è –µ–¥–∞
                const fx = snakeData.foodX * snakeData.grid, fy = snakeData.foodY * snakeData.grid;
                const foodGrad = ctx.createRadialGradient(fx + 8, fy + 8, 0, fx + 12, fy + 12, 20);
                foodGrad.addColorStop(0, '#ff4400');
                foodGrad.addColorStop(0.7, '#ffaa00');
                foodGrad.addColorStop(1, 'rgba(255,170,0,0)');
                ctx.fillStyle = foodGrad;
                ctx.beginPath();
                ctx.arc(fx+12, fy+12, 18, 0, Math.PI*2);
                ctx.fill();
                
                if (snakeData.foodX === snakeData.x && snakeData.foodY === snakeData.y) {
                    snakeData.maxCells++;
                    snakeData.score++;
                    document.getElementById('snakeScore').textContent = snakeData.score;
                    playSound('eat');
                    snakeData.foodX = snakeData.foodY = null;
                }
                
                // –°–∞–º–æ–ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–µ
                for (let i=1; i<snakeData.cells.length; i++) {
                    if (snakeData.cells[i].x === snakeData.x && snakeData.cells[i].y === snakeData.y) {
                        gameOverSnake();
                        return;
                    }
                }
            }, snakeData.speed);
        }
        
        function gameOverSnake() {
            clearInterval(snakeInterval);
            playSound('gameover');
            const high = Math.max(snakeData.score, parseInt(localStorage.getItem('snakeHigh') || 0));
            localStorage.setItem('snakeHigh', high);
            document.getElementById('snakeHigh').textContent = high;
            alert(`üí• Game Over! –°—á—ë—Ç: ${snakeData.score}`);
        }
        
        function saveSnakeScore() {
            if (!snakeData.score || !currentUser) return;
            saveGlobalData('tops.snakeTop', [...(JSON.parse(localStorage.getItem('globalData')?.tops?.snakeTop || [])), 
                {name: currentUser, score: snakeData.score, time: Date.now()}].sort((a,b)=>b.score-a.score));
            // –¢—É—Ä–Ω–∏—Ä
            const tourScore = snakeData.score * 10;
            updateTournamentScore(tourScore, '–ó–º–µ–π–∫–∞');
        }
        
        document.addEventListener('keydown', e => {
            if (!snakeInterval) return;
            if (e.key === 'ArrowLeft' && snakeData.dx !== 1) { snakeData.dx = -1; snakeData.dy = 0; }
            if (e.key === 'ArrowUp' && snakeData.dy !== 1) { snakeData.dx = 0; snakeData.dy = -1; }
            if (e.key === 'ArrowRight' && snakeData.dx !== -1) { snakeData.dx = 1; snakeData.dy = 0; }
            if (e.key === 'ArrowDown' && snakeData.dy !== -1) { snakeData.dx = 0; snakeData.dy = 1; }
        });

        // –£–≥–∞–¥–∞–π–∫–∞
        function startGuess() {
            guessGame.max = parseInt(document.getElementById('guessDiff').value);
            guessGame.target = Math.floor(Math.random() * guessGame.max) + 1;
            guessGame.tries = 0;
            document.getElementById('guessRange').textContent = guessGame.max.toLocaleString();
            document.getElementById('guessTries').textContent = '0';
            document.getElementById('guessHint').innerHTML = 'üöÄ –ù–æ–≤–∞—è –∏–≥—Ä–∞! –î–∏–∞–ø–∞–∑–æ–Ω –æ–±–Ω–æ–≤–ª—ë–Ω.';
            document.getElementById('guessNum').value = '';
        }

        function checkGuess() {
            const guess = parseInt(document.getElementById('guessNum').value);
            if (!guess || guess < 1 || guess > guessGame.max) return alert('‚ùå –ß–∏—Å–ª–æ –≤–Ω–µ –¥–∏–∞–ø–∞–∑–æ–Ω–∞!');
            
            guessGame.tries++;
            document.getElementById('guessTries').textContent = guessGame.tries;
            let hint = '';
            
            if (guess === guessGame.target) {
                const score = Math.max(0, 1000000 / guessGame.tries);
                hint = `üéâ –£–ì–ê–î–ê–õ –∑–∞ ${guessGame.tries} –ø–æ–ø—ã—Ç–æ–∫! –û—á–∫–∏: ${score.toFixed(0)}`;
                playSound('eat');
            } else if (guess < guessGame.target) {
                hint = `üìà –ë–æ–ª—å—à–µ! –û—Å—Ç–∞–ª–æ—Å—å —á–∏—Å–µ–ª: ${guessGame.target - guess}/${guessGame.max - guess}`;
            } else {
                hint = `üìâ –ú–µ–Ω—å—à–µ! –û—Å—Ç–∞–ª–æ—Å—å —á–∏—Å–µ–ª: ${guess - guessGame.target}/${guess - 1}`;
            }
            document.getElementById('guessHint').innerHTML = `${guess}? ‚Üí ${hint}`;
        }

        function saveGuessScore() {
            if (!guessGame.tries || !currentUser) return;
            const score = Math.max(0, 1000000 / guessGame.tries);
            saveGlobalData('tops.guessTop', [...(JSON.parse(localStorage.getItem('globalData')?.tops?.guessTop || [])), 
                {name: currentUser, score: score, time: Date.now()}].sort((a,b)=>b.score-a.score));
            updateTournamentScore(score, '–£–≥–∞–¥–∞–π–∫–∞');
        }

        // –¢—É—Ä–Ω–∏—Ä
        function updateTournamentScore(score, game) {
            const data = JSON.parse(localStorage.getItem('globalData') || '{}');
            data.tournament = data.tournament || {};
            data.tournament[currentUser] = (data.tournament[currentUser] || 0) + score;
            data.tournamentTop = Object.entries(data.tournament).map(([name,score]) => ({name,score,game})).sort((a,b)=>b.score-a.score);
            saveGlobalData('tournament', data.tournament);
            saveGlobalData('tournamentTop', data.tournamentTop);
            document.getElementById('myTournamentScore').textContent = data.tournament[currentUser];
        }

        // Socket —Å–æ–±—ã—Ç–∏—è
        socket.on('global_data', data => {
            localStorage.setItem('globalData', JSON.stringify(data));
            loadAllData();
        });

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        window.onload = () => {
            createStars();
            const savedUser = localStorage.getItem('user');
            if (savedUser) {
                currentUser = savedUser;
                document.getElementById('userInfo').classList.remove('hidden');
                document.getElementById('userInfo').innerHTML = `üë§ ${savedUser.toUpperCase()} | <button class="btn" onclick="logout()">üö™ –í—ã—Ö–æ–¥</button>`;
                document.getElementById('authBtn').style.display = 'none';
                loadAllData();
            }
            socket.emit('get_data');
            document.getElementById('chatMsg').addEventListener('keypress', e => e.key === 'Enter' && sendChat());
        };
    </script>
</body>
</html>
