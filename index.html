<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ì–µ–π–º–∏–Ω–≥ –•–∞–± - –ó–º–µ–π–∫–∞, –£–≥–∞–¥–∞–π–∫–∞, –¢—É—Ä–Ω–∏—Ä—ã</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.5/socket.io.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Courier New', monospace; background: #1a1a1a; color: #00ff00; overflow-x: hidden; }
        .header { background: #000; padding: 1rem; text-align: center; border-bottom: 2px solid #00ff00; }
        .nav { display: flex; justify-content: center; gap: 2rem; margin: 1rem 0; flex-wrap: wrap; }
        .nav button { background: #333; color: #00ff00; border: 1px solid #00ff00; padding: 0.5rem 1rem; cursor: pointer; }
        .nav button:hover { background: #00ff00; color: #000; }
        .container { max-width: 1200px; margin: 0 auto; padding: 1rem; display: grid; grid-template-columns: 1fr 300px; gap: 1rem; }
        .games { display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 1rem; }
        .game { background: #222; padding: 1rem; border-radius: 5px; border: 1px solid #444; }
        .game canvas { background: #000; border: 1px solid #00ff00; display: block; margin: 0 auto 1rem; }
        .sidebar { background: #222; padding: 1rem; border-radius: 5px; border: 1px solid #444; height: fit-content; }
        .chat { height: 300px; overflow-y: auto; background: #111; border: 1px solid #00ff00; padding: 0.5rem; margin-bottom: 1rem; }
        .chat-input { display: flex; gap: 0.5rem; }
        .chat-input input { flex: 1; background: #333; border: 1px solid #00ff00; color: #00ff00; padding: 0.5rem; }
        .chat-input button { background: #00ff00; color: #000; border: none; padding: 0.5rem 1rem; cursor: pointer; }
        .tournament { margin: 1rem 0; }
        .top10 { font-size: 0.8rem; }
        .difficulty { display: flex; gap: 0.5rem; margin: 0.5rem 0; }
        .difficulty select, .difficulty button { background: #333; color: #00ff00; border: 1px solid #00ff00; padding: 0.3rem; }
        .score { font-weight: bold; color: #00ff41; }
        .hidden { display: none; }
        @media (max-width: 768px) { .container { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
    <div class="header">
        <h1>üéÆ –ì–ï–ô–ú–ò–ù–ì –•–ê–ë</h1>
        <div>–ó–º–µ–π–∫–∞ | –£–≥–∞–¥–∞–π–∫–∞ | –¢—É—Ä–Ω–∏—Ä—ã | –¢–æ–ø-10 | –ì–ª–æ–±–∞–ª—å–Ω—ã–π –ß–∞—Ç</div>
    </div>

    <nav class="nav">
        <button onclick="showGame('snake')">üêç –ó–º–µ–π–∫–∞</button>
        <button onclick="showGame('guess')">üéØ –£–≥–∞–¥–∞–π–∫–∞</button>
        <button onclick="showGame('tournaments')">üèÜ –¢—É—Ä–Ω–∏—Ä—ã</button>
        <button onclick="showGame('top10')">üìä –¢–æ–ø-10</button>
    </nav>

    <div class="container">
        <main class="games">
            <!-- –ó–º–µ–π–∫–∞ -->
            <div id="snake" class="game hidden">
                <h2>üêç –ó–º–µ–π–∫–∞</h2>
                <div class="difficulty">
                    <label>–°–ª–æ–∂–Ω–æ—Å—Ç—å:</label>
                    <select id="snake-difficulty">
                        <option value="1">–õ–µ–≥–∫–æ (400px)</option>
                        <option value="2">–°—Ä–µ–¥–Ω–µ (300px)</option>
                        <option value="3">–°–ª–æ–∂–Ω–æ (200px)</option>
                    </select>
                    <button onclick="startSnake()">–°—Ç–∞—Ä—Ç</button>
                    <button onclick="saveSnakeScore()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –¢—É—Ä–Ω–∏—Ä</button>
                </div>
                <canvas id="snakeCanvas" width="400" height="400"></canvas>
                <div>–°—á—ë—Ç: <span id="snakeScore" class="score">0</span></div>
            </div>

            <!-- –£–≥–∞–¥–∞–π–∫–∞ -->
            <div id="guess" class="game hidden">
                <h2>üéØ –£–≥–∞–¥–∞–π–∫–∞</h2>
                <div class="difficulty">
                    <label>–î–∏–∞–ø–∞–∑–æ–Ω:</label>
                    <select id="guess-difficulty">
                        <option value="1000">1-1000 (–õ–µ–≥–∫–æ)</option>
                        <option value="10000">1-10000 (–°—Ä–µ–¥–Ω–µ)</option>
                        <option value="100000">1-100000 (–°–ª–æ–∂–Ω–æ)</option>
                    </select>
                    <button onclick="startGuess()">–ù–æ–≤–∞—è –∏–≥—Ä–∞</button>
                    <button onclick="saveGuessScore()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –¢—É—Ä–Ω–∏—Ä</button>
                </div>
                <div>–ó–∞–≥–∞–¥–∞–Ω–æ —á–∏—Å–ª–æ –æ—Ç 1 –¥–æ <span id="guessMax">1000</span></div>
                <input type="number" id="guessInput" placeholder="–¢–≤–æ–π –≤–∞—Ä–∏–∞–Ω—Ç" min="1">
                <button onclick="checkGuess()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
                <div id="guessFeedback"></div>
                <div>–ü–æ–ø—ã—Ç–æ–∫: <span id="guessAttempts" class="score">0</span></div>
            </div>

            <!-- –¢—É—Ä–Ω–∏—Ä—ã -->
            <div id="tournaments" class="game">
                <h2>üèÜ –¢—É—Ä–Ω–∏—Ä—ã</h2>
                <div class="tournament">
                    <div>–¢–µ–∫—É—â–∏–π —Ç—É—Ä–Ω–∏—Ä: <span id="tournamentName">–ó–∏–º–Ω–∏–π ‚Ññ1</span></div>
                    <div id="countdown">–û—Å—Ç–∞–ª–æ—Å—å: <span id="timer">--:--:--</span></div>
                    <div>–¢–≤–æ–π —Å—á—ë—Ç: <span id="playerTournamentScore" class="score">0</span></div>
                </div>
            </div>

            <!-- –¢–æ–ø-10 -->
            <div id="top10" class="game hidden">
                <h2>üìä –ì–ª–æ–±–∞–ª—å–Ω—ã–π –¢–æ–ø-10</h2>
                <div id="leaderboard">
                    <div>–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                </div>
            </div>
        </main>

        <aside class="sidebar">
            <div class="chat-container">
                <h3>üåê –ì–ª–æ–±–∞–ª—å–Ω—ã–π –ß–∞—Ç</h3>
                <div id="chatMessages" class="chat"></div>
                <div class="chat-input">
                    <input id="chatInput" placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ..." maxlength="100">
                    <button onclick="sendChatMessage()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
                </div>
            </div>
        </aside>
    </div>

    <script>
        const socket = io();
        let currentGame = null;
        let snakeGame, guessGame = { attempts: 0, target: 0, max: 1000 };

        // –ù–∞–≤–∏–≥–∞—Ü–∏—è
        function showGame(gameId) {
            document.querySelectorAll('.game').forEach(g => g.classList.add('hidden'));
            document.getElementById(gameId).classList.remove('hidden');
            currentGame = gameId;
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.onload = () => {
            showGame('tournaments');
            updateTournamentTimer();
            setInterval(updateTournamentTimer, 1000);
            loadLeaderboard();
            socket.emit('join', 'global');
        };

        // –ì–ª–æ–±–∞–ª—å–Ω—ã–π —á–∞—Ç
        socket.on('chat_message', (data) => {
            const chat = document.getElementById('chatMessages');
            chat.innerHTML += `<div>[${data.time}] ${data.user}: ${data.msg}</div>`;
            chat.scrollTop = chat.scrollHeight;
        });

        function sendChatMessage() {
            const input = document.getElementById('chatInput');
            const msg = input.value.trim();
            if (msg) {
                socket.emit('chat_message', { msg, room: 'global' });
                input.value = '';
            }
        }

        document.getElementById('chatInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') sendChatMessage();
        });

        // –¢–∞–π–º–µ—Ä —Ç—É—Ä–Ω–∏—Ä–∞
        function updateTournamentTimer() {
            const now = new Date();
            const end = new Date(now.getTime() + 24 * 60 * 60 * 1000); // 24 —á–∞—Å–∞
            const diff = end - now;
            const h = Math.floor(diff / 3600000);
            const m = Math.floor((diff % 3600000) / 60000);
            const s = Math.floor((diff % 60000) / 1000);
            document.getElementById('timer').textContent = `${h}:${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
        }

        // –ó–º–µ–π–∫–∞
        let snake = { x: 200, y: 200, dx: 20, dy: 0, cells: [], maxCells: 4 };
        let snakeScore = 0;
        let snakeCanvas, snakeCtx;

        function startSnake() {
            const diff = parseInt(document.getElementById('snake-difficulty').value);
            const sizes = [400, 300, 200];
            document.getElementById('snakeCanvas').width = sizes[diff-1];
            document.getElementById('snakeCanvas').height = sizes[diff-1];
            snakeCanvas = document.getElementById('snakeCanvas');
            snakeCtx = snakeCanvas.getContext('2d');
            snakeScore = 0;
            snake.cells = [];
            snake.maxCells = 4;
            snake.x = snakeCanvas.width / 2;
            snake.y = snakeCanvas.height / 2;
            snake.dx = 20 * diff;
            snake.dy = 0;
            document.getElementById('snakeScore').textContent = '0';
            snakeGame = setInterval(updateSnake, 150 / diff);
        }

        function updateSnake() {
            snakeCtx.clearRect(0, 0, snakeCanvas.width, snakeCanvas.height);
            
            snake.x += snake.dx;
            snake.y += snake.dy;

            if (snake.x < 0 || snake.x >= snakeCanvas.width || snake.y < 0 || snake.y >= snakeCanvas.height) {
                clearInterval(snakeGame);
                alert(`–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞! –°—á—ë—Ç: ${snakeScore}`);
                return;
            }

            snake.cells.unshift({ x: snake.x, y: snake.y });
            if (snake.cells.length > snake.maxCells) snake.cells.pop();

            snakeCtx.fillStyle = '#00ff00';
            snakeCtx.fillRect(snake.x, snake.y, 18, 18);

            snakeCtx.fillStyle = 'red';
            if (!snake.foodX) {
                snake.foodX = Math.floor(Math.random() * (snakeCanvas.width / 20)) * 20;
                snake.foodY = Math.floor(Math.random() * (snakeCanvas.height / 20)) * 20;
            }
            snakeCtx.fillRect(snake.foodX, snake.foodY, 18, 18);

            if (snake.foodX === snake.x && snake.foodY === snake.y) {
                snake.maxCells++;
                snakeScore++;
                document.getElementById('snakeScore').textContent = snakeScore;
                snake.foodX = Math.floor(Math.random() * (snakeCanvas.width / 20)) * 20;
                snake.foodY = Math.floor(Math.random() * (snakeCanvas.height / 20)) * 20;
            }

            for (let cell of snake.cells.slice(1)) {
                if (cell.x === snake.x && cell.y === snake.y) {
                    clearInterval(snakeGame);
                    alert(`–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞! –°—á—ë—Ç: ${snakeScore}`);
                    return;
                }
                snakeCtx.fillRect(cell.x, cell.y, 18, 18);
            }
        }

        document.addEventListener('keydown', (e) => {
            if (!snakeGame) return;
            if (e.key === 'ArrowLeft' && snake.dx === 0) { snake.dx = -20; snake.dy = 0; }
            if (e.key === 'ArrowUp' && snake.dy === 0) { snake.dx = 0; snake.dy = -20; }
            if (e.key === 'ArrowRight' && snake.dx === 0) { snake.dx = 20; snake.dy = 0; }
            if (e.key === 'ArrowDown' && snake.dy === 0) { snake.dx = 0; snake.dy = 20; }
        });

        function saveSnakeScore() {
            socket.emit('save_score', { game: 'snake', score: snakeScore });
        }

        // –£–≥–∞–¥–∞–π–∫–∞
        function startGuess() {
            guessGame.max = parseInt(document.getElementById('guess-difficulty').value);
            document.getElementById('guessMax').textContent = guessGame.max;
            guessGame.target = Math.floor(Math.random() * guessGame.max) + 1;
            guessGame.attempts = 0;
            document.getElementById('guessAttempts').textContent = '0';
            document.getElementById('guessFeedback').textContent = '–ó–∞–≥–∞–¥–∞–π —á–∏—Å–ª–æ –∏ –ø—Ä–æ–±—É–π!';
            document.getElementById('guessInput').value = '';
        }

        function checkGuess() {
            const guess = parseInt(document.getElementById('guessInput').value);
            guessGame.attempts++;
            document.getElementById('guessAttempts').textContent = guessGame.attempts;

            if (guess === guessGame.target) {
                document.getElementById('guessFeedback').innerHTML = `‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ! –ó–∞ ${guessGame.attempts} –ø–æ–ø—ã—Ç–æ–∫!`;
            } else if (guess < guessGame.target) {
                document.getElementById('guessFeedback').textContent = 'üìà –ë–æ–ª—å—à–µ!';
            } else {
                document.getElementById('guessFeedback').textContent = 'üìâ –ú–µ–Ω—å—à–µ!';
            }
        }

        function saveGuessScore() {
            const score = Math.floor(10000 / (guessGame.attempts || 1));
            socket.emit('save_score', { game: 'guess', score });
        }

        // –õ–∏–¥–µ—Ä–±–æ—Ä–¥
        function loadLeaderboard() {
            socket.emit('get_leaderboard');
        }

        socket.on('leaderboard', (top10) => {
            const lb = document.getElementById('leaderboard');
            lb.innerHTML = top10.map((player, i) => 
                `<div>${i+1}. ${player.name} - ${player.score}</div>`
            ).join('');
        });
    </script>
</body>
</html>
