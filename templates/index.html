<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ò–≥—Ä–æ–≤–æ–π –•–∞–±</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <h1>üéÆ –ò–≥—Ä–æ–≤–æ–π –•–∞–± –ù–∞–∑–∞—Ä</h1>
        <div id="user-status">–ì–æ—Å—Ç—å</div>
        <button onclick="showAuth('register')">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
        <button onclick="showAuth('login')">–í—Ö–æ–¥</button>
        <button onclick="logout()" id="logout-btn" style="display:none">üö™ –í—ã–π—Ç–∏</button>
        
        <div class="games">
            <button class="game-btn" onclick="playGame('guess')">üéØ –£–≥–∞–¥–∞–π —á–∏—Å–ª–æ</button>
            <button class="game-btn" onclick="playGame('snake')">üêç –ó–º–µ–π–∫–∞</button>
        </div>
        
        <div id="game-area" style="display:none;"></div>
        <div id="leaderboard"></div>
    </div>

    <div id="auth-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeAuth()">&times;</span>
            <h3 id="modal-title">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h3>
            <input id="username" placeholder="–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è">
            <input id="password" type="password" placeholder="–ü–∞—Ä–æ–ª—å">
            <button onclick="authUser()">–í–æ–π—Ç–∏/–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
            <div id="auth-error"></div>
        </div>
    </div>

    <script>
        let currentGame = '';
        let isLoggedIn = false;

        // JS —Ñ—É–Ω–∫—Ü–∏–∏ (authUser, playGame, saveScore, loadLeaderboard) - —Ç–µ –∂–µ —á—Ç–æ –≤ –ø—Ä–æ—à–ª–æ–º –∫–æ–¥–µ
        function showAuth(type) {
            document.getElementById('modal-title').textContent = type === 'register' ? '–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è' : '–í—Ö–æ–¥';
            document.getElementById('auth-modal').style.display = 'flex';
        }
        function closeAuth() { document.getElementById('auth-modal').style.display = 'none'; }
        async function authUser() {
            // fetch –∫ /register –∏–ª–∏ /login
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const isRegister = document.getElementById('modal-title').textContent === '–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è';
            const res = await fetch(isRegister ? '/register' : '/login', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({username, password})
            });
            const data = await res.json();
            if (data.success) {
                isLoggedIn = true;
                document.getElementById('user-status').textContent = `–ü—Ä–∏–≤–µ—Ç, ${username}!`;
                document.getElementById('logout-btn').style.display = 'inline-block';
                closeAuth();
                loadLeaderboard(currentGame);
            } else {
                document.getElementById('auth-error').textContent = data.error || '–û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏';
            }
        }
        async function logout() {
            await fetch('/logout');
            location.reload();
        }
        async function saveScore(game, score) {
            if (!isLoggedIn) return alert('–ó–∞–ª–æ–≥–∏–Ω—å—Å—è!');
            await fetch('/save_score', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({game, score})
            });
        }
        async function loadLeaderboard(game) {
            if (!game) return;
            const res = await fetch(`/leaderboard/${game}`);
            const leaders = await res.json();
            let html = '<h3>üèÜ –¢–æ–ø-10</h3><ol>';
            leaders.forEach(l => html += `<li>${l.name}: ${l.score}</li>`);
            html += '</ol>';
            document.getElementById('leaderboard').innerHTML = html;
        }
        function playGame(game) {
            currentGame = game;
            loadLeaderboard(game);
            // –õ–æ–≥–∏–∫–∞ –∏–≥—Ä
            alert(`–ò–≥—Ä–∞ ${game} –∑–∞–ø—É—â–µ–Ω–∞! –î–æ–±–∞–≤—å canvas/–ª–æ–≥–∏–∫—É.`);
        }
    </script>
</body>
</html>
