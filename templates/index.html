        function updateLeaderboards() {
            let html = '<h2>üèÜ –¢–û–ü-10 –õ–ò–î–ï–†–ë–û–†–î–´</h2><div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:20px">';
            const games = ['snake', 'guess'];
            const diffs = ['easy', 'normal', 'hard'];
            
            games.forEach(game => {
                diffs.forEach(diff => {
                    const key = `${game}_${diff}`;
                    const top = Object.entries(leaderboards[key] || {})
                        .sort((a,b) => b[1] - a[1])
                        .slice(0,10)
                        .map(([user, score], i) => `<tr><td>${i+1}.</td><td>${user}</td><td>${score}</td></tr>`)
                        .join('') || '<tr><td colspan="3">–ü–æ–∫–∞ –ø—É—Å—Ç–æ</td></tr>';
                    html += `<div><h3>${game.toUpperCase()} ${diff}</h3><table><tr><th>‚Ññ</th><th>–ò–≥—Ä–æ–∫</th><th>–û—á–∫–∏</th></tr>${top}</table></div>`;
                });
            });
            html += '</div>';
            document.getElementById('leaderboardTables').innerHTML = html;
        }

        function updateTournament() {
            const now = new Date();
            const mskOffset = 3 * 60 * 60 * 1000;
            const mskNow = new Date(now.getTime() + mskOffset);
            const nextMidnight = new Date(mskNow.getFullYear(), mskNow.getMonth(), mskNow.getDate() + 1, 0, 0, 0);
            const timeLeft = nextMidnight - mskNow;
            
            const hours = Math.floor(timeLeft / (1000*60*60)).toString().padStart(2,'0');
            const minutes = Math.floor((timeLeft % (1000*60*60)) / (1000*60)).toString().padStart(2,'0');
            const seconds = Math.floor((timeLeft % (1000*60)) / 1000).toString().padStart(2,'0');
            document.getElementById('tourTimer').textContent = `${hours}:${minutes}:${seconds}`;

            let html = '';
            const games = ['snake', 'guess'];
            const diffs = ['easy', 'normal', 'hard'];
            
            games.forEach(game => {
                diffs.forEach(diff => {
                    const key = `${game}_${diff}`;
                    const top = Object.entries(tournamentScores[key] || {})
                        .sort((a,b) => b[1] - a[1])
                        .slice(0,10)
                        .map(([user, score], i) => `<tr><td>${i+1}.</td><td>${user}</td><td>${score}</td></tr>`)
                        .join('') || '<tr><td colspan="3">–ü–æ–∫–∞ –ø—É—Å—Ç–æ</td></tr>';
                    html += `
                        <div class="tour-table">
                            <h4>${game.toUpperCase()} ${diff}</h4>
                            <table><tr><th>‚Ññ</th><th>–ò–≥—Ä–æ–∫</th><th>–û—á–∫–∏</th></tr>${top}</table>
                        </div>
                    `;
                });
            });
            document.getElementById('tournamentTables').innerHTML = html;
        }

        function setDifficulty(game, diff) {
            currentGameType = game;
            currentDifficulty = diff;
            if (game === 'guess') {
                const ranges = {easy:1000, normal:10000, hard:100000};
                document.getElementById('rangeMin').textContent = '1';
                document.getElementById('rangeMax').textContent = ranges[diff];
                secretNumber = Math.floor(Math.random() * ranges[diff]) + 1;
                guessCount = 0;
                document.getElementById('guessResult').textContent = '';
                document.getElementById('guessAttempts').textContent = '–ü–æ–ø—ã—Ç–æ–∫: 0';
            }
        }

        function makeGuess() {
            const guess = parseInt(document.getElementById('guessInput').value);
            if (!guess) return;
            
            guessCount++;
            document.getElementById('guessAttempts').textContent = `–ü–æ–ø—ã—Ç–æ–∫: ${guessCount}`;
            
            if (guess === secretNumber) {
                const score = Math.max(10000 - guessCount * 50, 100);
                document.getElementById('guessResult').innerHTML = `üéâ –£–ì–ê–î–ê–õ! +${score} –æ—á–∫–æ–≤`;
                addScore('guess', currentDifficulty, score);
                setTimeout(() => setDifficulty('guess', currentDifficulty), 2000);
            } else if (guess < secretNumber) {
                document.getElementById('guessResult').textContent = 'üìà –ë–æ–ª—å—à–µ!';
            } else {
                document.getElementById('guessResult').textContent = 'üìâ –ú–µ–Ω—å—à–µ!';
            }
            document.getElementById('guessInput').value = '';
        }

        function startSnake(difficulty) {
            currentGameType = 'snake';
            currentDifficulty = difficulty;
            isSnakeActive = true;
            const canvas = document.getElementById('gameCanvas');
            const ctx = canvas.getContext('2d');
            const gridSize = 20;
            const tileCount = canvas.width / gridSize;
            
            food = {x: Math.floor(Math.random() * tileCount), y: Math.floor(Math.random() * tileCount)};
            snake = [{x:10,y:10}];
            snakeDirection = {x:1,y:0};
            snakeScore = 0;
            gameRunning = true;
            if (snakeInterval) clearInterval(snakeInterval);
            
            let touchStartX, touchStartY;
            canvas.addEventListener('touchstart', e => {
                touchStartX = e.touches[0].clientX;
                touchStartY = e.touches[0].clientY;
            }, {passive: true});
            
            canvas.addEventListener('touchmove', e => {
                e.stopPropagation();
                const deltaX = e.touches[0].clientX - touchStartX;
                const deltaY = e.touches[0].clientY - touchStartY;
                if (Math.abs(deltaX) > Math.abs(deltaY) && Math.abs(deltaX) > 30) {
                    snakeDirection = deltaX > 0 ? {x:1,y:0} : {x:-1,y:0};
                } else if (Math.abs(deltaY) > 30) {
                    snakeDirection = deltaY > 0 ? {x:0,y:1} : {x:0,y:-1};
                }
            }, {passive: false});
            
            canvas.focus();
            
            const speeds = {easy:200, normal:150, hard:100};
            
            function gameLoop() {
                if (!gameRunning) return;
                
                const head = {x:snake[0].x + snakeDirection.x, y:snake[0].y + snakeDirection.y};
                
                if (head.x < 0 || head.x >= tileCount || head.y < 0 || head.y >= tileCount || 
                    snake.some(s => s.x === head.x && s.y === head.y)) {
                    gameRunning = false;
                    isSnakeActive = false;
                    if (currentUser && snakeScore > 0) {
                        addScore('snake', difficulty, snakeScore);
                        alert(`üíÄ GAME OVER! ${snakeScore} –æ—á–∫–æ–≤`);
                    }
                    return;
                }
                
                snake.unshift(head);
                
                if (head.x === food.x && head.y === food.y) {
                    snakeScore += 10;
                    food = {x: Math.floor(Math.random() * tileCount), y: Math.floor(Math.random() * tileCount)};
                } else {
                    snake.pop();
                }
                
                ctx.fillStyle = 'black';
                ctx.fillRect(0,0,canvas.width,canvas.height);
                
                ctx.fillStyle = 'red';
                ctx.fillRect(food.x*gridSize, food.y*gridSize, gridSize-2, gridSize-2);
                
                ctx.fillStyle = '#00ff00';
                snake.forEach((segment, i) => {
                    ctx.fillStyle = i === 0 ? '#ff00ff' : '#00ff00';
                    ctx.fillRect(segment.x*gridSize, segment.y*gridSize, gridSize-2, gridSize-2);
                });
                
                document.getElementById('snakeScore').textContent = `–°—á—ë—Ç: ${snakeScore}`;
            }
            
            snakeInterval = setInterval(gameLoop, speeds[difficulty]);
        }
    </script>
</body>
</html>
