<!DOCTYPE html>
<html>
<head>
    <title>üéÆ –ò–≥—Ä–æ–≤–æ–π –•–∞–± –ù–∞–∑–∞—Ä</title>
    <meta charset="UTF-8">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #16213e 100%); 
            color: white; min-height: 100vh;
        }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        header { text-align: center; margin-bottom: 30px; }
        header h1 { font-size: 3em; color: #44ff44; text-shadow: 0 0 30px #44ff44; margin-bottom: 10px; }
        .status-bar { display: flex; justify-content: space-between; align-items: center; background: rgba(0,0,0,0.5); padding: 15px 30px; border-radius: 20px; backdrop-filter: blur(10px); }
        .games-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 25px; margin: 40px 0; }
        .game-btn { padding: 30px; font-size: 22px; background: linear-gradient(45deg, #44ff44, #00ff88); color: black; border: none; border-radius: 25px; cursor: pointer; font-weight: bold; transition: all 0.3s; box-shadow: 0 10px 30px rgba(68,255,68,0.4); }
        .game-btn:hover { transform: translateY(-8px); box-shadow: 0 15px 40px rgba(68,255,68,0.6); }
        .leaderboard { background: rgba(0,50,0,0.9); border-radius: 25px; padding: 30px; margin: 30px 0; border: 2px solid #44ff44; }
        .leaderboard h3 { color: #44ff44; text-align: center; font-size: 28px; margin-bottom: 25px; text-shadow: 0 0 15px #44ff44; }
        .leader-item { display: flex; justify-content: space-between; padding: 18px; background: rgba(68,255,68,0.15); margin: 12px 0; border-radius: 15px; border-left: 4px solid #44ff44; }
        .auth-buttons { display: flex; gap: 20px; justify-content: center; margin: 30px 0; }
        .auth-buttons button { padding: 18px 40px; font-size: 20px; border: none; border-radius: 20px; cursor: pointer; font-weight: bold; }
        .auth-buttons button:nth-child(1) { background: linear-gradient(45deg, #4488ff, #44aaff); color: white; box-shadow: 0 8px 25px rgba(68,136,255,0.4); }
        .auth-buttons button:nth-child(2) { background: linear-gradient(45deg, #ff8844, #ffaa66); color: white; box-shadow: 0 8px 25px rgba(255,136,68,0.4); }
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.85); backdrop-filter: blur(10px); }
        .modal-content { background: linear-gradient(145deg, #1a1a1a, #2a2a2a); margin: 8% auto; padding: 40px; border-radius: 25px; width: 90%; max-width: 500px; position: relative; box-shadow: 0 15px 50px rgba(0,255,68,0.3); border: 2px solid #44ff44; }
        .close { color: #ff4444; float: right; font-size: 40px; font-weight: bold; cursor: pointer; position: absolute; right: 25px; top: 20px; }
        .close:hover { color: #ff6666; }
        input { width: 100%; padding: 20px; margin: 20px 0; border-radius: 15px; border: 3px solid #44ff44; background: #000; color: #44ff44; font-size: 18px; box-sizing: border-box; }
        input::placeholder { color: #88ff88; }
        #warning-text { background: linear-gradient(145deg, rgba(255,165,0,0.3), rgba(255,140,0,0.2)); border: 3px solid #ffaa00; border-radius: 20px; padding: 25px; margin: 20px 0; color: #ff8800; font-size: 16px; text-align: left; box-shadow: 0 10px 35px rgba(255,170,0,0.5); }
        button.auth-btn { width: 100%; padding: 22px; font-size: 22px; background: linear-gradient(45deg, #44ff44, #00ff88); color: black; border: none; border-radius: 20px; font-weight: bold; cursor: pointer; box-shadow: 0 10px 30px rgba(68,255,68,0.4); margin-top: 15px; }
        #error { color: #ff4444; margin: 15px 0; font-weight: bold; font-size: 16px; text-align: center; }
        #gameCanvas { display: block; margin: 20px auto; background: rgba(0,0,0,0.95); border: 4px solid #44ff44; border-radius: 20px; box-shadow: 0 0 40px #44ff44; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üéÆ –ò–≥—Ä–æ–≤–æ–π –•–∞–± –ù–∞–∑–∞—Ä</h1>
            <div class="status-bar">
                <span id="status">üëã –ì–æ—Å—Ç—å</span>
                <button id="logout" onclick="logout()" style="display:none;background:#ff4444;color:white;border:none;border-radius:10px;padding:10px 20px;cursor:pointer;font-weight:bold">üö™ –í—ã–π—Ç–∏</button>
            </div>
        </header>

        <div class="auth-buttons" id="auth-buttons">
            <button onclick="showAuth('login')">üîë –í–•–û–î</button>
            <button onclick="showAuth('register')">üìù –†–ï–ì–ò–°–¢–†–ê–¶–ò–Ø</button>
        </div>

        <div class="games-grid">
            <button class="game-btn" onclick="loadGame('guess')">üéØ –£–≥–∞–¥–∞–π —á–∏—Å–ª–æ</button>
            <button class="game-btn" onclick="loadGame('snake')">üêç –ó–º–µ–π–∫–∞</button>
        </div>

        <div id="game-container" style="display:none">
            <canvas id="gameCanvas" width="600" height="500" style="display:none"></canvas>
        </div>

        <div id="leaderboard" class="leaderboard" style="display:none">
            <h3>üèÜ –¢–û–ü-10 –ò–ì–†–û–ö–û–í</h3>
            <div id="leaders-list"></div>
        </div>
    </div>

    <div id="auth-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeAuth()">&times;</span>
            <h2 id="modal-title">üîë –í–•–û–î</h2>
            <div id="warning-text" style="display:none">
                <strong style="color:#ff6600;font-size:18px">‚ö†Ô∏è –í–ê–ñ–ù–û–ï –°–û–û–ë–©–ï–ù–ò–ï:</strong><br><br>
                –ï—Å–ª–∏ –ø—Ä–∏ –≤—Ö–æ–¥–µ –≤ –∞–∫–∫–∞—É–Ω—Ç –≤–∞—Å <strong style="color:#ff4400">–Ω–µ –∑–∞–º–µ—á–∞—é—Ç</strong> ‚Äî 
                –∑–Ω–∞—á–∏—Ç –ø—Ä–æ–≤–µ–ª–∏—Å—å —Ä–∞–±–æ—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞—é—Ç —Å–∞–π—Ç, 
                –≤ —Ç–æ–º —á–∏—Å–ª–µ —Ä–µ–∫–æ—Ä–¥—ã –∏ –ª–æ–≥–∏–Ω—ã.<br><br>
                <strong style="color:#ff6600">–ë–ª–∞–≥–æ–¥–∞—Ä–∏–º –∑–∞ —á—Ç–µ–Ω–∏–µ! üôè</strong>
            </div>
            <input type="text" id="username" placeholder="üë§ –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–º–∏–Ω–∏–º—É–º 3 —Å–∏–º–≤–æ–ª–∞)">
            <input type="password" id="password" placeholder="üîí –ü–∞—Ä–æ–ª—å (–º–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤)">
            <div id="error"></div>
            <button class="auth-btn" onclick="authUser()">‚úÖ –ì–û–¢–û–í–û</button>
        </div>
    </div>

    <script>
        let currentGame = '';
        let isLoggedIn = false;
        let gameData = { highscore: 0 };
        let snakeGame = null;

        // üî• –ê–í–¢–û–°–¢–ê–†–¢
        checkUserStatus();

        async function checkUserStatus() {
            try {
                const res = await fetch('/status', { credentials: 'include' });
                const data = await res.json();
                if (data.logged_in) {
                    document.getElementById('status').textContent = `üëã ${data.username}`;
                    document.getElementById('auth-buttons').style.display = 'none';
                    document.getElementById('logout').style.display = 'inline-block';
                    isLoggedIn = true;
                    loadLeaderboard();
                }
            } catch (e) {
                console.log('üëã –ì–æ—Å—Ç—å');
            }
        }

        async function authUser() {
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value;
            const mode = document.getElementById('modal-title').dataset.mode;
            const errorDiv = document.getElementById('error');
            
            if (username.length < 3) {
                errorDiv.textContent = '‚ùå –ò–º—è —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–æ–µ (–º–∏–Ω–∏–º—É–º 3 —Å–∏–º–≤–æ–ª–∞)';
                return;
            }
            if (password.length < 6) {
                errorDiv.textContent = '‚ùå –ü–∞—Ä–æ–ª—å —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–π (–º–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤)';
                return;
            }
            
            try {
                const res = await fetch('/auth', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    credentials: 'include',
                    body: JSON.stringify({ username, password, mode })
                });
                const data = await res.json();
                if (data.success) {
                    closeAuth();
                    checkUserStatus();
                } else {
                    errorDiv.textContent = data.message || '‚ùå –û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏';
                }
            } catch (e) {
                errorDiv.textContent = 'üîå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏ ‚Äî –ø–æ–¥–æ–∂–¥–∏—Ç–µ 1 –º–∏–Ω—É—Ç—É';
            }
        }

        function showAuth(mode) {
            console.log('üîß showAuth:', mode);
            document.getElementById('auth-modal').style.display = 'flex';
            const modalTitle = document.getElementById('modal-title');
            modalTitle.textContent = mode === 'register' ? 'üìù –†–ï–ì–ò–°–¢–†–ê–¶–ò–Ø' : 'üîë –í–•–û–î';
            modalTitle.dataset.mode = mode;
            
            const warning = document.getElementById('warning-text');
            if (warning) {
                warning.style.display = mode === 'register' ? 'block' : 'none';
            }
            
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
            document.getElementById('error').textContent = '';
            document.getElementById('username').focus();
        }

        function closeAuth() {
            document.getElementById('auth-modal').style.display = 'none';
        }

        async function logout() {
            try {
                await fetch('/logout', { credentials: 'include' });
            } catch (e) {}
            isLoggedIn = false;
            document.getElementById('status').textContent = 'üëã –ì–æ—Å—Ç—å';
            document.getElementById('auth-buttons').style.display = 'flex';
            document.getElementById('logout').style.display = 'none';
            document.getElementById('leaders-list').innerHTML = '';
            document.getElementById('leaderboard').style.display = 'none';
        }

        async function loadLeaderboard() {
            try {
                const res = await fetch('/leaderboard', { credentials: 'include' });
                const data = await res.json();
                const list = document.getElementById('leaders-list');
                list.innerHTML = '';
                data.slice(0, 10).forEach((player, i) => {
                    const div = document.createElement('div');
                    div.className = 'leader-item';
                    div.innerHTML = `<span>${i+1}. ${player.username}</span><span>${player.highscore}</span>`;
                    list.appendChild(div);
                });
                document.getElementById('leaderboard').style.display = 'block';
            } catch (e) {}
        }

        function loadGame(game) {
            currentGame = game;
            document.querySelector('.games-grid').style.display = 'none';
            document.getElementById('leaderboard').style.display = 'none';
            document.getElementById('game-container').style.display = 'block';
            
            if (game === 'guess') {
                loadGuessNumber();
            } else if (game === 'snake') {
                loadSnake();
            }
        }

        function backToMenu() {
            document.querySelector('.games-grid').style.display = 'grid';
            document.getElementById('game-container').style.display = 'none';
            document.getElementById('gameCanvas').style.display = 'none';
            if (snakeGame) {
                clearInterval(snakeGame);
                snakeGame = null;
            }
            currentGame = '';
        }

        // üéØ –£–ì–ê–î–ê–ô –ß–ò–°–õ–û ‚Äî –ë–ï–ó –í–´–õ–ï–¢–ê
        function loadGuessNumber() {
            document.getElementById('gameCanvas').style.display = 'none';
            document.getElementById('game-container').innerHTML = `
                <div style="text-align:center;padding:50px;background:rgba(0,50,0,0.95);border-radius:25px;border:3px solid #44ff44;margin:20px">
                    <h2 style="color:#44ff44;font-size:2.5em;margin-bottom:20px">üéØ –£–ì–ê–î–ê–ô –ß–ò–°–õ–û (1-100)</h2>
                    <p style="color:#ccc;font-size:1.2em;margin-bottom:20px">–õ—É—á—à–∞—è –ø–æ–ø—ã—Ç–∫–∞: <strong style="color:#ffaa00">${gameData.highscore || 0}</strong></p>
                    <input type="number" id="guess-input" min="1" max="100" style="padding:20px;font-size:1.5em;width:60%;border-radius:15px;border:3px solid #44ff44;background:#000;color:#44ff44;margin:30px 0">
                    <br>
                    <button onclick="checkGuess()" style="padding:20px 50px;font-size:1.5em;background:#44ff44;color:black;border:none;border-radius:15px;cursor:pointer;font-weight:bold;margin:20px">‚úÖ –£–ì–ê–î–ê–¢–¨</button>
                    <p id="guess-feedback" style="font-size:1.5em;color:#ffaa00;font-weight:bold;margin:30px 0"></p>
                    <button onclick="backToMenu()" style="padding:15px 40px;background:#ff4444;color:white;border:none;border-radius:15px;cursor:pointer;font-size:1.2em;font-weight:bold">üîô –í –ú–ï–ù–Æ</button>
                </div>
            `;
            document.getElementById('guess-input').focus();
        }

        function checkGuess() {
            const input = document.getElementById('guess-input');
            const feedback = document.getElementById('guess-feedback');
            const guess = parseInt(input.value);
            
            if (isNaN(guess) || guess < 1 || guess > 100) {
                feedback.textContent = '‚ùå –í–≤–µ–¥–∏ —á–∏—Å–ª–æ –æ—Ç 1 –¥–æ 100!';
                return;
            }
            
            const target = Math.floor(Math.random() * 100) + 1;
            let message;
            
            if (guess === target) {
                message = `üéâ –£–ì–ê–î–ê–õ! –ë—ã–ª–æ ${target}`;
                if (gameData.highscore === 0 || guess < gameData.highscore) {
                    gameData.highscore = guess;
                    saveScore();
                }
            } else if (guess < target) {
                message = `üìà –ó–∞–≥–∞–¥–∞–Ω–Ω–æ–µ —á–∏—Å–ª–æ –ë–û–õ–¨–®–ï —á–µ–º ${guess}`;
            } else {
                message = `üìâ –ó–∞–≥–∞–¥–∞–Ω–Ω–æ–µ —á–∏—Å–ª–æ –ú–ï–ù–¨–®–ï —á–µ–º ${guess}`;
            }
            
            feedback.textContent = message;
        }

        // üêç –ó–ú–ï–ô–ö–ê ‚Äî –ë–ï–ó –í–´–õ–ï–¢–ê
        function loadSnake() {
            const canvas = document.getElementById('gameCanvas');
            canvas.style.display = 'block';
            
            const ctx = canvas.getContext('2d');
            const grid = 20;
            let snake = [{x: 10, y: 10}];
            let food = {x: 15, y: 15};
            let dx = 0, dy = 0;
            let score = 0;

            function draw() {
                ctx.fillStyle = '#000';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                // –ó–º–µ–π–∫–∞
                ctx.fillStyle = '#44ff44';
                snake.forEach(part => {
                    ctx.fillRect(part.x * grid, part.y * grid, grid - 2, grid - 2);
                });
                
                // –ï–¥–∞
                ctx.fillStyle = '#ff4444';
                ctx.fillRect(food.x * grid, food.y * grid, grid - 2, grid - 2);
                
                // –°—á–µ—Ç
                ctx.fillStyle = '#44ff44';
                ctx.font = 'bold 28px Arial';
                ctx.textAlign = 'left';
                ctx.fillText(`–û—á–∫–∏: ${score}`, 20, 40);
            }

            function update() {
                const head = {x: snake[0].x + dx, y: snake[0].y + dy};
                
                // –°—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–µ —Å–æ —Å—Ç–µ–Ω–æ–π
                if (head.x < 0 || head.x >= 30 || head.y < 0 || head.y >= 25) {
                    gameOver(score);
                    return;
                }
                
                // –°–∞–º–æ–ø–æ–µ–¥–∞–Ω–∏–µ
                for (let part of snake) {
                    if (head.x === part.x && head.y === part.y) {
                        gameOver(score);
                        return;
                    }
                }
                
                snake.unshift(head);
                
                // –ï–¥–∞
                if (head.x === food.x && head.y === food.y) {
                    score++;
                    food = {
                        x: Math.floor(Math.random() * 30),
                        y: Math.floor(Math.random() * 25)
                    };
                } else {
                    snake.pop();
                }
                
                draw();
            }

            function gameOver(finalScore) {
                if (finalScore > gameData.highscore) {
                    gameData.highscore = finalScore;
                    saveScore();
                }
                alert(`üêç –ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞!\n–û—á–∫–∏: ${finalScore}\n–†–µ–∫–æ—Ä–¥: ${gameData.highscore}`);
                backToMenu();
            }

            // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
            document.addEventListener('keydown', (e) => {
                if (e.key === 'ArrowUp' && dy !== 1) { dx = 0; dy = -1; }
                if (e.key === 'ArrowDown' && dy !== -1) { dx = 0; dy = 1; }
                if (e.key === 'ArrowLeft' && dx !== 1) { dx = -1; dy = 0; }
                if (e.key === 'ArrowRight' && dx !== -1) { dx = 1; dy = 0; }
            });

            draw();
            snakeGame = setInterval(update, 120);
        }

        async function saveScore() {
            if (!isLoggedIn) return;
            try {
                await fetch('/save-score', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    credentials: 'include',
                    body: JSON.stringify({ highscore: gameData.highscore })
                });
            } catch (e) {}
        }
    </script>
</body>
</html>
