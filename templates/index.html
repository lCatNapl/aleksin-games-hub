<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üåå ALEKSIN COSMIC GAMES HUB</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            background: radial-gradient(circle at 20% 80%, #0a0a23 0%, #1a1a3e 50%, #000428 100%);
            font-family: 'Arial Black', Arial; color: #00ff88; min-height: 100vh;
            overflow-x: hidden; position: relative;
        }
        .stars {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none;
            background-image: 
                radial-gradient(1.5px 1.5px at 20px 30px, #eee, transparent),
                radial-gradient(1.5px 1.5px at 80px 70px, #fff, transparent),
                radial-gradient(1px 1px at 120px 40px, #00ff88, transparent);
            background-repeat: repeat; background-size: 150px 150px;
            animation: twinkle 6s linear infinite; z-index: -1;
        }
        @keyframes twinkle { 0%{opacity: 0.6; transform: translateY(0px) rotate(0deg);} 50%{opacity: 1;} 100%{opacity: 0.6; transform: translateY(-10px) rotate(180deg);} }
        
        .container { max-width: 1300px; margin: 0 auto; padding: 25px; }
        .panel { 
            background: linear-gradient(145deg, rgba(0,20,40,0.95), rgba(0,0,20,0.95)); 
            border: 2px solid; border-image: linear-gradient(45deg, #00ff88, #ff0080) 1; 
            border-radius: 25px; padding: 35px; margin: 25px 0; 
            box-shadow: 0 20px 60px rgba(0,255,136,0.3), inset 0 1px 0 rgba(255,255,255,0.1);
        }
        .hidden { display: none !important; }
        
        .user-panel {
            position: fixed; top: 25px; right: 25px; background: rgba(0,0,0,0.95); 
            border: 3px solid linear-gradient(45deg, #ff0080, #00ff88); border-radius: 35px;
            padding: 18px 28px; font-size: 20px; font-weight: bold; z-index: 1000;
            box-shadow: 0 10px 40px rgba(255,0,128,0.4);
        }
        
        h1 { font-size: 2.8em; text-align: center; margin-bottom: 30px;
            background: linear-gradient(45deg, #00ff88 0%, #ff0080 33%, #0080ff 66%, #ffaa00 100%);
            background-size: 300% 300%; animation: gradientShift 3s ease infinite;
            -webkit-background-clip: text; -webkit-text-fill-color: transparent; font-weight: 900;
        }
        @keyframes gradientShift { 0%,100%{background-position:0% 50%} 50%{background-position:100% 50%} }
        
        input { 
            width: 100%; padding: 22px 25px; margin: 15px 0; border: 3px solid transparent;
            border-radius: 20px; background: linear-gradient(rgba(0,0,0,0.9), rgba(20,20,40,0.9));
            color: #00ff88; font-size: 20px; font-weight: bold; backdrop-filter: blur(10px);
            box-shadow: inset 0 2px 10px rgba(0,0,0,0.5);
        }
        input:focus { outline: none; border-color: #00ff88; box-shadow: 0 0 25px rgba(0,255,136,0.5); }
        
        button { 
            width: 100%; padding: 22px 25px; margin: 12px 0; background: linear-gradient(45deg, #00ff88, #0080ff);
            border: none; border-radius: 20px; color: #000; font-size: 22px; font-weight: 900;
            cursor: pointer; transition: all 0.3s ease; position: relative; overflow: hidden;
            box-shadow: 0 8px 25px rgba(0,255,136,0.4);
        }
        button:hover { 
            transform: translateY(-3px) scale(1.02); box-shadow: 0 15px 40px rgba(0,255,136,0.6);
            background: linear-gradient(45deg, #0080ff, #00ff88);
        }
        button.tournament { 
            background: linear-gradient(45deg, #ff0080, #ff6600) !important; font-size: 24px !important;
            box-shadow: 0 10px 35px rgba(255,0,128,0.5) !important;
        }
        button.tournament:hover { box-shadow: 0 15px 45px rgba(255,0,128,0.7) !important; }
        
        .game-btn { display: block; padding: 28px 30px; margin: 20px 0; background: linear-gradient(45deg, #ff0080, #00ff88, #0080ff);
            color: white; text-decoration: none; text-align: center; font-size: 24px; font-weight: 900; border-radius: 25px;
            box-shadow: 0 12px 35px rgba(255,0,128,0.4);
        }
        .game-btn:hover { transform: translateY(-3px) scale(1.02); box-shadow: 0 20px 50px rgba(255,0,128,0.6); }
        
        canvas { border: 4px solid; border-image: linear-gradient(45deg, #00ff88, #ff0080) 1; border-radius: 25px; 
            background: radial-gradient(circle, #001122 0%, #000 70%); display: block; margin: 25px auto;
            box-shadow: 0 15px 50px rgba(0,255,136,0.4), inset 0 0 50px rgba(0,0,0,0.8); }
        
        .leaderboard { max-height: 280px; overflow-y: auto; margin: 25px 0; padding-right: 10px; }
        .leaderboard div { 
            padding: 18px 22px; margin: 10px 0; background: linear-gradient(90deg, rgba(0,255,136,0.15), rgba(255,0,128,0.15));
            border-left: 6px solid; border-radius: 15px; display: flex; justify-content: space-between;
            font-weight: bold; font-size: 18px; cursor: pointer; transition: all 0.3s;
            box-shadow: 0 5px 20px rgba(0,0,0,0.3);
        }
        .leaderboard div:hover { transform: translateX(5px); box-shadow: 0 8px 25px rgba(0,255,136,0.3); }
        .rank1 { border-left-color: #ffd700 !important; background: linear-gradient(90deg, rgba(255,215,0,0.3), rgba(255,215,0,0.1)) !important; }
        .rank2 { border-left-color: #c0c0c0 !important; background: linear-gradient(90deg, rgba(192,192,192,0.3), rgba(192,192,192,0.1)) !important; }
        .rank3 { border-left-color: #cd7f32 !important; background: linear-gradient(90deg, rgba(205,127,50,0.3), rgba(205,127,50,0.1)) !important; }
        
        .timer { font-size: 28px; color: #ffaa00; text-align: center; margin: 25px 0; font-weight: 900; font-family: monospace; }
        .score { font-size: 26px; text-align: center; color: #ffaa00; margin: 20px 0; font-weight: 900; }
        .feedback { font-size: 24px; text-align: center; margin: 25px 0; min-height: 50px; color: #ffaa00; font-weight: bold; }
        
        @media (max-width: 768px) {
            .container { padding: 15px; }
            .panel { padding: 25px 20px; margin: 15px 0; }
            h1 { font-size: 2em; }
            button, .game-btn { padding: 18px 20px; font-size: 18px; }
        }
    </style>
</head>
<body>
    <div class="stars"></div>
    
    <!-- –ü–†–û–§–ò–õ–¨ -->
    <div class="user-panel hidden" id="userPanel">
        üëë <span id="currentNick"></span> | 
        <button onclick="logoutUser()" style="width:auto; padding:12px 24px; font-size:18px; margin-left:15px; border-radius:20px;">üö™ –í–´–•–û–î</button>
    </div>
    
    <div class="container">
        <!-- –õ–û–ì–ò–ù/–†–ï–ì–ò–°–¢–†–ê–¶–ò–Ø -->
        <div class="panel" id="loginPanel">
            <h1>üåå ALEKSIN GAMES HUB</h1>
            <input type="text" id="username" placeholder="üë§ –í–≤–µ–¥–∏ –Ω–∏–∫ (3+ —Å–∏–º–≤–æ–ª–æ–≤)" maxlength="15">
            <input type="password" id="password" placeholder="üîê –ü–∞—Ä–æ–ª—å (3+ —Å–∏–º–≤–æ–ª–æ–≤)">
            <button onclick="loginUser()">‚úÖ –í–û–ô–¢–ò</button>
            <button onclick="registerNewUser()">‚≠ê –°–û–ó–î–ê–¢–¨ –ê–ö–ö–ê–£–ù–¢</button>
        </div>
        
        <!-- –ì–õ–ê–í–ù–û–ï –ú–ï–ù–Æ –° –¢–û–ü-10 -->
        <div class="panel hidden" id="mainMenu">
            <h1>üéÆ –ì–õ–ê–í–ù–û–ï –ú–ï–ù–Æ</h1>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin: 35px 0;">
                <!-- –ó–ú–ï–ô–ö–ê -->
                <div>
                    <div class="game-btn" onclick="showSnakeMenu()" style="cursor:pointer; height:80px; display:flex; align-items:center; justify-content:center;">
                        üêç –ó–ú–ï–ô–ö–ê PRO (3 —Å–ª–æ–∂–Ω–æ—Å—Ç–∏)
                    </div>
                    <h2 style="color:#00ff88; margin:20px 0 10px 0; font-size:1.4em;">üèÜ –¢–û–ü-10 –ó–ú–ï–ô–ö–ê</h2>
                    <div class="leaderboard" id="snakeTop10"></div>
                </div>
                
                <!-- –£–ì–ê–î–ê–ô–ö–ê -->
                <div>
                    <div class="game-btn" onclick="showGuessMenu()" style="cursor:pointer; height:80px; display:flex; align-items:center; justify-content:center;">
                        üéØ –£–ì–ê–î–ê–ô –ß–ò–°–õ–û (1-100,000)
                    </div>
                    <h2 style="color:#ff0080; margin:20px 0 10px 0; font-size:1.4em;">üèÜ –¢–û–ü-10 –£–ì–ê–î–ê–ô–ö–ê</h2>
                    <div class="leaderboard" id="guessTop10"></div>
                </div>
            </div>
            <button class="tournament" onclick="showTournamentsPanel()">‚öîÔ∏è –¢–£–†–ù–ò–†–´ (–ø—Ä–∏–∑—ã –¢–û–ü-3!)</button>
        </div>
        
        <!-- –ú–ï–ù–Æ –ó–ú–ï–ô–ö–ò -->
        <div class="panel hidden" id="snakeMenu">
            <h1>üêç –ó–ú–ï–ô–ö–ê - –í–´–ë–ï–†–ò –°–õ–û–ñ–ù–û–°–¢–¨</h1>
            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 25px; margin: 40px 0;">
                <button onclick="startSnakeGame(1)">üêå –õ–ï–ì–ö–ê–Ø<br><span style="font-size:16px;">–ú–µ–¥–ª–µ–Ω–Ω–æ +10 –æ—á–∫–æ–≤</span></button>
                <button onclick="startSnakeGame(2)">üêç –ù–û–†–ú–ê–õ–¨–ù–ê–Ø<br><span style="font-size:16px;">–°—Ç–∞–Ω–¥–∞—Ä—Ç +20 –æ—á–∫–æ–≤</span></button>
                <button onclick="startSnakeGame(3)">‚ö° –°–õ–û–ñ–ù–ê–Ø<br><span style="font-size:16px;">–ë—ã—Å—Ç—Ä–æ +30 –æ—á–∫–æ–≤</span></button>
                <button class="tournament" onclick="joinSnakeTournamentDirect()">‚öîÔ∏è –¢–£–†–ù–ò–† –ó–ú–ï–ô–ö–ê</button>
            </div>
            <button onclick="backToMainFromSnake()">üè† –ì–õ–ê–í–ù–û–ï –ú–ï–ù–Æ</button>
        </div>
                <!-- –ú–ï–ù–Æ –£–ì–ê–î–ê–ô–ö–ò -->
        <div class="panel hidden" id="guessMenu">
            <h1>üéØ –£–ì–ê–î–ê–ô –ß–ò–°–õ–û - –í–´–ë–ï–†–ò –£–†–û–í–ï–ù–¨</h1>
            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 25px; margin: 40px 0;">
                <button onclick="startGuessGame(1)">1Ô∏è‚É£ –õ–ï–ì–ö–ò–ô<br><span style="font-size:16px;">1-1,000</span></button>
                <button onclick="startGuessGame(2)">2Ô∏è‚É£ –°–†–ï–î–ù–ò–ô<br><span style="font-size:16px;">1-10,000</span></button>
                <button onclick="startGuessGame(3)">3Ô∏è‚É£ –°–õ–û–ñ–ù–´–ô<br><span style="font-size:16px;">1-100,000</span></button>
                <button class="tournament" onclick="joinGuessTournamentDirect()">‚öîÔ∏è –¢–£–†–ù–ò–† –£–ì–ê–î–ê–ô–ö–ê</button>
            </div>
            <button onclick="backToMainFromGuess()">üè† –ì–õ–ê–í–ù–û–ï –ú–ï–ù–Æ</button>
        </div>
        
        <!-- –¢–£–†–ù–ò–†–´ -->
        <div class="panel hidden" id="tournamentsPanel">
            <h1>‚öîÔ∏è –¢–£–†–ù–ò–†–´ (–ø—Ä–∏–∑—ã –¢–û–ü-3 –∫–∞–∂–¥—ã–µ 24—á!)</h1>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin: 40px 0;">
                <div class="panel">
                    <h2 style="color:#00ff88;">üêç –¢–£–†–ù–ò–† –ó–ú–ï–ô–ö–ê</h2>
                    <div class="timer" id="snakeTimer">--:--:--</div>
                    <div class="leaderboard" id="snakeTourLeaderboard"></div>
                    <button class="tournament" onclick="enterSnakeTournament()">‚öîÔ∏è –í–°–¢–£–ü–ò–¢–¨ (–±–µ—Å–ø–ª–∞—Ç–Ω–æ)</button>
                </div>
                <div class="panel">
                    <h2 style="color:#ff0080;">üéØ –¢–£–†–ù–ò–† –£–ì–ê–î–ê–ô–ö–ê</h2>
                    <div class="timer" id="guessTimer">--:--:--</div>
                    <div class="leaderboard" id="guessTourLeaderboard"></div>
                    <button class="tournament" onclick="enterGuessTournament()">‚öîÔ∏è –í–°–¢–£–ü–ò–¢–¨ (–±–µ—Å–ø–ª–∞—Ç–Ω–æ)</button>
                </div>
            </div>
            <div style="text-align:center; font-size:18px; color:#ffaa00; margin:20px 0;">
                ü•á 1-–µ: 1000‚ÇΩ Steam | ü•à 2-–µ: 500‚ÇΩ | ü•â 3-–µ: 250‚ÇΩ
            </div>
            <button onclick="backToMainFromTournaments()" style="font-size:24px;">üè† –ì–õ–ê–í–ù–û–ï –ú–ï–ù–Æ</button>
        </div>
        
        <!-- –ò–ì–†–ê –ó–ú–ï–ô–ö–ê -->
        <div class="panel hidden" id="snakeGame">
            <h1>üêç –ó–ú–ï–ô–ö–ê PRO</h1>
            <canvas id="gameCanvas" width="550" height="550"></canvas>
            <div class="score">
                –û—á–∫–∏: <span id="currentScore">0</span> | 
                –†–µ–∫–æ—Ä–¥: <span id="snakePersonalRecord">0</span> | 
                –°–ª–æ–∂–Ω–æ—Å—Ç—å: <span id="currentSnakeLevel">1</span>
            </div>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                <button onclick="restartCurrentGame()">üîÑ –ù–û–í–ê–Ø –ò–ì–†–ê</button>
                <button onclick="backToSnakeMenu()">üîô –ú–ï–ù–Æ –ó–ú–ï–ô–ö–ò</button>
            </div>
        </div>
        
        <!-- –ò–ì–†–ê –£–ì–ê–î–ê–ô–ö–ê -->
        <div class="panel hidden" id="guessGame">
            <h1>üéØ –£–ì–ê–î–ê–ô –ß–ò–°–õ–û</h1>
            <div class="score">
                –£—Ä–æ–≤–µ–Ω—å: <span id="currentGuessLevel">1</span> | 
                –î–∏–∞–ø–∞–∑–æ–Ω: <span id="currentRange">1-1000</span> | 
                –ü–æ–ø—ã—Ç–æ–∫: <span id="guessCount">0</span>
            </div>
            <div class="feedback" id="guessHint">–í—ã–±–µ—Ä–∏ —É—Ä–æ–≤–µ–Ω—å –¥–ª—è –Ω–∞—á–∞–ª–∞ –∏–≥—Ä—ã</div>
            <input type="number" id="numberInput" placeholder="üéØ –¢–≤–æ—ë —á–∏—Å–ª–æ">
            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin: 25px 0;">
                <button onclick="checkNumberGuess()">‚úÖ –ü–†–û–í–ï–†–ò–¢–¨</button>
                <button onclick="nextGuessLevel()">üîÑ –ù–û–í–´–ô –£–†–û–í–ï–ù–¨</button>
                <button onclick="backToGuessMenu()">üîô –ú–ï–ù–Æ –£–ì–ê–î–ê–ô–ö–ò</button>
            </div>
        </div>
    </div>

    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let currentUser = '';
        let currentGame = null; // 'snake' –∏–ª–∏ 'guess'
        let snake = { running: false, score: 0, level: 1, x: 275, y: 275, dx: 0, dy: 20, cells: [], maxCells: 4, food: null };
        let guess = { level: 1, target: 0, attempts: 0, min: 1, max: 1000 };
        
        // –•—Ä–∞–Ω–∏–ª–∏—â–µ –¥–∞–Ω–Ω—ã—Ö
        const storage = {
            get(key) {
                try { return JSON.parse(localStorage.getItem(key) || '{}'); }
                catch { return {}; }
            },
            set(key, value) {
                localStorage.setItem(key, JSON.stringify(value));
            }
        };
        
        // ===== –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø =====
        function registerNewUser() {
            const nick = document.getElementById('username').value.trim();
            const pass = document.getElementById('password').value;
            if (nick.length < 3 || pass.length < 3) {
                return alert('‚ùå –ù–∏–∫ –∏ –ø–∞—Ä–æ–ª—å –º–∏–Ω–∏–º—É–º 3 —Å–∏–º–≤–æ–ª–∞!');
            }
            let users = storage.get('users');
            if (users[nick]) {
                return alert('‚ùå –ù–∏–∫ —É–∂–µ –∑–∞–Ω—è—Ç!');
            }
                        users[nick] = {
                pass: btoa(pass),
                snakeRecord: 0,
                guessRecord: 999,
                snakeTournament: 0,
                guessTournament: 999,
                registered: new Date().toISOString()
            };
            storage.set('users', users);
            alert('‚úÖ –ê–∫–∫–∞—É–Ω—Ç —Å–æ–∑–¥–∞–Ω! –¢–µ–ø–µ—Ä—å –≤–æ–π–¥–∏ –≤ –∏–≥—Ä—É.');
        }
        
        function loginUser() {
            const nick = document.getElementById('username').value.trim();
            const pass = document.getElementById('password').value;
            let users = storage.get('users');
            
            if (users[nick] && users[nick].pass === btoa(pass)) {
                currentUser = nick;
                document.getElementById('currentNick').textContent = nick;
                document.getElementById('loginPanel').classList.add('hidden');
                document.getElementById('mainMenu').classList.remove('hidden');
                document.getElementById('userPanel').classList.remove('hidden');
                updateAllLeaderboards();
                startTournamentTimers();
            } else {
                alert('‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω –∏–ª–∏ –ø–∞—Ä–æ–ª—å!');
            }
        }
        
        function logoutUser() {
            currentUser = '';
            document.querySelectorAll('.panel:not(#loginPanel)').forEach(p => p.classList.add('hidden'));
            document.getElementById('loginPanel').classList.remove('hidden');
            document.getElementById('userPanel').classList.add('hidden');
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
        }
        
        // ===== –ù–ê–í–ò–ì–ê–¶–ò–Ø =====
        function backToMainFromSnake() {
            hideAllPanels();
            document.getElementById('mainMenu').classList.remove('hidden');
        }
        
        function backToMainFromGuess() {
            hideAllPanels();
            document.getElementById('mainMenu').classList.remove('hidden');
        }
        
        function backToMainFromTournaments() {
            hideAllPanels();
            document.getElementById('mainMenu').classList.remove('hidden');
        }
        
        function backToSnakeMenu() {
            hideAllPanels();
            document.getElementById('snakeMenu').classList.remove('hidden');
        }
        
        function backToGuessMenu() {
            hideAllPanels();
            document.getElementById('guessMenu').classList.remove('hidden');
        }
        
        function hideAllPanels() {
            document.querySelectorAll('.panel').forEach(p => p.classList.add('hidden'));
        }
        
        function showSnakeMenu() {
            hideAllPanels();
            document.getElementById('snakeMenu').classList.remove('hidden');
        }
        
        function showGuessMenu() {
            hideAllPanels();
            document.getElementById('guessMenu').classList.remove('hidden');
        }
        
        function showTournamentsPanel() {
            hideAllPanels();
            document.getElementById('tournamentsPanel').classList.remove('hidden');
            updateTournamentLeaderboards();
        }
        
        // ===== –ó–ú–ï–ô–ö–ê =====
        function startSnakeGame(level) {
            snake = {
                running: true,
                score: 0,
                level: level,
                x: 275,
                y: 275,
                dx: 0,
                dy: 20,
                cells: [{x:275, y:275}],
                maxCells: 4,
                food: null,
                speed: 180 - (level * 50)
            };
            hideAllPanels();
            document.getElementById('snakeGame').classList.remove('hidden');
            document.getElementById('currentSnakeLevel').textContent = level;
            document.getElementById('currentScore').textContent = 0;
            snakeGameLoop();
        }
        
        function snakeGameLoop() {
            if (!snake.running) return;
            
            const canvas = document.getElementById('gameCanvas');
            const ctx = canvas.getContext('2d');
            
            // –û—á–∏—Å—Ç–∫–∞
            ctx.fillStyle = '#000011';
            ctx.fillRect(0, 0, 550, 550);
            
            // –î–≤–∏–∂–µ–Ω–∏–µ
            snake.x += snake.dx;
            snake.y += snake.dy;
            
            // –°—Ç–µ–Ω—ã
            if (snake.x < 25 || snake.x > 525 || snake.y < 25 || snake.y > 525) {
                endSnakeGame();
                return;
            }
            
            snake.cells.unshift({x: snake.x, y: snake.y});
            if (snake.cells.length > snake.maxCells) snake.cells.pop();
            
            // –°–∞–º–æ–µ–¥–µ–Ω–∏–µ
            if (snake.cells.length > 5) {
                for (let i = 1; i < snake.cells.length; i++) {
                    if (Math.abs(snake.cells[i].x - snake.x) < 20 && Math.abs(snake.cells[i].y - snake.y) < 20) {
                        endSnakeGame();
                        return;
                    }
                }
            }
            
            // –ï–¥–∞
            if (!snake.food) {
                snake.food = {
                    x: Math.floor(Math.random() * 25) * 20 + 45,
                    y: Math.floor(Math.random() * 25) * 20 + 45
                };
            }
            
            // –†–∏—Å—É–µ–º –µ–¥—É (–ö–†–ê–°–ò–í–û–ï –Ø–ë–õ–û–ö–û)
            const fx = snake.food.x, fy = snake.food.y;
            const appleGradient = ctx.createRadialGradient(fx, fy, 0, fx, fy, 15);
            appleGradient.addColorStop(0, '#ff4444');
            appleGradient.addColorStop(0.5, '#ff8800');
            appleGradient.addColorStop(1, '#cc0000');
            ctx.fillStyle = appleGradient;
            ctx.beginPath();
            ctx.arc(fx, fy, 15, 0, Math.PI * 2);
            ctx.fill();
            
            // –ë–ª–∏–∫–∏ —è–±–ª–æ–∫–∞
            ctx.fillStyle = 'rgba(255,255,255,0.9)';
            ctx.beginPath();
            ctx.arc(fx-5, fy-5, 4, 0, Math.PI * 2);
            ctx.arc(fx+4, fy-3, 3, 0, Math.PI * 2);
            ctx.fill();
            
            // –°—ä–µ–¥–∞–Ω–∏–µ
            if (Math.abs(snake.x - snake.food.x) < 18 && Math.abs(snake.y - snake.food.y) < 18) {
                snake.score += snake.level * 15;
                snake.maxCells += 2;
                delete snake.food;
                document.getElementById('currentScore').textContent = snake.score;
            }
            
            // –†–∏—Å—É–µ–º –∑–º–µ–π–∫—É
            snake.cells.forEach((cell, i) => {
                const gradient = ctx.createRadialGradient(cell.x, cell.y, 0, cell.x, cell.y, 18);
                gradient.addColorStop(0, i === 0 ? '#ff0080' : '#00ff88');
                gradient.addColorStop(1, i === 0 ? '#660033' : '#004400');
                ctx.fillStyle = gradient;
                ctx.shadowBlur = 20;
                ctx.shadowColor = i === 0 ? '#ff0080' : '#00ff88';
                ctx.beginPath();
                ctx.arc(cell.x, cell.y, i === 0 ? 18 : 12, 0, Math.PI * 2);
                ctx.fill();
                ctx.shadowBlur = 0;
            });
            
            setTimeout(snakeGameLoop, snake.speed);
        }
        
        function endSnakeGame() {
            snake.running = false;
            let users = storage.get('users');
            const recordKey = snake.tournament ? 'snakeTournament' : 'snakeRecord';
            if (users[currentUser][recordKey] < snake.score) {
                users[currentUser][recordKey] = snake.score;
                storage.set('users', users);
                updateAllLeaderboards();
            }
            alert(`üêç –ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞!\n${snake.score} –æ—á–∫–æ–≤\n–°–ª–æ–∂–Ω–æ—Å—Ç—å: ${snake.level}`);
        }
        
        function restartCurrentGame() {
            if (currentGame === 'snake') startSnakeGame(snake.level);
        }
        
        // ===== –£–ì–ê–î–ê–ô–ö–ê =====
        function startGuessGame(level) {
            const ranges = [1000, 10000, 100000];
            guess = {
                level: level,
                target: Math.floor(Math.random() * ranges[level-1]) + 1,
                attempts: 0,
                min: 1,
                max: ranges[level-1]
            };
            hideAllPanels();
            document.getElementById('guessGame').classList.remove('hidden');
            document.getElementById('currentGuessLevel').textContent = level;
            document.getElementById('currentRange').textContent = `1-${guess.max.toLocaleString()}`;
            document.getElementById('guessCount').textContent = 0;
            document.getElementById('guessHint').textContent = `üéØ –ó–∞–≥–∞–¥–∞–ª —á–∏—Å–ª–æ –æ—Ç 1 –¥–æ ${guess.max.toLocaleString()}`;
        }
        
        function checkNumberGuess() {
            const input = parseInt(document.getElementById('numberInput').value);
            if (!input || input < guess.min || input > guess.max) {
                document.getElementById('guessHint').innerHTML = `‚ùå –ß–∏—Å–ª–æ –æ—Ç ${guess.min} –¥–æ ${guess.max}!`;
                return;
            }
            
            guess.attempts++;
            document.getElementById('guessCount').textContent = guess.attempts;
            
            if (input === guess.target) {
                document.getElementById('guessHint').innerHTML = 
                    `üéâ <strong>–£–†–ê!</strong> –£–≥–∞–¥–∞–ª –∑–∞ ${guess.attempts} –ø–æ–ø—ã—Ç–æ–∫!<br>–ß–∏—Å–ª–æ –±—ã–ª–æ: ${guess.target}`;
                let users = storage.get('users');
                const recordKey = guess.tournament ? 'guessTournament' : 'guessRecord';
                if (users[currentUser][recordKey] > guess.attempts || !users[currentUser][recordKey]) {
                    users[currentUser][recordKey] = guess.attempts;
                    storage.set('users', users);
                    updateAllLeaderboards();
                }
            } else if (input < guess.target) {
                guess.min = input + 1;
                const range = guess.max - guess.min + 1;
                const hint = Math.floor(guess.min + range / 3);
                document.getElementById('guessHint').innerHTML = 
                    `üìà –ë–æ–ª—å—à–µ ${input}<br>–î–∏–∞–ø–∞–∑–æ–Ω: ${guess.min}-${guess.max} (${range} —á–∏—Å–µ–ª)<br>üí° –°–æ–≤–µ—Ç: ~${hint}`;
            } else {
                guess.max = input - 1;
                const range = guess.max - guess.min + 1;
                const hint = Math.floor(guess.max - range / 3);
                document.getElementById('guessHint').innerHTML = 
                    `üìâ –ú–µ–Ω—å—à–µ ${input}<br>–î–∏–∞–ø–∞–∑–æ–Ω: ${guess.min}-${guess.max} (${range} —á–∏—Å–µ–ª)<br>üí° –°–æ–≤–µ—Ç: ~${hint}`;
            }
            document.getElementById('numberInput').value = '';
        }
        
        function nextGuessLevel() {
            const nextLevel = guess.level % 3 + 1;
            startGuessGame(nextLevel);
        }
        
        // ===== –õ–ò–î–ï–†–ë–û–†–î–´ =====
        function updateAllLeaderboards() {
            updateSnakeLeaderboard();
            updateGuessLeaderboard();
        }
        
        function updateSnakeLeaderboard() {
            let users = storage.get('users');
            const top = Object.entries(users)
                .sort(([,a], [,b]) => b.snakeRecord - a.snakeRecord)
                .slice(0, 10)
                .map(([nick, data], i) => 
                    `<div class="rank${i+1}">${i+1}Ô∏è‚É£ ${nick.padEnd(12)}<span>${data.snakeRecord || 0}</span></div>`
                ).join('');
            document.getElementById('snakeTop10').innerHTML = top || '<div>–ù–∏–∫–æ–≥–æ –Ω–µ—Ç...</div>';
        }
        
        function updateGuessLeaderboard() {
            let users = storage.get('users');
            const top = Object.entries(users)
                .sort(([,a], [,b]) => (a.guessRecord || 999) - (b.guessRecord || 999))
                .slice(0, 10)
                .map(([nick, data], i) => 
                    `<div class="rank${i+1}">${i+1}Ô∏è‚É£ ${nick.padEnd(12)}<span>${data.guessRecord || '‚àû'}</span></div>`
                ).join('');
            document.getElementById('guessTop10').innerHTML = top || '<div>–ù–∏–∫–æ–≥–æ –Ω–µ—Ç...</div>';
        }
        
        function updateTournamentLeaderboards() {
            let users = storage.get('users');
            // –¢—É—Ä–Ω–∏—Ä –∑–º–µ–π–∫–∞
            const snakeTour = Object.entries(users)
                .sort(([,a], [,b]) => b.snakeTournament - a.snakeTournament)
                .slice(0, 5)
                .map(([nick, data], i) => `<div class="rank${i+1}">${i+1}Ô∏è‚É£ ${nick}<span>${data.snakeTournament || 0}</span></div>`)
                .join('');
            document.getElementById('snakeTourLeaderboard').innerHTML = snakeTour || '<div>–ù–∏–∫—Ç–æ –Ω–µ –∏–≥—Ä–∞–µ—Ç</div>';
            
            // –¢—É—Ä–Ω–∏—Ä —É–≥–∞–¥–∞–π–∫–∞
            const guessTour = Object.entries(users)
                .sort(([,a], [,b]) => (a.guessTournament || 999) - (b.guessTournament || 999))
                .slice(0, 5)
                .map(([nick, data], i) => `<div class="rank${i+1}">${i+1}Ô∏è‚É£ ${nick}<span>${data.guessTournament || '‚àû'}</span></div>`)
                .join('');
            document.getElementById('guessTourLeaderboard').innerHTML = guessTour || '<div>–ù–∏–∫—Ç–æ –Ω–µ –∏–≥—Ä–∞–µ—Ç</div>';
        }
        
        // ===== –¢–£–†–ù–ò–†–´ =====
        function joinSnakeTournamentDirect() {
            snake.tournament = true;
            startSnakeGame(2); // –¢—É—Ä–Ω–∏—Ä –≤—Å–µ–≥–¥–∞ –Ω–æ—Ä–º–∞–ª—å–Ω–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å
        }
        
        function joinGuessTournamentDirect() {
            guess.tournament = true;
            startGuessGame(2); // –¢—É—Ä–Ω–∏—Ä –≤—Å–µ–≥–¥–∞ —Å—Ä–µ–¥–Ω–∏–π —É—Ä–æ–≤–µ–Ω—å
        }
        
        function enterSnakeTournament() {
            snake.tournament = true;
            hideAllPanels();
            document.getElementById('snakeGame').classList.remove('hidden');
            startSnakeGame(2);
        }
        
        function enterGuessTournament() {
            guess.tournament = true;
            hideAllPanels();
            document.getElementById('guessGame').classList.remove('hidden');
            startGuessGame(2);
        }
        
        // ===== –£–ü–†–ê–í–õ–ï–ù–ò–ï =====
        document.addEventListener('keydown', (e) => {
            if (!snake.running) return;
            switch(e.key) {
                case 'ArrowUp': case 'w': case 'W': snake.dy = -20; snake.dx = 0; break;
                case 'ArrowDown': case 's': case 'S': snake.dy = 20; snake.dx = 0; break;
                case 'ArrowLeft': case 'a': case 'A': snake.dx = -20; snake.dy = 0; break;
                case 'ArrowRight': case 'd': case 'D': snake.dx = 20; snake.dy = 0; break;
            }
        });
        
        // ===== –¢–ê–ô–ú–ï–†–´ =====
        function startTournamentTimers() {
            setInterval(() => {
                const now = new Date();
                const tomorrow = new Date(now);
                tomorrow.setHours(24, 0, 0, 0);
                const diff = tomorrow - now;
                const h = Math.floor(diff / 3600000);
                const m = Math.floor((diff % 3600000) / 60000);
                const s = Math.floor((diff % 60000) / 1000);
                document.getElementById('snakeTimer').textContent = 
                document.getElementById('guessTimer').textContent = 
                    `${h.toString().padStart(2,'0')}:${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
            }, 1000);
        }
        
        // ===== –†–ï–ö–û–†–î–´ =====
        function updatePersonalRecords() {
            let users = storage.get('users');
            if (users[currentUser]) {
                document.getElementById('snakePersonalRecord').textContent = users[currentUser].snakeRecord || 0;
            }
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        window.onload = function() {
            updateAllLeaderboards();
            startTournamentTimers();
            updatePersonalRecords();
        };
    </script>
</body>
</html>


        <!-- –ú–ï–ù–Æ –£–ì–ê–î–ê–ô–ö–ò -->
        <div class="panel hidden" id="guessMenu
