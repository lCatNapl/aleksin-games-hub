<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Aleksin Games Hub 2026</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Exo+2:wght@400;600&display=swap');
        * { margin:0; padding:0; box-sizing:border-box; }

        body {
            font-family:'Exo 2',sans-serif;
            background:linear-gradient(-45deg,#0f0f23,#1a0033,#001a33,#2d004d);
            background-size:400% 400%;
            animation:bgShift 15s ease infinite;
            color:#fff;
            min-height:100vh;
        }
        @keyframes bgShift{
            0%{background-position:0% 50%}
            50%{background-position:100% 50%}
            100%{background-position:0% 50%}
        }
        .container{max-width:1200px;margin:0 auto;padding:20px;}
        h1{
            font-family:'Orbitron',sans-serif;
            text-align:center;
            font-size:clamp(2.2rem,4vw,3.4rem);
            margin-bottom:20px;
            background:linear-gradient(45deg,#ff00ff,#00ffff,#ffff00);
            -webkit-background-clip:text;
            -webkit-text-fill-color:transparent;
            text-shadow:0 0 25px #ff00ff;
        }
        #authSection{
            max-width:420px;
            margin:0 auto;
            padding:25px;
            background:rgba(0,0,0,0.75);
            border-radius:18px;
            border:1px solid #00ffff;
            box-shadow:0 15px 35px rgba(0,255,255,0.35);
            text-align:center;
        }
        #gamesSection,#userInfo{display:none;}

        input{
            width:100%;
            padding:12px 14px;
            margin:8px 0;
            border:none;
            border-radius:10px;
            background:rgba(255,255,255,0.08);
            color:#fff;
            font-size:15px;
        }
        input::placeholder{color:#aaa;}
        button{
            width:100%;
            padding:12px;
            margin:6px 0;
            border:none;
            border-radius:10px;
            background:linear-gradient(45deg,#ff00ff,#00ffff);
            color:#000;
            font-family:'Orbitron',sans-serif;
            font-size:14px;
            font-weight:700;
            cursor:pointer;
            box-shadow:0 6px 16px rgba(0,255,255,0.4);
            transition:.25s;
        }
        button:hover{
            transform:translateY(-2px);
            box-shadow:0 10px 25px rgba(0,255,255,0.6);
        }
        #userInfo{
            display:flex;
            align-items:center;
            justify-content:space-between;
            gap:12px;
            padding:10px 14px;
            margin:18px 0;
            background:rgba(0,255,0,0.15);
            border-radius:14px;
            border:1px solid #00ff88;
            font-family:'Orbitron',sans-serif;
        }
        #userInfo button{width:auto;padding:8px 14px;font-size:13px;}

        .game-grid{
            display:grid;
            grid-template-columns:repeat(auto-fit,minmax(340px,1fr));
            gap:20px;
            margin-top:20px;
        }
        .game-card{
            background:rgba(0,0,0,0.78);
            border-radius:18px;
            padding:18px;
            border:1px solid #ff00ff;
            box-shadow:0 12px 30px rgba(255,0,255,0.35);
        }
        .game-title{
            font-family:'Orbitron',sans-serif;
            text-align:center;
            font-size:1.3rem;
            margin-bottom:10px;
            background:linear-gradient(45deg,#ff00ff,#00ffff);
            -webkit-background-clip:text;
            -webkit-text-fill-color:transparent;
        }
        canvas{
            width:100%;
            height:240px;
            border-radius:14px;
            background:radial-gradient(circle at 10% 10%,#111,#000);
            border:1px solid #00ffff;
            display:block;
        }
        .difficulty-row{
            display:flex;
            gap:6px;
            margin-bottom:6px;
        }
        .diff-btn{
            flex:1;
            font-size:12px;
            padding:6px;
            border-radius:999px;
        }
        .diff-btn.active{
            background:linear-gradient(45deg,#ffff00,#ffaa00);
            color:#000;
        }
        #leaderboard,#tournament{
            margin-top:22px;
            padding:18px;
            background:rgba(0,0,0,0.8);
            border-radius:18px;
            border:1px solid #ffff00;
        }
        .top-title{
            text-align:center;
            font-family:'Orbitron',sans-serif;
            margin-bottom:10px;
        }
        .top-tabs{
            display:flex;
            flex-wrap:wrap;
            gap:6px;
            margin-bottom:10px;
        }
        .top-tab{
            padding:6px 10px;
            border-radius:999px;
            background:rgba(255,255,255,0.08);
            cursor:pointer;
            font-size:11px;
        }
        .top-tab.active{
            background:linear-gradient(45deg,#ff00ff,#00ffff);
            color:#000;
        }
        ul.top-list{
            list-style:none;
            max-height:230px;
            overflow-y:auto;
            padding-right:4px;
        }
        ul.top-list li{
            display:flex;
            justify-content:space-between;
            padding:6px 8px;
            margin:2px 0;
            border-radius:8px;
            background:rgba(255,255,255,0.06);
            font-size:13px;
            font-family:'Orbitron',sans-serif;
        }
        #timerLive,#statusLive{font-size:13px;margin:2px 0;}
    </style>
</head>
<body>
<div class="container">
    <h1>üéÆ ALEKSIN GAMES HUB 2026</h1>

    <div id="authSection">
        <div id="authStatus" style="min-height:18px;font-size:13px;margin-bottom:6px;"></div>
        <input id="usernameInput" placeholder="üëë –ù–∏–∫" maxlength="20">
        <input id="passwordInput" type="password" placeholder="üîë –ü–∞—Ä–æ–ª—å (4+ —Å–∏–º–≤–æ–ª–∞)" maxlength="20">
        <button onclick="login()">üöÄ –í–û–ô–¢–ò</button>
        <button onclick="register()">üìù –†–ï–ì–ò–°–¢–†–ê–¶–ò–Ø</button>
        <div style="font-size:12px;opacity:.75;margin-top:4px;">test/1234 ‚Ä¢ Aleksin/1234</div>
    </div>

    <div id="userInfo">
        <span>üëã <span id="currentUser">-</span></span>
        <span id="userTotal">0üíé</span>
        <button onclick="logout()">üö™ –í–´–•–û–î</button>
    </div>

    <div id="gamesSection">
        <div class="game-grid">
            <!-- –ó–ú–ï–ô–ö–ê -->
            <div class="game-card">
                <div class="game-title">üêç –ó–ú–ï–ô–ö–ê ULTRA</div>
                <div class="difficulty-row">
                    <button class="diff-btn active" id="snakeDiff1" onclick="setSnakeDiff(1)">üêå –õ—ë–≥–∫–∞—è</button>
                    <button class="diff-btn" id="snakeDiff2" onclick="setSnakeDiff(2)">‚ö° –ù–æ—Ä–º–∞</button>
                    <button class="diff-btn" id="snakeDiff3" onclick="setSnakeDiff(3)">üöÄ –•–∞—Ä–¥</button>
                </div>
                <canvas id="snakeCanvas"></canvas>
                <div style="display:flex;justify-content:space-between;align-items:center;margin-top:6px;">
                    <button style="width:auto;padding:6px 10px;font-size:12px;" onclick="startSnake()">‚ñ∂ –ù–æ–≤–∞—è –∏–≥—Ä–∞</button>
                    <div style="font-family:'Orbitron';font-size:13px;">
                        –û—á–∫–∏: <span id="snakeScore">0</span> | üçé <span id="snakeApples">0</span>
                    </div>
                </div>
            </div>

            <!-- –£–ì–ê–î–ê–ô–ö–ê -->
            <div class="game-card">
                <div class="game-title">üéØ –£–ì–ê–î–ê–ô –ß–ò–°–õ–û</div>
                <div class="difficulty-row">
                    <button class="diff-btn active" id="guessDiff1" onclick="setGuessDiff(1)">1‚Äì1K</button>
                    <button class="diff-btn" id="guessDiff2" onclick="setGuessDiff(2)">1‚Äì10K</button>
                    <button class="diff-btn" id="guessDiff3" onclick="setGuessDiff(3)">1‚Äì100K</button>
                </div>
                <div style="font-size:12px;opacity:.8;" id="guessRangeLabel">–î–∏–∞–ø–∞–∑–æ–Ω: 1‚Äì1000</div>
                <div style="margin-top:6px;">
                    <input id="guessInput" placeholder="üî¢ –í–≤–µ–¥–∏ —á–∏—Å–ª–æ">
                    <button style="margin-top:4px;" onclick="checkGuess()">üîç –ü–†–û–í–ï–†–ò–¢–¨</button>
                    <div id="guessFeedback" style="font-family:'Orbitron';font-size:13px;margin-top:4px;">
                        –ù–∞–ø–∏—à–∏ —á–∏—Å–ª–æ –∏ –∂–º–∏ –ü–†–û–í–ï–†–ò–¢–¨. –ü–æ–ø—ã—Ç–æ–∫ –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ.
                    </div>
                    <div id="guessAttempts" style="font-size:12px;opacity:.8;margin-top:2px;">–ü–æ–ø—ã—Ç–æ–∫: 0</div>
                </div>
            </div>
        </div>

        <!-- –¢–û–ü-10 -->
        <div id="leaderboard">
            <div class="top-title">üèÜ –¢–û–ü‚Äë10 –†–ï–ö–û–†–î–û–í</div>
            <div class="top-tabs">
                <span class="top-tab active" id="tabSnake1" onclick="setTopFilter('snake',1)">üêç –õ—ë–≥–∫–∞—è</span>
                <span class="top-tab" id="tabSnake2" onclick="setTopFilter('snake',2)">üêç –ù–æ—Ä–º–∞</span>
                <span class="top-tab" id="tabSnake3" onclick="setTopFilter('snake',3)">üêç –•–∞—Ä–¥</span>
                <span class="top-tab" id="tabGuess1" onclick="setTopFilter('guess',1)">üéØ 1‚Äì1K</span>
                <span class="top-tab" id="tabGuess2" onclick="setTopFilter('guess',2)">üéØ 1‚Äì10K</span>
                <span class="top-tab" id="tabGuess3" onclick="setTopFilter('guess',3)">üéØ 1‚Äì100K</span>
            </div>
            <ul class="top-list" id="topList"></ul>
        </div>

        <!-- –¢–£–†–ù–ò–† -->
        <div id="tournament">
            <div class="top-title">‚öî –¢–£–†–ù–ò–† 24—á (00:00‚Äì00:00 –ú–°–ö)</div>
            <div id="timerLive"></div>
            <div id="statusLive"></div>
            <ul class="top-list" id="tournamentList"></ul>
        </div>
    </div>
</div>

<script>
    // --- –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø ---
    let currentUser = null;
    let registeredUsers = JSON.parse(localStorage.getItem('agh_users') || '{}');

    function saveUsers(){ localStorage.setItem('agh_users', JSON.stringify(registeredUsers)); }

    function login(){
        const u = usernameInput.value.trim();
        const p = passwordInput.value;
        const st = authStatus;
        if(!u || p.length<4){
            st.textContent='–ù–∏–∫ –∏ –ø–∞—Ä–æ–ª—å (4+ —Å–∏–º–≤–æ–ª–∞)'; st.style.color='#ff5555'; return;
        }
        const test = {test:'1234','Aleksin':'1234'};
        const pass = registeredUsers[u]?.pass || test[u];
        if(pass && pass===p){
            currentUser = u;
            localStorage.setItem('agh_token',u);
            authSection.style.display='none';
            gamesSection.style.display='block';
            userInfo.style.display='flex';
            currentUserSpan.textContent=u;
            updateAll();
        }else{
            st.textContent='–ù–µ–≤–µ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω –∏–ª–∏ –ø–∞—Ä–æ–ª—å'; st.style.color='#ff5555';
        }
    }
    function register(){
        const u = usernameInput.value.trim();
        const p = passwordInput.value;
        const st = authStatus;
        if(!u || p.length<4){
            st.textContent='–ù–∏–∫ –∏ –ø–∞—Ä–æ–ª—å (4+ —Å–∏–º–≤–æ–ª–∞)'; st.style.color='#ff5555'; return;
        }
        if(registeredUsers[u]){
            st.textContent='–¢–∞–∫–æ–π –Ω–∏–∫ —É–∂–µ –µ—Å—Ç—å ‚Äî –ø—Ä–æ—Å—Ç–æ –≤–æ–π–¥–∏'; st.style.color='#00ffff'; return;
        }
        registeredUsers[u]={pass:p}; saveUsers();
        st.textContent='–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω! –¢–µ–ø–µ—Ä—å –≤–æ–π–¥–∏.'; st.style.color='#00ff88';
    }
    function logout(){
        currentUser=null;
        localStorage.removeItem('agh_token');
        gamesSection.style.display='none';
        userInfo.style.display='none';
        authSection.style.display='block';
    }
    function checkAuth(){
        const tok = localStorage.getItem('agh_token');
        if(tok){
            currentUser=tok;
            authSection.style.display='none';
            gamesSection.style.display='block';
            userInfo.style.display='flex';
            currentUserSpan.textContent=tok;
            updateAll();
        }
    }

    const usernameInput=document.getElementById('usernameInput');
    const passwordInput=document.getElementById('passwordInput');
    const authStatus=document.getElementById('authStatus');
    const authSection=document.getElementById('authSection');
    const gamesSection=document.getElementById('gamesSection');
    const userInfo=document.getElementById('userInfo');
    const currentUserSpan=document.getElementById('currentUser');
    const userTotal=document.getElementById('userTotal');

    // --- –ó–ú–ï–ô–ö–ê ---
    let snakeDiff=1;
    let snakeTimer=null;
    let snakeDir={x:1,y:0};
    let snakeBody=[];
    let snakeFood=null;
    let snakeScore=0;
    let snakeApples=0;

    function setSnakeDiff(d){
        snakeDiff=d;
        for(let i=1;i<=3;i++){
            document.getElementById('snakeDiff'+i).classList.toggle('active',i===d);
        }
    }

    function startSnake(){
        const c=document.getElementById('snakeCanvas');
        const ctx=c.getContext('2d');
        c.width=c.clientWidth;
        c.height=c.clientHeight;
        const cell=20;
        const cols=Math.floor(c.width/cell);
        const rows=Math.floor(c.height/cell);

        snakeBody=[{x:Math.floor(cols/2),y:Math.floor(rows/2)}];
        snakeDir={x:1,y:0};
        snakeScore=0;
        snakeApples=0;
        placeFood();

        document.onkeydown=e=>{
            if(e.key==='ArrowUp'&&snakeDir.y!==1) snakeDir={x:0,y:-1};
            if(e.key==='ArrowDown'&&snakeDir.y!==-1) snakeDir={x:0,y:1};
            if(e.key==='ArrowLeft'&&snakeDir.x!==1) snakeDir={x:-1,y:0};
            if(e.key==='ArrowRight'&&snakeDir.x!==-1) snakeDir={x:1,y:0};
        };

        if(snakeTimer) clearInterval(snakeTimer);
        const speed=[200,140,90][snakeDiff-1];

        snakeTimer=setInterval(()=>{
            const head={x:snakeBody[0].x+snakeDir.x,y:snakeBody[0].y+snakeDir.y};
            // —Å—Ç–µ–Ω—ã
            if(head.x<0||head.y<0||head.x>=cols||head.y>=rows||
               snakeBody.some(p=>p.x===head.x&&p.y===head.y)){
                clearInterval(snakeTimer);
                saveGameScore('snake',snakeScore,snakeDiff);
                return;
            }
            snakeBody.unshift(head);
            if(head.x===snakeFood.x&&head.y===snakeFood.y){
                snakeScore+=10*snakeDiff;
                snakeApples++;
                placeFood();
            }else{
                snakeBody.pop();
            }
            // —Ä–∏—Å—É–µ–º
            ctx.fillStyle='#050510';
            ctx.fillRect(0,0,c.width,c.height);

            // —Å–µ—Ç–∫–∞ –ª—ë–≥–∫–∞—è
            ctx.strokeStyle='rgba(255,255,255,0.04)';
            for(let x=0;x<cols;x++){ctx.beginPath();ctx.moveTo(x*cell,0);ctx.lineTo(x*cell,c.height);ctx.stroke();}
            for(let y=0;y<rows;y++){ctx.beginPath();ctx.moveTo(0,y*cell);ctx.lineTo(c.width,y*cell);ctx.stroke();}

            // —Ö–≤–æ—Å—Ç
            snakeBody.forEach((p,i)=>{
                const grd=ctx.createLinearGradient(p.x*cell,p.y*cell,(p.x+1)*cell,(p.y+1)*cell);
                grd.addColorStop(0,`hsl(${120+i*4},80%,55%)`);
                grd.addColorStop(1,`hsl(${180+i*4},80%,40%)`);
                ctx.fillStyle=grd;
                ctx.fillRect(p.x*cell+2,p.y*cell+2,cell-4,cell-4);
            });
            // –≥–æ–ª–æ–≤–∞ —Å –≥–ª–∞–∑–∫–∞–º–∏
            const h=snakeBody[0];
            ctx.fillStyle='#00ffff';
            ctx.fillRect(h.x*cell+2,h.y*cell+2,cell-4,cell-4);
            ctx.fillStyle='#000';
            ctx.beginPath();
            ctx.arc(h.x*cell+cell*0.3,h.y*cell+cell*0.35,2,0,Math.PI*2);ctx.fill();
            ctx.beginPath();
            ctx.arc(h.x*cell+cell*0.7,h.y*cell+cell*0.35,2,0,Math.PI*2);ctx.fill();

            // —è–±–ª–æ–∫–æ
            ctx.save();
            ctx.shadowColor='#ff0033';
            ctx.shadowBlur=12;
            ctx.beginPath();
            ctx.fillStyle='#ff3355';
            ctx.arc(snakeFood.x*cell+cell/2,snakeFood.y*cell+cell/2,cell*0.4,0,Math.PI*2);
            ctx.fill();
            ctx.restore();
            // –ª–∏—Å—Ç–∏–∫
            ctx.strokeStyle='#33ff55';
            ctx.lineWidth=2;
            ctx.beginPath();
            ctx.moveTo(snakeFood.x*cell+cell/2,snakeFood.y*cell+cell/2-8);
            ctx.lineTo(snakeFood.x*cell+cell/2+4,snakeFood.y*cell+cell/2-12);
            ctx.stroke();

            document.getElementById('snakeScore').textContent=snakeScore;
            document.getElementById('snakeApples').textContent=snakeApples;
        },speed);

        function placeFood(){
            let fx,fy;
            do{
                fx=Math.floor(Math.random()*cols);
                fy=Math.floor(Math.random()*rows);
            }while(snakeBody.some(p=>p.x===fx&&p.y===fy));
            snakeFood={x:fx,y:fy};
        }
    }

    // --- –£–ì–ê–î–ê–ô–ö–ê ---
    let guessDiff=1;
    let guessMax=1000;
    let secret=0;
    let attempts=0;

    function setGuessDiff(d){
        guessDiff=d;
        const max=[1000,10000,100000][d-1];
        guessMax=max;
        document.getElementById('guessRangeLabel').textContent='–î–∏–∞–ø–∞–∑–æ–Ω: 1‚Äì'+max.toLocaleString('ru-RU');
        for(let i=1;i<=3;i++){
            document.getElementById('guessDiff'+i).classList.toggle('active',i===d);
        }
        newSecret();
    }
    function newSecret(){
        secret=1+Math.floor(Math.random()*guessMax);
        attempts=0;
        document.getElementById('guessAttempts').textContent='–ü–æ–ø—ã—Ç–æ–∫: 0';
        document.getElementById('guessFeedback').textContent='–ß–∏—Å–ª–æ –∑–∞–≥–∞–¥–∞–Ω–æ. –ü–∏—à–∏ –¥–æ–≥–∞–¥–∫–∏.';
    }
    function checkGuess(){
        if(!secret) newSecret();
        const val = parseInt(document.getElementById('guessInput').value);
        if(isNaN(val)) return;
        attempts++;
        let fb='';
        if(val<secret) fb='üìà –ë–æ–ª—å—à–µ, —á–µ–º '+val;
        else if(val>secret) fb='üìâ –ú–µ–Ω—å—à–µ, —á–µ–º '+val;
        else{
            const base=[1000,10000,100000][guessDiff-1];
            const sc=Math.max(Math.floor(base/attempts),1);
            fb='‚úÖ –£–≥–∞–¥–∞–ª '+secret+' –∑–∞ '+attempts+' –ø–æ–ø—ã—Ç–æ–∫, '+sc+' –æ—á–∫–æ–≤! –ù–æ–≤–æ–µ —á–∏—Å–ª–æ –∑–∞–≥–∞–¥–∞–Ω–æ.';
            saveGameScore('guess',sc,guessDiff);
            newSecret();
        }
        document.getElementById('guessFeedback').textContent=fb;
        document.getElementById('guessAttempts').textContent='–ü–æ–ø—ã—Ç–æ–∫: '+attempts;
        document.getElementById('guessInput').value='';
    }

    document.addEventListener('keydown',e=>{
        if(e.key==='Enter' && document.activeElement===document.getElementById('guessInput')){
            checkGuess();
        }
    });

    // --- –•–†–ê–ù–ï–ù–ò–ï –†–ï–ö–û–†–î–û–í ---
    // scores: { user: { snake: {1:score,...}, guess:{1:score,...} } }
    function loadScores(){
        return JSON.parse(localStorage.getItem('agh_scores')||'{}');
    }
    function saveScores(obj){
        localStorage.setItem('agh_scores',JSON.stringify(obj));
    }
    function saveGameScore(game,score,diff){
        if(!currentUser) return;
        const sc=loadScores();
        if(!sc[currentUser]) sc[currentUser]={snake:{},guess:{}};
        const prev = sc[currentUser][game][diff]||0;
        if(score>prev){
            sc[currentUser][game][diff]=score;
            saveScores(sc);
        }
        updateAll();
    }

    // --- –¢–û–ü-10 –ü–û –ò–ì–†–ê–ú/–°–õ–û–ñ–ù–û–°–¢–Ø–ú ---
    let topGame='snake';
    let topDiff=1;

    function setTopFilter(game,diff){
        topGame=game; topDiff=diff;
        ['snake1','snake2','snake3','guess1','guess2','guess3'].forEach(id=>{
            const el=document.getElementById('tab'+id.charAt(0).toUpperCase()+id.slice(1));
            if(!el) return;
        });
        ['tabSnake1','tabSnake2','tabSnake3','tabGuess1','tabGuess2','tabGuess3'].forEach(id=>{
            const el=document.getElementById(id);
            if(!el) return;
            const g=id.includes('Snake')?'snake':'guess';
            const d=parseInt(id[id.length-1]);
            el.classList.toggle('active',g===game && d===diff);
        });
        renderTop();
    }

    function renderTop(){
        const sc=loadScores();
        const all=[];
        for(const user in sc){
            const val=sc[user][topGame]?.[topDiff]||0;
            if(val>0) all.push({user,score:val});
        }
        all.sort((a,b)=>b.score-a.score);
        const list=document.getElementById('topList');
        list.innerHTML='';
        (all.slice(0,10)).forEach((r,i)=>{
            const li=document.createElement('li');
            li.innerHTML=`<span>${i+1}. ${r.user}</span><span>${r.score}</span>`;
            list.appendChild(li);
        });
        if(all.length===0){
            const li=document.createElement('li');
            li.innerHTML='<span>–ü–æ–∫–∞ –Ω–µ—Ç —Ä–µ–∫–æ—Ä–¥–æ–≤</span><span>0</span>';
            list.appendChild(li);
        }
    }

    // --- –¢–£–†–ù–ò–† 24—á, –°–¢–ê–†–¢ –í 00:00 –ú–°–ö ---
    // –ª–æ–∫–∞–ª—å–Ω–æ —Å—á–∏—Ç–∞–µ–º, —á—Ç–æ –≤—Ä–µ–º—è —Å–∏—Å—Ç–µ–º—ã ~ –ú–°–ö
    // —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ tournamentScores: [{user,score}]
    function getTournamentStartTs(){
        let ts = parseInt(localStorage.getItem('agh_tournament_start')||'0');
        const now=new Date();
        if(!ts){
            const start=new Date();
            start.setHours(0,0,0,0);
            ts=start.getTime();
            localStorage.setItem('agh_tournament_start',ts);
        }else{
            // –µ—Å–ª–∏ –ø—Ä–æ—à–ª–∏ —Å—É—Ç–∫–∏ ‚Äî —Å–¥–≤–∏–≥–∞–µ–º –Ω–∞ –±–ª–∏–∂–∞–π—à–∏–π 00:00
            const passed = Date.now()-ts;
            if(passed>=24*3600*1000){
                const n=new Date();
                n.setHours(0,0,0,0);
                ts=n.getTime();
                localStorage.setItem('agh_tournament_start',ts);
            }
        }
        return ts;
    }

    function getTournamentScores(){
        return JSON.parse(localStorage.getItem('agh_tournament_scores')||'[]');
    }
    function saveTournamentScores(arr){
        localStorage.setItem('agh_tournament_scores',JSON.stringify(arr));
    }

    function addToTournament(totalScore){
        if(!currentUser) return;
        const arr=getTournamentScores();
        const existing=arr.find(r=>r.user===currentUser);
        if(existing){
            if(totalScore>existing.score) existing.score=totalScore;
        }else{
            arr.push({user:currentUser,score:totalScore});
        }
        saveTournamentScores(arr);
    }

    function renderTournament(){
        const startTs=getTournamentStartTs();
        const now=Date.now();
        const leftMs=startTs+24*3600*1000-now;
        let hrs=Math.floor(leftMs/3600000);
        let mins=Math.floor((leftMs%3600000)/60000);
        if(leftMs<=0){hrs=0;mins=0;}
        timerLive.textContent=`–î–æ –∫–æ–Ω—Ü–∞ —Ç—É—Ä–Ω–∏—Ä–∞: ${hrs}—á ${mins}–º`;
        const arr=getTournamentScores().sort((a,b)=>b.score-a.score);
        const list=document.getElementById('tournamentList');
        list.innerHTML='';
        (arr.slice(0,100)).forEach((r,i)=>{
            const medal=i===0?'ü•á':i===1?'ü•à':i===2?'ü•â':i<5?'üèÖ':'';
            const li=document.createElement('li');
            li.innerHTML=`<span>${i+1}. ${r.user} ${medal}</span><span>${r.score}</span>`;
            list.appendChild(li);
        });
        if(arr.length===0){
            const li=document.createElement('li');
            li.innerHTML='<span>–ü–æ–∫–∞ –Ω–µ—Ç —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤</span><span>0</span>';
            list.appendChild(li);
        }
        statusLive.textContent='–ü—Ä–∏–∑ –ø–æ–ª—É—á–∞—é—Ç —Ç–æ–ø‚Äë5 –ø–æ –∏—Ç–æ–≥–∞–º —Å—É—Ç–æ–∫.';
    }

    function recomputeUserTotalAndTournament(){
        const sc=loadScores();
        let total=0;
        const u=currentUser;
        if(u && sc[u]){
            const s=sc[u];
            for(const d in s.snake) total+=s.snake[d];
            for(const d in s.guess) total+=s.guess[d];
        }
        userTotal.textContent=total+'üíé';
        addToTournament(total);
    }

    // --- –û–ë–ù–û–í–õ–ï–ù–ò–Ø ---
    function updateAll(){
        renderTop();
        renderTournament();
        recomputeUserTotalAndTournament();
    }

    setSnakeDiff(1);
    setGuessDiff(1);
    checkAuth();
    setTopFilter('snake',1);
    setInterval(()=>{ if(currentUser) updateAll(); }, 30000);
</script>
</body>
</html>
