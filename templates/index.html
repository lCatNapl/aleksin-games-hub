<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéÆ Aleksin Games Hub</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap');
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Orbitron', monospace;
            background: linear-gradient(-45deg, #0f0f23, #1a1a2e, #16213e, #0f3460);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
            color: #e0e0e0; min-height: 100vh; overflow-x: hidden;
        }
        
        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        .stars {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-image: 
                radial-gradient(2px 2px at 20px 30px, #eee, transparent),
                radial-gradient(2px 2px at 40px 70px, rgba(255,255,255,0.8), transparent),
                radial-gradient(1px 1px at 90px 40px, #fff, transparent);
            background-repeat: repeat; background-size: 100px 100px;
            animation: sparkle 25s linear infinite; z-index: -1;
        }
        
        @keyframes sparkle { 100% { transform: translateY(50px); } }
        
        .container { max-width: 1400px; margin: 0 auto; padding: 20px; position: relative; z-index: 1; }
        
        .logo h1 {
            text-align: center; margin: 40px 0; font-size: clamp(3em, 8vw, 7em); font-weight: 900;
            background: linear-gradient(45deg, #44ff44, #00ff88, #44ff44);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            text-shadow: 0 0 60px rgba(68, 255, 68, 0.6); animation: glow 2s ease-in-out infinite alternate;
        }
        
        @keyframes glow { 
            from { filter: drop-shadow(0 0 20px #44ff44); } 
            to { filter: drop-shadow(0 0 50px #44ff44); } 
        }
        
        .status-bar {
            background: rgba(0,0,0,0.85); backdrop-filter: blur(25px); border: 2px solid rgba(68,255,68,0.4);
            border-radius: 25px; padding: 25px; margin-bottom: 40px; display: flex; justify-content: space-between;
            align-items: center; box-shadow: 0 15px 50px rgba(0,255,0,0.2);
        }
        
        .welcome-screen {
            min-height: 60vh; display: flex; flex-direction: column; justify-content: center; align-items: center;
            background: rgba(255,255,255,0.05); border-radius: 35px; border: 3px solid rgba(68,255,68,0.4);
            backdrop-filter: blur(30px); text-align: center; padding: 80px 50px; margin-bottom: 40px;
        }
        
        .games-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(380px, 1fr)); gap: 35px;
            margin-bottom: 40px; display: none;
        }
        
        .game-card {
            background: linear-gradient(145deg, rgba(26,26,42,0.95), rgba(42,42,68,0.95));
            border: 3px solid rgba(68,255,68,0.5); border-radius: 30px; padding: 45px; text-align: center;
            cursor: pointer; transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            backdrop-filter: blur(20px); position: relative; overflow: hidden;
        }
        
        .game-card::before {
            content: ''; position: absolute; top: 0; left: -100%; width: 100%; height: 100%;
            background: linear-gradient(90deg, transparent, rgba(68,255,68,0.3), transparent);
            transition: left 0.6s; 
        }
        .game-card:hover::before { left: 100%; }
        .game-card:hover {
            transform: translateY(-20px) scale(1.03); border-color: #44ff44;
            box-shadow: 0 30px 80px rgba(68,255,68,0.5);
        }
        
        .game-icon { font-size: 5.5em; margin-bottom: 25px; filter: drop-shadow(0 0 25px currentColor); }
        .game-card h2 { font-size: 2.2em; margin-bottom: 20px; color: #44ff44; }
        .game-card p { font-size: 1.2em; opacity: 0.95; }
        
        .dashboard { display: grid; grid-template-columns: 1fr 1fr; gap: 40px; margin-top: 40px; display: none; }
        .leaderboard, .tournament {
            background: linear-gradient(145deg, rgba(0,0,0,0.9), rgba(20,20,50,0.9)); 
            border: 3px solid rgba(68,255,68,0.4); border-radius: 30px; padding: 40px;
            backdrop-filter: blur(25px); max-height: 450px; overflow-y: auto;
            box-shadow: 0 20px 70px rgba(0,0,0,0.6);
        }
        
        .leader-item, .tournament-item {
            display: flex; justify-content: space-between; padding: 20px 25px; margin: 15px 0;
            background: rgba(68,255,68,0.2); border-radius: 20px; font-size: 1.3em;
            border-left: 5px solid #44ff44; transition: all 0.4s; font-weight: 700;
        }
        .leader-item:hover, .tournament-item:hover { 
            background: rgba(68,255,68,0.35); transform: translateX(15px); 
        }
        
        .modal {
            display: none; position: fixed; z-index: 10000; left: 0; top: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.95); backdrop-filter: blur(15px);
        }
        .modal-content {
            background: linear-gradient(145deg, rgba(15,15,35,0.98), rgba(26,26,42,0.98));
            margin: 5% auto; padding: 60px; border-radius: 35px; width: 90%; max-width: 550px;
            border: 3px solid rgba(68,255,68,0.6); box-shadow: 0 40px 100px rgba(68,255,68,0.4);
            backdrop-filter: blur(30px); animation: modalSlide 0.6s ease;
        }
        
        @keyframes modalSlide { from { opacity: 0; transform: translateY(-60px); } to { opacity: 1; transform: translateY(0); } }
        
        .modal-buttons { display: flex; gap: 20px; justify-content: center; margin-top: 35px; }
        .modal-btn {
            padding: 22px 50px; border: none; border-radius: 25px; cursor: pointer; font-size: 1.3em;
            font-weight: 900; flex: 1; font-family: 'Orbitron', monospace; transition: all 0.4s;
            text-transform: uppercase; letter-spacing: 2px;
        }
        .btn-primary {
            background: linear-gradient(45deg, #44ff44, #00ff88); color: #000;
            box-shadow: 0 15px 45px rgba(68,255,68,0.5);
        }
        .btn-primary:hover { transform: translateY(-5px); box-shadow: 0 20px 60px rgba(68,255,68,0.7); }
        .btn-secondary { background: rgba(100,100,100,0.9); color: white; }
        #logout { padding: 15px 30px; border-radius: 20px; font-size: 1.1em; margin-left: 15px; }
        
        input {
            width: 100%; padding: 25px; font-size: 1.4em; border-radius: 25px; margin: 20px 0;
            border: 3px solid rgba(68,255,68,0.5); background: rgba(0,0,0,0.8); color: #e0e0e0;
            font-family: 'Orbitron', monospace; transition: all 0.4s; backdrop-filter: blur(15px);
            text-align: center;
        }
        input:focus { outline: none; border-color: #44ff44; box-shadow: 0 0 30px rgba(68,255,68,0.6); }
        
        #warning-text {
            background: linear-gradient(45deg, #ff4444, #ff8888); color: #000; padding: 25px;
            border-radius: 20px; margin: 25px 0; display: none; font-weight: 900; text-align: center;
            box-shadow: 0 15px 45px rgba(255,68,68,0.5); animation: shake 0.6s;
        }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-12px); } 75% { transform: translateX(12px); } }
        
        #game-container { min-height: 600px; display: none; }
        canvas { border: 5px solid #44ff44; border-radius: 25px; background: #000; 
                 display: block; margin: 30px auto; box-shadow: 0 25px 80px rgba(68,255,68,0.5); }
        
        @media (max-width: 768px) {
            .dashboard { grid-template-columns: 1fr; } .games-grid { grid-template-columns: 1fr; }
            .status-bar { flex-direction: column; gap: 20px; text-align: center; }
        }
    </style>
</head>
<body>
    <div class="stars"></div>
    <div class="container">
        <div class="logo">
            <h1>üéÆ ALEKSIN GAMES HUB</h1>
        </div>
        
        <div class="status-bar">
            <span id="status">üîí –ì–æ—Å—Ç—å</span>
            <div>
                <button id="loginBtn" onclick="showAuth('login')" class="modal-btn btn-primary" style="padding:15px 30px;margin:0;">–í–æ–π—Ç–∏</button>
                <button id="registerBtn" onclick="showAuth('register')" class="modal-btn btn-primary" style="padding:15px 30px;margin:0;">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
                <button id="logout" onclick="logout()" style="display:none;">üö™ –í—ã—Ö–æ–¥</button>
            </div>
        </div>
        
        <!-- –≠–ö–†–ê–ù –î–û –õ–û–ì–ò–ù–ê -->
        <div id="welcomeScreen" class="welcome-screen">
            <h2 style="font-size:3.5em;margin-bottom:30px;color:#44ff44;text-shadow:0 0 30px #44ff44;">üöÄ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –ò–≥—Ä–æ–≤–æ–π –•–∞–±!</h2>
            <p style="font-size:1.8em;max-width:700px;line-height:1.6;opacity:0.95;">
                –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Å—è –∏–ª–∏ –≤–æ–π–¥–∏, —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã—Ç—å <strong>üêç –ó–º–µ–π–∫—É —Å —Å–≤–∞–π–ø–∞–º–∏</strong>, 
                <strong>üéØ –£–≥–∞–¥–∞–π–∫—É 1-10000</strong>, <strong>üèÜ –¢–æ–ø-10 –∏–≥—Ä–æ–∫–æ–≤</strong> 
                –∏ <strong>‚öîÔ∏è –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ —Ç—É—Ä–Ω–∏—Ä—ã 24—á!</strong>
            </p>
        </div>
        
        <!-- –ò–ì–†–´ (–°–ö–†–´–¢–´ –î–û –õ–û–ì–ò–ù–ê) -->
        <div class="games-grid" id="gamesMenu">
            <div class="game-card" onclick="loadSnakeGame()">
                <div class="game-icon" style="color:lime;">üêç</div>
                <h2>–ó–º–µ–π–∫–∞ –ü—Ä–æ</h2>
                <p>–°–≤–∞–π–ø—ã üì± ‚Ä¢ WASD ‚Ä¢ –ì—Ä–∞–¥–∏–µ–Ω—Ç ‚Ä¢ –¢–µ–ª–µ–ø–æ—Ä—Ç ‚Ä¢ –†–µ–∫–æ—Ä–¥—ã</p>
            </div>
            <div class="game-card" onclick="loadGuessGame()">
                <div class="game-icon" style="color:#ffaa00;">üéØ</div>
                <h2>–£–≥–∞–¥–∞–π 1-10000</h2>
                <p>–ë–µ–∑–ª–∏–º–∏—Ç —Ö–æ–¥–æ–≤ ‚Ä¢ üî• –û—á–µ–Ω—å –±–ª–∏–∑–∫–æ! ‚Ä¢ –¢–æ—á–Ω—ã–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏ ‚Ä¢ –¢–æ–ø-–æ—á–∫–∏</p>
            </div>
        </div>
        
        <div id="game-container"></div>
        
        <!-- –î–≠–®–ë–û–†–î (–°–ö–†–´–¢ –î–û –õ–û–ì–ò–ù–ê) -->
        <div class="dashboard" id="dashboard">
            <div class="leaderboard">
                <h3 style="color:#44ff44;font-size:2em;margin-bottom:25px;">üèÜ –¢–æ–ø-10 –∏–≥—Ä–æ–∫–æ–≤</h3>
                <div id="leaderboard-list">üîÑ –ó–∞–≥—Ä—É–∑–∫–∞ –ª–∏–¥–µ—Ä–±–æ—Ä–¥–∞...</div>
            </div>
            <div class="tournament">
                <h3 style="color:#ffaa00;font-size:2em;margin-bottom:25px;">‚öîÔ∏è –¢—É—Ä–Ω–∏—Ä (24—á)</h3>
                <div id="tournament-info">üîÑ –ó–∞–≥—Ä—É–∑–∫–∞ —Ç—É—Ä–Ω–∏—Ä–∞...</div>
            </div>
        </div>
    </div>

    <!-- –ú–û–î–ê–õ–ö–ê 5x –ù–ï–£–ù–ò–ß–¢–û–ñ–ò–ú–ê–Ø -->
    <div id="auth-modal" class="modal">
        <div class="modal-content">
            <span onclick="closeAuth()" style="float:right;cursor:pointer;font-size:3em;color:#44ff44;">√ó</span>
            <h2 id="modal-title" style="color:#44ff44;font-size:2.5em;margin-bottom:35px;">–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è</h2>
            <div id="warning-text">‚ö†Ô∏è –≠—Ç–æ—Ç –ª–æ–≥–∏–Ω —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç!</div>
            <input type="text" id="username" placeholder="üë§ –í–≤–µ–¥–∏ –ª–æ–≥–∏–Ω" maxlength="20">
            <input type="password" id="password" placeholder="üîí –í–≤–µ–¥–∏ –ø–∞—Ä–æ–ª—å">
            <div class="modal-buttons">
                <button class="modal-btn btn-primary" id="submit-btn">üöÄ –í–æ–π—Ç–∏</button>
                <button class="modal-btn btn-secondary" onclick="closeAuth()">‚ùå –û—Ç–º–µ–Ω–∞</button>
            </div>
        </div>
    </div>

    <script>
                let currentGame = ''; let isLoggedIn = false; let gameData = {score: 0};
        let gameInterval = null; 
        let snake = {x:20,y:20,dx:1,dy:0,cells:[],maxCells:4};
        let food = {x:15,y:15}; 
        let secretNumber = 0; 
        let attempts = 0;

        // üî• 5x –ù–ï–£–ù–ò–ß–¢–û–ñ–ò–ú–´–ï –ö–ù–û–ü–ö–ò
        function initButtons() {
            const btn = document.getElementById('submit-btn');
            if (btn && !btn.dataset.fixed) {
                btn.dataset.fixed = 'true';
                btn.onclick = authUser; 
                btn.onmousedown = authUser; 
                btn.ontouchstart = authUser;
                btn.onpointerdown = authUser;
                console.log('üî• –ö–ù–û–ü–ö–ò –ù–ï–£–ù–ò–ß–¢–û–ñ–ò–ú–´ 5x!');
            }
        }

        async function checkUserStatus() {
            try {
                const res = await fetch('/status', {credentials: 'include'});
                const data = await res.json();
                if (data.logged_in) {
                    document.getElementById('status').textContent = `üëã ${data.username}`;
                    document.getElementById('logout').style.display = 'inline-block';
                    document.getElementById('welcomeScreen').style.display = 'none';
                    document.getElementById('gamesMenu').style.display = 'grid';
                    document.getElementById('dashboard').style.display = 'grid';
                    document.getElementById('game-container').style.display = 'block';
                    isLoggedIn = true; 
                    loadLeaderboard(); 
                    loadTournament();
                } else {
                    document.getElementById('status').textContent = 'üîí –ì–æ—Å—Ç—å';
                    document.getElementById('logout').style.display = 'none';
                    document.getElementById('welcomeScreen').style.display = 'flex';
                    document.getElementById('gamesMenu').style.display = 'none';
                    document.getElementById('dashboard').style.display = 'none';
                    document.getElementById('game-container').style.display = 'none';
                    isLoggedIn = false;
                }
            } catch (e) { console.error('Status check:', e); }
        }

        async function authUser() {
            console.log('üî• –ö–ù–û–ü–ö–ê –ñ–ò–í–ê!');
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value;
            const errorDiv = document.getElementById('warning-text');
            const mode = document.getElementById('modal-title').textContent;
            
            if (!username || !password) {
                errorDiv.textContent = '‚ö†Ô∏è –ó–∞–ø–æ–ª–Ω–∏ –≤—Å–µ –ø–æ–ª—è!'; 
                errorDiv.style.display = 'block'; 
                return;
            }
            
            try {
                const endpoint = mode === '–í—Ö–æ–¥' ? 'login' : 'register';
                const res = await fetch('/' + endpoint, {
                    method: 'POST', 
                    credentials: 'include',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({username, password})
                });
                const data = await res.json();
                
                if (data.success) {
                    checkUserStatus(); 
                    closeAuth(); 
                    console.log('‚úÖ –í–û–®–Å–õ:', data.username);
                } else {
                    errorDiv.textContent = data.error || '–û—à–∏–±–∫–∞!'; 
                    errorDiv.style.display = 'block';
                }
            } catch (e) {
                console.error('Auth error:', e); 
                errorDiv.textContent = '‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏!'; 
                errorDiv.style.display = 'block';
            }
        }

        async function logout() {
            try {
                await fetch('/logout', {method: 'POST', credentials: 'include'});
                checkUserStatus();
                console.log('üö™ –í–´–®–ï–õ');
            } catch (e) { console.error('Logout error:', e); }
        }

        function showAuth(mode) {
            document.getElementById('auth-modal').style.display = 'block';
            document.getElementById('modal-title').textContent = mode === 'login' ? '–í—Ö–æ–¥' : '–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è';
            document.getElementById('username').value = ''; 
            document.getElementById('password').value = '';
            document.getElementById('warning-text').style.display = 'none'; 
            setTimeout(initButtons, 100);
        }

        function closeAuth() { 
            document.getElementById('auth-modal').style.display = 'none'; 
        }

        async function loadLeaderboard() {
            try {
                const res = await fetch('/leaderboard');
                const leaders = await res.json();
                document.getElementById('leaderboard-list').innerHTML = 
                    leaders.length ? 
                    leaders.map((p,i) => `<div class="leader-item">${i+1}Ô∏è‚É£ ${p.username} - ${p.score.toLocaleString()}</div>`).join('') : 
                    'üë• –ù–∏–∫—Ç–æ –Ω–µ –∏–≥—Ä–∞–ª...';
            } catch (e) { 
                document.getElementById('leaderboard-list').innerHTML = '‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏'; 
            }
        }

        async function loadTournament() {
            try {
                const res = await fetch('/tournament');
                const data = await res.json();
                const info = document.getElementById('tournament-info');
                if (data.active) {
                    const timeLeft = new Date(data.end_time) - Date.now();
                    const hours = Math.floor(timeLeft / 3600000);
                    const minutes = Math.floor((timeLeft % 3600000) / 60000);
                    info.innerHTML = `‚è∞ <strong style="color:#44ff44;">${hours}—á ${minutes}–º</strong><br>` + 
                        (Object.entries(data.scores || {}).length ? 
                         Object.entries(data.scores).slice(0,5).map(([u,s],i) => 
                            `<div class="tournament-item">${i+1}Ô∏è‚É£ ${u}: <strong style="color:#ffaa00;">${s}</strong></div>`).join('') : 
                         'üéØ –ü–µ—Ä–≤—ã–π –∏–≥—Ä–æ–∫ —Ç—É—Ä–Ω–∏—Ä–∞?');
                } else {
                    info.innerHTML = '‚öîÔ∏è –ù–æ–≤—ã–π —Ç—É—Ä–Ω–∏—Ä —Å–∫–æ—Ä–æ!';
                }
            } catch (e) { 
                document.getElementById('tournament-info').innerHTML = '‚ùå –û—à–∏–±–∫–∞'; 
            }
        }

        async function saveScore() {
            if (!isLoggedIn || gameData.score === 0) return;
            try {
                await fetch('/save_score', {
                    method: 'POST', 
                    credentials: 'include',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({score: gameData.score})
                });
                loadLeaderboard(); 
                loadTournament();
            } catch (e) { console.error('Save score:', e); }
        }

        // üêç –ü–û–õ–ù–ê–Ø –ó–ú–ï–ô–ö–ê –ü–†–û
        function loadSnakeGame() {
            currentGame = 'snake';
            document.getElementById('game-container').innerHTML = `
                <canvas id="gameCanvas" width="500" height="500" style="border:5px solid #44ff44;border-radius:25px;background:#000;display:block;margin:30px auto;box-shadow:0 30px 90px rgba(68,255,68,0.5);"></canvas>
                <div style="text-align:center;font-size:24px;font-family:'Orbitron',monospace;">
                    <div style="color:#44ff44;margin-bottom:20px;">
                        –°—á—ë—Ç: <span id="snakeScore" style="font-size:2em;font-weight:900;">0</span> 
                        | –†–µ–∫–æ—Ä–¥: <span id="snakeHighscore" style="color:#ffaa00;font-size:1.5em;">0</span>
                    </div>
                    <div style="color:#e0e0e0;font-size:1.2em;">üì± –°–≤–∞–π–ø—ã ‚Ä¢ WASD ‚Ä¢ –°—Ç—Ä–µ–ª–∫–∏ ‚Ä¢ –ö–ª–∏–∫=–†–µ—Å—Ç–∞—Ä—Ç</div>
                </div>
            `;
            
            const canvas = document.getElementById('gameCanvas');
            const ctx = canvas.getContext('2d');
            snake = {x:25,y:25,dx:1,dy:0,cells:[],maxCells:4};
            food = {x:Math.floor(Math.random()*49),y:Math.floor(Math.random()*49)};
            
            let touchStartX = 0, touchStartY = 0;
            canvas.addEventListener('touchstart', (e) => {
                e.preventDefault(); 
                touchStartX = e.touches[0].clientX; 
                touchStartY = e.touches[0].clientY;
            }, {passive: false});
            
            canvas.addEventListener('touchend', (e) => {
                e.preventDefault();
                const diffX = touchStartX - e.changedTouches[0].clientX;
                const diffY = touchStartY - e.changedTouches[0].clientY;
                
                if (Math.abs(diffX) > Math.abs(diffY) && Math.abs(diffX) > 30) {
                    if (diffX > 0 && snake.dx !== 1) { snake.dx = -1; snake.dy = 0; }
                    else if (diffX < 0 && snake.dx !== -1) { snake.dx = 1; snake.dy = 0; }
                } else if (Math.abs(diffY) > 30) {
                    if (diffY > 0 && snake.dy !== 1) { snake.dx = 0; snake.dy = -1; }
                    else if (diffY < 0 && snake.dy !== -1) { snake.dx = 0; snake.dy = 1; }
                }
            }, {passive: false});
            
            document.addEventListener('keydown', (e) => {
                if (currentGame !== 'snake') return;
                switch(e.key.toLowerCase()) {
                    case 'arrowleft': case 'a': if (snake.dx !== 1) { snake.dx = -1; snake.dy = 0; } break;
                    case 'arrowup': case 'w': if (snake.dy !== 1) { snake.dx = 0; snake.dy = -1; } break;
                    case 'arrowright': case 'd': if (snake.dx !== -1) { snake.dx = 1; snake.dy = 0; } break;
                    case 'arrowdown': case 's': if (snake.dy !== -1) { snake.dx = 0; snake.dy = 1; } break;
                }
            });
            
            function updateSnake() {
                snake.x += snake.dx; snake.y += snake.dy;
                if (snake.x < 0) snake.x = 49;
                if (snake.y < 0) snake.y = 49;
                if (snake.x > 49) snake.x = 0;
                if (snake.y > 49) snake.y = 0;
                
                snake.cells.unshift({x: snake.x, y: snake.y});
                if (snake.cells.length > snake.maxCells) snake.cells.pop();
                
                if (snake.x === food.x && snake.y === food.y) {
                    snake.maxCells++; 
                    food.x = Math.floor(Math.random() * 50);
                    food.y = Math.floor(Math.random() * 50);
                }
                
                for (let cell of snake.cells.slice(1)) {
                    if (snake.x === cell.x && snake.y === cell.y) { gameOver(); return; }
                }
                
                ctx.fillStyle = '#0a0a0a'; ctx.fillRect(0, 0, 500, 500);
                
                const gradient = ctx.createLinearGradient(0, 0, 500, 500);
                gradient.addColorStop(0, '#44ff44'); gradient.addColorStop(1, '#00ff88');
                ctx.fillStyle = gradient;
                snake.cells.forEach((cell, i) => {
                    ctx.fillRect(cell.x*10+1, cell.y*10+1, 9-(i*0.15), 9-(i*0.15));
                });
                
                ctx.shadowColor = '#ff4444'; ctx.shadowBlur = 20;
                ctx.fillStyle = '#ff4444';
                ctx.beginPath();
                ctx.arc(food.x*10+5.5, food.y*10+5.5, 5+Math.sin(Date.now()*0.01)*1.5, 0, Math.PI*2);
                ctx.fill();
                ctx.shadowBlur = 0;
                
                document.getElementById('snakeScore').textContent = snake.cells.length - 4;
                gameData.score = snake.cells.length - 4;
            }
            
            function gameOver() {
                if (gameInterval) clearInterval(gameInterval);
                ctx.fillStyle = 'rgba(255,68,68,0.9)'; ctx.fillRect(0, 0, 500, 500);
                ctx.fillStyle = '#fff'; ctx.font = 'bold 40px Orbitron'; ctx.textAlign = 'center';
                ctx.fillText('GAME OVER', 250, 220);
                ctx.font = 'bold 32px Orbitron'; ctx.fillText(`–°—á—ë—Ç: ${gameData.score}`, 250, 270);
                ctx.font = '26px Orbitron'; ctx.fillText('–ö–ª–∏–∫–Ω–∏ –¥–ª—è —Ä–µ—Å—Ç–∞—Ä—Ç–∞', 250, 320);
                saveScore();
            }
            
            canvas.onclick = () => {
                if (gameInterval) clearInterval(gameInterval);
                snake = {x:25,y:25,dx:1,dy:0,cells:[],maxCells:4};
                food = {x:Math.floor(Math.random()*49),y:Math.floor(Math.random()*49)};
                gameData.score = 0;
                gameInterval = setInterval(updateSnake, 130);
            };
            gameInterval = setInterval(updateSnake, 130);
        }

        // üéØ –ü–û–õ–ù–ê–Ø –£–ì–ê–î–ê–ô–ö–ê 1-10000
        function loadGuessGame() {
            currentGame = 'guess';
            secretNumber = Math.floor(Math.random() * 10000) + 1;
            attempts = 0;
            
            document.getElementById('game-container').innerHTML = `
                <div style="text-align:center; padding:40px; background:rgba(0,0,0,0.9); border-radius:30px; border:4px solid #ffaa00; max-width:600px; margin:30px auto; backdrop-filter:blur(25px); box-shadow:0 30px 90px rgba(255,170,0,0.4);">
                    <h1 style="font-size:3.5em; background:linear-gradient(45deg,#ffaa00,#44ff44); -webkit-background-clip:text; -webkit-text-fill-color:transparent; margin-bottom:25px; text-shadow:0 0 30px #ffaa00;">üéØ –£–≥–∞–¥–∞–π —á–∏—Å–ª–æ!</h1>
                    <div style="font-size:1.8em; margin:30px 0;">
                        <span style="color:#44ff44;">–•–æ–¥–æ–≤: <span id="attempts" style="font-size:2.2em;font-weight:900;">0</span></span>
                        <span style="color:#ffaa00;"> | –û—á–∫–∏: <span id="score" style="font-size:2.2em;font-weight:900;">10000</span></span>
                    </div>
                    <div style="margin:40px 0;">
                        <input type="number" id="guessInput" min="1" max="10000" placeholder="1-10000" 
                               style="padding:30px 25px; font-size:2em; width:400px; border-radius:25px; border:4px solid #ffaa00; background:rgba(0,0,0,0.95); color:#e0e0e0; text-align:center; font-family:'Orbitron'; margin-bottom:25px; box-shadow:0 15px 45px rgba(255,170,0,0.3);">
                        <br>
                        <button id="submitGuess" style="padding:25px 80px; font-size:1.8em; background:linear-gradient(45deg,#ffaa00,#44ff44); color:#000; border:none; border-radius:25px; cursor:pointer; font-weight:900; font-family:'Orbitron'; text-transform:uppercase; box-shadow:0 20px 60px rgba(255,170,0,0.5); transition:all 0.3s;">
                            üî• –ü—Ä–æ–≤–µ—Ä–∏—Ç—å
                        </button>
                    </div>
                    <div id="hint" style="font-size:3em; font-weight:900; min-height:100px; margin:40px 0; text-shadow:0 0 25px currentColor;"></div>
                </div>
            `;
            
            document.getElementById('submitGuess').onclick = checkGuess;
            document.getElementById('guessInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') checkGuess();
            });
            document.getElementById('guessInput').focus();
        }

        function checkGuess() {
            const input = document.getElementById('guessInput');
            const guess = parseInt(input.value); 
            attempts++;
            
            if (isNaN(guess) || guess < 1 || guess > 10000) {
                document.getElementById('hint').innerHTML = '<span style="color:#ff4444;font-size:0.8em;">‚ùå –í–≤–µ–¥–∏ —á–∏—Å–ª–æ –æ—Ç 1 –¥–æ 10000!</span>';
                input.value = ''; input.focus(); return;
            }
            
            let hint = '', color = '#ffaa00';
            if (guess === secretNumber) {
                const score = Math.max(0, 10000 - attempts * 5);
                gameData.score = score; 
                saveScore();
                hint = `üéâ <span style="color:#44ff44;font-size:1.1em;">–£–ì–î–ê–õ –ó–ê ${attempts} –•–û–î–û–í!</span><br>‚≠ê <strong>${score.toLocaleString()} –û–ß–ö–û–í</strong>`;
                document.getElementById('hint').style.color = '#44ff44';
                document.getElementById('hint').innerHTML = hint;
                
                setTimeout(() => {
                    alert(`üéâ –ü–û–ó–î–†–ê–í–õ–Ø–ï–ú!\n–£–≥–∞–¥–∞–ª –∑–∞ ${attempts} —Ö–æ–¥–æ–≤!\n‚≠ê ${score.toLocaleString()} –æ—á–∫–æ–≤ –≤ —Ç–æ–ø!`);
                }, 1500);
                
                secretNumber = Math.floor(Math.random() * 10000) + 1;
                attempts = 0;
            } else if (guess < secretNumber) {
                const diff = secretNumber - guess;
                if (diff <= 50) { 
                    hint = 'üî• –û–ß–ï–ù–¨ –ë–õ–ò–ó–ö–û! ‚ûï –ë–û–õ–¨–®–ï! üî•'; 
                    color = '#ff4444'; 
                } else if (diff <= 200) { 
                    hint = '‚ûï –ë–æ–ª—å—à–µ!'; 
                } else { 
                    hint = 'üìà –ó–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ –±–æ–ª—å—à–µ!'; 
                }
            } else {
                const diff = guess - secretNumber;
                if (diff <= 50) { 
                    hint = 'üî• –û–ß–ï–ù–¨ –ë–õ–ò–ó–ö–û! ‚ûñ –ú–ï–ù–¨–®–ï! üî•'; 
                    color = '#ff4444'; 
                } else if (diff <= 200) { 
                    hint = '‚ûñ –ú–µ–Ω—å—à–µ!'; 
                } else { 
                    hint = 'üìâ –ó–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ –º–µ–Ω—å—à–µ!'; 
                }
            }
            
            document.getElementById('attempts').textContent = attempts;
            document.getElementById('score').textContent = Math.max(0, 10000 - attempts * 5);
            document.getElementById('hint').innerHTML = `<span style="color:${color};">${hint}</span>`;
            input.value = ''; input.focus();
        }

        // üî• –ê–í–¢–û–§–ò–ö–° –ö–ù–û–ü–û–ö
        setInterval(initButtons, 500);

        // üöÄ –°–¢–ê–†–¢
        document.addEventListener('DOMContentLoaded', () => {
            checkUserStatus();
            setInterval(() => { 
                if (isLoggedIn) { 
                    loadLeaderboard(); 
                    loadTournament(); 
                } 
            }, 30000);
        });
    </script>
</body>
</html>
