<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üöÄ ALEKSIN GAMES HUB v4.1 | –ì–õ–û–ë–ê–õ–¨–ù–´–ï –õ–ò–î–ï–†–ë–û–†–î–´</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap');
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Orbitron', monospace;
            background: linear-gradient(-45deg, #0f0f23, #1a0033, #330066, #000);
            background-size: 400% 400%;
            animation: gradientShift 8s ease infinite;
            color: #fff;
            overflow-x: hidden;
            min-height: 100vh;
        }
        @keyframes gradientShift { 0%,100%{background-position:0% 50%;}50%{background-position:100% 50%;} }
        
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .header {
            text-align: center; margin-bottom: 30px;
            background: linear-gradient(45deg, #ff00ff, #00ffff, #ffff00);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            background-clip: text; font-size: 3em; font-weight: 900; text-shadow: 0 0 30px #ff00ff;
            animation: rgbGlow 2s ease-in-out infinite alternate;
        }
        @keyframes rgbGlow { from{filter:hue-rotate(0deg);}to{filter:hue-rotate(360deg);} }

        .auth-panel { 
            background: rgba(0,0,0,0.8); backdrop-filter: blur(20px); border-radius: 20px;
            padding: 30px; margin: 20px 0; border: 2px solid; box-shadow: 0 0 50px rgba(0,255,255,0.3);
            animation: float 3s ease-in-out infinite; max-width: 400px; margin: 20px auto;
        }
        @keyframes float { 0%,100%{transform:translateY(0);}50%{transform:translateY(-10px);} }

        .login-form, .register-form { 
            display: flex; flex-direction: column; gap: 15px; 
        }
        .form-group { display: flex; gap: 10px; }
        .form-group button { flex: 1; padding: 12px; }
        
        input { padding: 15px; border: none; border-radius: 10px; background: rgba(255,255,255,0.1);
                color: #fff; font-size: 16px; font-family: inherit; }
        input::placeholder { color: #aaa; }
        button {
            padding: 15px; border: none; border-radius: 10px; font-weight: 700; font-size: 16px; 
            cursor: pointer; transition: all 0.3s; box-shadow: 0 5px 15px rgba(0,255,255,0.4);
        }
        .login-btn { background: linear-gradient(45deg, #ff00ff, #00ffff); color: #000; }
        .register-btn { background: linear-gradient(45deg, #00ff00, #00ff88); color: #000; }
        button:hover { transform: scale(1.05); box-shadow: 0 10px 30px rgba(0,255,255,0.6); }
        button:active { transform: scale(0.98); }

        .hidden { display: none !important; }
        .status { text-align: center; font-size: 1.2em; margin: 10px 0; }
        .welcome { color: #00ffff; font-size: 1.5em; }

        .games-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; }
        .game-card {
            background: rgba(0,0,0,0.7); border-radius: 20px; padding: 20px; text-align: center;
            border: 2px solid transparent; cursor: pointer; transition: all 0.3s;
        }
        .game-card:hover { border-color: #00ffff; box-shadow: 0 0 30px #00ffff; transform: translateY(-10px); }
        .game-card h3 { color: #00ffff; margin-bottom: 10px; font-size: 1.5em; }

        .leaderboards, .tournament { 
            background: rgba(0,255,0,0.1); border: 2px solid #00ff00; margin: 20px 0; 
            border-radius: 15px; padding: 20px;
        }
        .leaderboards h2, .tournament h2 { color: #00ff00; text-align: center; margin-bottom: 20px; }
        .leaderboard-list, .tournament-list { max-height: 300px; overflow-y: auto; }
        .leaderboard-list ol, .tournament-list ol { padding-left: 20px; }
        .leaderboard-list li, .tournament-list li {
            padding: 8px; margin: 5px 0; background: rgba(255,255,255,0.1); 
            border-radius: 8px; display: flex; justify-content: space-between;
        }
        .rank-1 { border-left: 5px solid #ffd700; } 
        .rank-2 { border-left: 5px solid #c0c0c0; } 
        .rank-3 { border-left: 5px solid #cd7f32; } 
        .prize { color: #ffd700; font-weight: bold; }

        #gameCanvas { border: 3px solid #00ffff; border-radius: 10px; background: #000; 
                      display: block; margin: 10px auto; }
        .controls { display: flex; gap: 10px; justify-content: center; flex-wrap: wrap; margin: 10px 0; }
        .control-btn { width: 60px; height: 60px; border-radius: 50%; background: rgba(0,255,255,0.3); 
                       border: none; color: #fff; font-size: 18px; cursor: pointer; }
        .control-btn:active { background: #00ffff; transform: scale(0.9); }

        @media (max-width: 768px) {
            .header { font-size: 2em; } .container { padding: 10px; }
            .games-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="header">üöÄ ALEKSIN GAMES HUB v4.1</h1>
        
        <!-- ‚úÖ –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø + –†–ï–ì–ò–°–¢–†–ê–¶–ò–Ø -->
        <div id="authPanel" class="auth-panel">
            <div class="status" id="status">üîê –í–•–û–î / –†–ï–ì–ò–°–¢–†–ê–¶–ò–Ø</div>
            
            <!-- –õ–û–ì–ò–ù -->
            <div id="loginForm" class="login-form">
                <input type="text" id="username" placeholder="üë§ –õ–æ–≥–∏–Ω (test)" value="test">
                <input type="password" id="password" placeholder="üîë –ü–∞—Ä–æ–ª—å (123456)">
                <div class="form-group">
                    <button type="submit" class="login-btn">üöÄ –í–û–ô–¢–ò</button>
                    <button type="button" class="register-btn" onclick="showRegister()">üìù –†–ï–ì–ò–°–¢–†–ê–¶–ò–Ø</button>
                </div>
                <div style="text-align:center; font-size:14px;">
                    <small>–î–µ–º–æ: test / 123456</small>
                </div>
            </div>

            <!-- –†–ï–ì–ò–°–¢–†–ê–¶–ò–Ø -->
            <div id="registerForm" class="register-form hidden">
                <h3 style="text-align:center; color:#00ff00;">üìù –°–û–ó–î–ê–¢–¨ –ê–ö–ö–ê–£–ù–¢</h3>
                <input type="text" id="regUsername" placeholder="üë§ vasya">
                <input type="password" id="regPassword" placeholder="üîë 6+ —Å–∏–º–≤–æ–ª–æ–≤">
                <div class="form-group">
                    <button onclick="doRegister()" class="register-btn">‚úÖ –°–û–ó–î–ê–¢–¨</button>
                    <button onclick="showLogin()" class="login-btn">üîô –ö –õ–û–ì–ò–ù–£</button>
                </div>
            </div>
        </div>

        <!-- ‚úÖ –ò–ì–†–´ + –õ–ò–î–ï–†–ë–û–†–î–´ -->
        <div id="mainPanel" class="hidden">
            <div class="status welcome" id="welcome"></div>
            <button onclick="logout()" style="float:right; padding:10px 20px; font-size:14px; background:#ff4444;color:#fff;border-radius:10px;border:none;">üö™ –í—ã—Ö–æ–¥</button>
            
            <div class="games-grid">
                <div class="game-card" onclick="startSnake('easy')">
                    <h3>üêç –ó–ú–ï–ô–ö–ê EASY</h3><p>–ö–ª–∞—Å—Å–∏–∫–∞ touch/WASD</p>
                </div>
                <div class="game-card" onclick="startSnake('medium')">
                    <h3>üêç –ó–ú–ï–ô–ö–ê MEDIUM</h3><p>–í—ã—Å–æ–∫–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å!</p>
                </div>
                <div class="game-card" onclick="startGuess('easy')">
                    <h3>üéØ –£–ì–ê–î–ê–ô–ö–ê EASY (1-100)</h3><p>–ü–æ–¥—Å–∫–∞–∑–∫–∏ + —Ä–µ–∫–æ—Ä–¥</p>
                </div>
                <div class="game-card" onclick="startGuess('hard')">
                    <h3>üéØ –£–ì–ê–î–ê–ô–ö–ê HARD (1-10000)</h3><p>–î–ª—è –ø—Ä–æ—Ñ–∏!</p>
                </div>
            </div>

            <div id="leaderboards" class="leaderboards hidden"></div>
            <div id="tournament" class="tournament hidden"></div>
        </div>
    </div>

    <canvas id="gameCanvas" width="400" height="400" class="hidden"></canvas>
    <div class="controls hidden" id="controls">
        <button class="control-btn" onclick="changeDirection('up')">‚Üë</button>
        <button class="control-btn" onclick="changeDirection('left')">‚Üê</button>
        <button class="control-btn" onclick="changeDirection('right')">‚Üí</button>
        <button class="control-btn" onclick="changeDirection('down')">‚Üì</button>
    </div>

    <script>
        let currentUser = null;
        let snakeDir = {x: 0, y: 0};
        let gameActive = false;

        // –ê–í–¢–û–û–ë–ù–û–í–õ–ï–ù–ò–ï –õ–ò–î–ï–†–ë–û–†–î–û–í
        setInterval(() => { if (currentUser) { updateLeaderboards(); updateTournament(); } }, 5000);

        // ‚úÖ –õ–û–ì–ò–ù
        document.getElementById('loginForm').addEventListener('submit', async e => {
            e.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            const response = await fetch('/login', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({username, password})
            });
            
            const result = await response.json();
            if (result.success) {
                loginSuccess(username);
            } else {
                document.getElementById('status').textContent = '‚ùå ' + (result.error || '–û—à–∏–±–∫–∞');
            }
        });

        // ‚úÖ –†–ï–ì–ò–°–¢–†–ê–¶–ò–Ø
        function showRegister() {
            document.getElementById('loginForm').classList.add('hidden');
            document.getElementById('registerForm').classList.remove('hidden');
        }

        function showLogin() {
            document.getElementById('registerForm').classList.add('hidden');
            document.getElementById('loginForm').classList.remove('hidden');
        }

        async function doRegister() {
            const username = document.getElementById('regUsername').value;
            const password = document.getElementById('regPassword').value;
            
            if (username.length < 3 || password.length < 3) {
                alert('‚ùå –õ–æ–≥–∏–Ω –∏ –ø–∞—Ä–æ–ª—å –æ—Ç 3 —Å–∏–º–≤–æ–ª–æ–≤!');
                return;
            }
            
            const response = await fetch('/register', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({username, password})
            });
            
            const result = await response.json();
            if (result.success) {
                loginSuccess(username);
            } else {
                alert('‚ùå ' + result.error);
            }
        }

        // –£–°–ü–ï–®–ù–´–ô –í–•–û–î/–†–ï–ì–ò–°–¢–†–ê–¶–ò–Ø
        function loginSuccess(username) {
            currentUser = username;
            document.getElementById('status').textContent = `‚úÖ –ü—Ä–∏–≤–µ—Ç, ${username}!`;
            document.getElementById('welcome').textContent = `üéÆ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ${username}!`;
            document.getElementById('authPanel').classList.add('hidden');
            document.getElementById('mainPanel').classList.remove('hidden');
            updateLeaderboards();
            updateTournament();
        }

        // –ì–õ–û–ë–ê–õ–¨–ù–´–ô –¢–û–ü-10
        async function updateLeaderboards() {
            const games = ['snake_easy', 'snake_medium', 'guess_easy', 'guess_hard'];
            let html = '<h2>üèÜ –ì–õ–û–ë–ê–õ–¨–ù–´–ï –¢–û–ü-10 (–í–°–ï –ò–ì–†–û–ö–ò)</h2>';
            
            for (let game of games) {
                try {
                    const response = await fetch(`/api/leaderboard/${game}`);
                    const top10 = await response.json();
                    html += `<h3>${game.toUpperCase().replace('_', ' ')}</h3><ol class="leaderboard-list">`;
                    top10.forEach((player, i) => {
                        const rankClass = i < 3 ? `rank-${i+1}` : '';
                        html += `<li class="${rankClass}"><span>#${i+1} ${player.user}</span><span>${player.points} (${player.difficulty})</span></li>`;
                    });
                    html += '</ol>';
                } catch(e) {
                    html += `<p>–ó–∞–≥—Ä—É–∑–∫–∞ ${game}...</p>`;
                }
            }
            document.getElementById('leaderboards').innerHTML = html;
            document.getElementById('leaderboards').classList.remove('hidden');
        }

        // –¢–£–†–ù–ò–†
        async function updateTournament() {
            try {
                const response = await fetch('/api/tournament');
                const top100 = await response.json();
                let html = '<h2>‚öîÔ∏è –¢–£–†–ù–ò–† –°–ï–ì–û–î–ù–Ø (–¢–û–ü-100)</h2><ol class="tournament-list">';
                top100.slice(0,100).forEach((player, i) => {
                    const prize = i < 5 ? `<span class="prize">ü•á +${100*(6-(i+1))} –æ—á–∫–æ–≤</span>` : '';
                    html += `<li>${player.rank || i+1}. ${player.user}: ${player.points} ${prize}</li>`;
                });
                html += '</ol>';
                document.getElementById('tournament').innerHTML = html;
                document.getElementById('tournament').classList.remove('hidden');
            } catch(e) {
                document.getElementById('tournament').innerHTML = '<h2>‚öîÔ∏è –¢—É—Ä–Ω–∏—Ä: –ó–∞–≥—Ä—É–∑–∫–∞...</h2>';
            }
        }

        // –°–û–•–†–ê–ù–ï–ù–ò–ï –†–ï–ö–û–†–î–ê
        async function saveScore(game, points, difficulty = 'normal') {
            await fetch('/api/scores', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({game, points, difficulty})
            });
            updateLeaderboards(); updateTournament();
        }

        // –í–´–•–û–î
        async function logout() {
            await fetch('/logout');
            location.reload();
        }

        // üêç –ó–ú–ï–ô–ö–ê (–û–°–¢–ê–í–¨ –ö–ê–ö –ë–´–õ–û)
        function startSnake(difficulty) {
            const canvas = document.getElementById('gameCanvas');
            const ctx = canvas.getContext('2d');
            canvas.classList.remove('hidden');
            document.getElementById('controls').classList.remove('hidden');
            
            let snake = [{x: 10, y: 10}];
            let food = {x: 15, y: 15};
            let score = 0;
            gameActive = true;
            
            function gameLoop() {
                if (!gameActive) return;
                
                ctx.fillStyle = '#000';
                ctx.fillRect(0, 0, 400, 400);
                
                ctx.fillStyle = '#00ff00';
                snake.forEach(part => ctx.fillRect(part.x*20, part.y*20, 20, 20));
                
                ctx.fillStyle = '#ff0000';
                ctx.fillRect(food.x*20, food.y*20, 20, 20);
                
                let head = {x: snake[0].x + snakeDir.x, y: snake[0].y + snakeDir.y};
                
                if (head.x < 0 || head.x >= 20 || head.y < 0 || head.y >= 20 || 
                    snake.some(s => s.x === head.x && s.y === head.y)) {
                    saveScore(`snake_${difficulty}`, score, difficulty);
                    alert(`–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞! –†–µ–∫–æ—Ä–¥: ${score}`);
                    gameActive = false;
                    canvas.classList.add('hidden');
                    document.getElementById('controls').classList.add('hidden');
                    return;
                }
                
                snake.unshift(head);
                if (head.x === food.x && head.y === food.y) {
                    score += 100;
                    food = {x: Math.floor(Math.random()*19), y: Math.floor(Math.random()*19)};
                } else {
                    snake.pop();
                }
                
                setTimeout(gameLoop, difficulty === 'easy' ? 200 : 100);
            }
            gameLoop();
        }

        function changeDirection(dir) {
            const directions = {
                up: {x: 0, y: -1}, down: {x: 0, y: 1},
                left: {x: -1, y: 0}, right: {x: 1, y: 0}
            };
            if ((dir === 'up' && snakeDir.y !== 1) || (dir === 'down' && snakeDir.y !== -1) ||
                (dir === 'left' && snakeDir.x !== 1) || (dir === 'right' && snakeDir.x !== -1)) {
                snakeDir = directions[dir];
            }
        }

        // TOUCH + –ö–õ–ê–í–ò–ê–¢–£–†–ê (–û–°–¢–ê–í–¨ –ö–ê–ö –ë–´–õ–û)
        let touchStartX, touchStartY;
        document.addEventListener('touchstart', e => {
            touchStartX = e.touches[0].clientX;
            touchStartY = e.touches[0].clientY;
            e.preventDefault();
        });
        document.addEventListener('touchend', e => {
            if (!touchStartX || !touchStartY) return;
            let touchEndX = e.changedTouches[0].clientX;
            let touchEndY = e.changedTouches[0].clientY;
            let dx = touchEndX - touchStartX;
            let dy = touchEndY - touchStartY;
            
            if (Math.abs(dx) > Math.abs(dy)) {
                changeDirection(dx > 0 ? 'right' : 'left');
            } else {
                changeDirection(dy > 0 ? 'down' : 'up');
            }
            touchStartX = null; touchStartY = null;
            e.preventDefault();
        });

        document.addEventListener('keydown', e => {
            if (e.key === 'ArrowUp') changeDirection('up');
            if (e.key === 'ArrowDown') changeDirection('down');
            if (e.key === 'ArrowLeft') changeDirection('left');
            if (e.key === 'ArrowRight') changeDirection('right');
        });

        // üéØ –£–ì–ê–î–ê–ô–ö–ê (–û–°–¢–ê–í–¨ –ö–ê–ö –ë–´–õ–û)
        function startGuess(difficulty) {
            const maxNum = difficulty === 'easy' ? 100 : 10000;
            const target = Math.floor(Math.random() * maxNum) + 1;
            let attempts = 0;
            let min = 1, max = maxNum;
            
            const canvas = document.getElementById('gameCanvas');
            canvas.classList.remove('hidden');
            
            const guessInput = document.createElement('input');
            guessInput.placeholder = '–í–≤–µ–¥–∏ —á–∏—Å–ª–æ';
            guessInput.style.cssText = 'position:fixed;top:10px;left:50%;transform:translateX(-50%);padding:10px;z-index:1000;border-radius:10px;background:rgba(0,255,255,0.2);color:#fff;border:2px solid #00ffff;';
            document.body.appendChild(guessInput);
            
            function checkGuess() {
                const guess = parseInt(guessInput.value);
                if (isNaN(guess)) return;
                attempts++;
                if (guess === target) {
                    const points = maxNum - attempts * 10;
                    saveScore(`guess_${difficulty}`, points, difficulty);
                    alert(`‚úÖ –£–≥–∞–¥–∞–ª –∑–∞ ${attempts} –ø–æ–ø—ã—Ç–æ–∫! –†–µ–∫–æ—Ä–¥: ${points}`);
                    document.body.removeChild(guessInput);
                    canvas.classList.add('hidden');
                } else {
                    if (guess < target) {
                        min = guess;
                        document.getElementById('status').textContent = `‚¨ÜÔ∏è –ë–æ–ª—å—à–µ! –î–∏–∞–ø–∞–∑–æ–Ω: ${min}-${max}`;
                    } else {
                        max = guess;
                        document.getElementById('status').textContent = `‚¨áÔ∏è –ú–µ–Ω—å—à–µ! –î–∏–∞–ø–∞–∑–æ–Ω: ${min}-${max}`;
                    }
                }
                guessInput.value = '';
            }
            
            guessInput.addEventListener('keypress', e => {
                if (e.key === 'Enter') checkGuess();
            });
            
            document.getElementById('controls').classList.remove('hidden');
            document.querySelector('.control-btn:last-child').textContent = 'üéØ';
            document.querySelector('.control-btn:last-child').onclick = checkGuess;
        }
    </script>
</body>
</html>
