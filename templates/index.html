<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Aleksin Arcade v1</title>
  <style>
    body{margin:0;font-family:sans-serif;background:#05091a;color:#0ff}
    .wrap{max-width:1100px;margin:0 auto;padding:20px}
    h1{text-align:center;margin-bottom:10px}
    h2{margin:20px 0 10px}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(320px,1fr));gap:20px}
    .card{background:#0b1028;border:1px solid #0ff3;border-radius:10px;padding:15px}
    button,select,input{margin:5px 0;padding:6px 10px;background:#020514;color:#0ff;border:1px solid #0ff;border-radius:5px}
    canvas{background:#020514;border:1px solid #0ff;border-radius:5px;display:block;margin:10px auto}
    table{width:100%;border-collapse:collapse;font-size:14px}
    th,td{border:1px solid #0ff3;padding:4px 6px;text-align:left}
    th{background:#061022}
    .small{font-size:12px;color:#9cf}
  </style>
</head>
<body>
<div class="wrap">
  <h1>Aleksin Arcade</h1>
  <div class="small">–í—Å–µ —Ä–µ–∫–æ—Ä–¥—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ localStorage —ç—Ç–æ–≥–æ –±—Ä–∞—É–∑–µ—Ä–∞.</div>

  <!-- –ò–≥—Ä—ã -->
  <h2>–ò–≥—Ä—ã</h2>
  <div class="grid">
    <!-- –ó–º–µ–π–∫–∞ -->
    <div class="card">
      <h3>üêç –ó–º–µ–π–∫–∞</h3>
      <div>
        –ù–∏–∫: <input id="nickSnake" placeholder="–Ω–∏–∫">
      </div>
      <div>
        –°–ª–æ–∂–Ω–æ—Å—Ç—å:
        <select id="snakeDiff">
          <option value="easy">–õ–µ–≥–∫–æ</option>
          <option value="normal" selected>–ù–æ—Ä–º–∞–ª—å–Ω–æ</option>
          <option value="hard">–°–ª–æ–∂–Ω–æ</option>
          <option value="extreme">–≠–∫—Å—Ç—Ä–∏–º</option>
        </select>
      </div>
      <button id="snakeStartBtn">–ò–≥—Ä–∞—Ç—å</button>
      <div>–°—á—ë—Ç: <span id="snakeScore">0</span></div>
      <canvas id="snakeCanvas" width="320" height="320"></canvas>
    </div>

    <!-- –£–≥–∞–¥–∞–π–∫–∞ -->
    <div class="card">
      <h3>üî¢ –£–≥–∞–¥–∞–π–∫–∞</h3>
      <div>
        –ù–∏–∫: <input id="nickGuess" placeholder="–Ω–∏–∫">
      </div>
      <div>
        –°–ª–æ–∂–Ω–æ—Å—Ç—å:
        <select id="guessDiff">
          <option value="100">1‚Äì100 (–ª–µ–≥–∫–æ)</option>
          <option value="1000" selected>1‚Äì1000 (–Ω–æ—Ä–º–∞–ª—å–Ω–æ)</option>
          <option value="10000">1‚Äì10k (—Å–ª–æ–∂–Ω–æ)</option>
          <option value="100000">1‚Äì100k (—ç–∫—Å—Ç—Ä–∏–º)</option>
        </select>
      </div>
      <div>
        <input id="guessInput" type="number" placeholder="—á–∏—Å–ª–æ">
        <button id="guessBtn">–£–≥–∞–¥–∞—Ç—å</button>
      </div>
      <div>–ü–æ–ø—ã—Ç–æ–∫: <span id="guessTries">0</span></div>
      <div id="guessHint" class="small">–ù–∞—á–Ω–∏ –∏–≥—Ä—É.</div>
    </div>
  </div>

  <!-- –¢–∞–±–ª–∏—Ü—ã –ª–∏–¥–µ—Ä–æ–≤ -->
  <h2>–¢–æ–ø‚Äë10 –ó–º–µ–π–∫–∞ (–ø–æ —Å–ª–æ–∂–Ω–æ—Å—Ç—è–º)</h2>
  <table id="snakeTable">
    <thead>
    <tr><th>–°–ª–æ–∂–Ω–æ—Å—Ç—å</th><th>–ú–µ—Å—Ç–æ</th><th>–ù–∏–∫</th><th>–°—á—ë—Ç</th></tr>
    </thead>
    <tbody></tbody>
  </table>

  <h2>–¢–æ–ø‚Äë10 –£–≥–∞–¥–∞–π–∫–∞ (–ø–æ —Å–ª–æ–∂–Ω–æ—Å—Ç—è–º)</h2>
  <table id="guessTable">
    <thead>
    <tr><th>–î–∏–∞–ø–∞–∑–æ–Ω</th><th>–ú–µ—Å—Ç–æ</th><th>–ù–∏–∫</th><th>–û—á–∫–∏</th></tr>
    </thead>
    <tbody></tbody>
  </table>

  <h2>–¢—É—Ä–Ω–∏—Ä—ã (–æ–±—â–∏–µ —Ç–æ–ø‚Äë10)</h2>
  <table id="tournamentTable">
    <thead>
    <tr><th>–ò–≥—Ä–∞</th><th>–ú–µ—Å—Ç–æ</th><th>–ù–∏–∫</th><th>–û—á–∫–∏</th></tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<script>
  /* ======= –û–ë–©–ï–ï –•–†–ê–ù–ò–õ–ò–©–ï ======= */
  const LS_SNAKE = 'arcade_snake_scores';
  const LS_GUESS = 'arcade_guess_scores';
  const LS_TOURN = 'arcade_tournament_scores';

  function loadScores(key){
    try{ return JSON.parse(localStorage.getItem(key) || '[]'); }
    catch(e){ return []; }
  }
  function saveScores(key, arr){
    localStorage.setItem(key, JSON.stringify(arr));
  }

  function addScore(key, record){
    const arr = loadScores(key);
    arr.push(record);
    arr.sort((a,b)=>b.score - a.score);
    saveScores(key, arr.slice(0,50)); // —Ö—Ä–∞–Ω–∏–º –¥–æ 50 –∑–∞–ø–∏—Å–µ–π
  }

  /* ======= –ó–ú–ï–ô–ö–ê ======= */
  const snakeCanvas = document.getElementById('snakeCanvas');
  const sctx = snakeCanvas.getContext('2d');
  const cell = 16;
  let snake, food, vx, vy, snakeTimer, snakeRunning = false, snakeScore = 0;

  function startSnake(){
    if(snakeRunning) return;
    const nick = document.getElementById('nickSnake').value.trim() || 'anon';
    const diff = document.getElementById('snakeDiff').value; // easy/normal/hard/extreme

    // —Å–∫–æ—Ä–æ—Å—Ç—å –ø–æ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏
    const speedMap = {easy:200,normal:140,hard:100,extreme:70};
    const speed = speedMap[diff] || 140;

    snake = [{x:10,y:10}];
    food = {x:5,y:5};
    vx = 1; vy = 0;
    snakeScore = 0;
    document.getElementById('snakeScore').textContent = '0';
    snakeRunning = true;

    function placeFood(){
      food.x = Math.floor(Math.random()* (snakeCanvas.width/cell));
      food.y = Math.floor(Math.random()* (snakeCanvas.height/cell));
    }

    function step(){
      sctx.fillStyle = '#020514';
      sctx.fillRect(0,0,snakeCanvas.width,snakeCanvas.height);

      const head = {x:snake[0].x + vx, y:snake[0].y + vy};

      // —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–µ —Å–æ —Å—Ç–µ–Ω–æ–π
      if(head.x<0 || head.y<0 || head.x>=snakeCanvas.width/cell || head.y>=snakeCanvas.height/cell){
        endSnake(nick,diff);
        return;
      }
      // —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–µ —Å —Å–æ–±–æ–π
      if(snake.some(p=>p.x===head.x && p.y===head.y)){
        endSnake(nick,diff);
        return;
      }

      snake.unshift(head);
      // –µ–¥–∞
      if(head.x===food.x && head.y===food.y){
        snakeScore += 10;
        document.getElementById('snakeScore').textContent = snakeScore;
        placeFood();
      }else{
        snake.pop();
      }

      // —Ä–∏—Å—É–µ–º –µ–¥—É
      sctx.fillStyle = '#f0f';
      sctx.fillRect(food.x*cell, food.y*cell, cell, cell);

      // —Ä–∏—Å—É–µ–º –∑–º–µ–π–∫—É
      snake.forEach((p,i)=>{
        sctx.fillStyle = i===0 ? '#0f0' : '#0a8';
        sctx.fillRect(p.x*cell, p.y*cell, cell-1, cell-1);
      });
    }

    placeFood();
    clearInterval(snakeTimer);
    snakeTimer = setInterval(step, speed);

    document.onkeydown = e=>{
      if(e.key==='ArrowUp' && vy!==1){vx=0;vy=-1;}
      else if(e.key==='ArrowDown' && vy!==-1){vx=0;vy=1;}
      else if(e.key==='ArrowLeft' && vx!==1){vx=-1;vy=0;}
      else if(e.key==='ArrowRight' && vx!==-1){vx=1;vy=0;}
    };

    function endSnake(nick,diff){
      clearInterval(snakeTimer);
      snakeRunning = false;
      addScore(LS_SNAKE,{nick,mode:diff,score:snakeScore,date:Date.now()});
      addScore(LS_TOURN,{nick,game:'snake',score:snakeScore,date:Date.now()});
      renderAllTables();
      alert('–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞. –°—á—ë—Ç: '+snakeScore);
    }
  }

  document.getElementById('snakeStartBtn').onclick = startSnake;

  /* ======= –£–ì–ê–î–ê–ô–ö–ê ======= */
  let guessNumber = 0, guessMax = 1000, guessTries = 0;

  function newGuessRound(){
    guessMax = parseInt(document.getElementById('guessDiff').value,10);
    guessNumber = Math.floor(Math.random()*guessMax)+1;
    guessTries = 0;
    document.getElementById('guessTries').textContent = '0';
    document.getElementById('guessHint').textContent = '–ó–∞–≥–∞–¥–∞–Ω–æ —á–∏—Å–ª–æ –æ—Ç 1 –¥–æ '+guessMax;
    document.getElementById('guessInput').value = '';
  }

  function makeGuess(){
    if(!guessNumber) newGuessRound();
    const nick = document.getElementById('nickGuess').value.trim() || 'anon';
    const val = parseInt(document.getElementById('guessInput').value,10);
    if(!val || val<1 || val>guessMax){
      document.getElementById('guessHint').textContent = '–ß–∏—Å–ª–æ –æ—Ç 1 –¥–æ '+guessMax;
      return;
    }
    guessTries++;
    document.getElementById('guessTries').textContent = guessTries;
    if(val===guessNumber){
      // —Ñ–æ—Ä–º—É–ª–∞ –æ—á–∫–æ–≤: —á–µ–º –º–µ–Ω—å—à–µ –ø–æ–ø—ã—Ç–æ–∫, —Ç–µ–º –±–æ–ª—å—à–µ
      const base = 10000;
      const penalty = guessTries*200;
      const score = Math.max(100, base - penalty);
      addScore(LS_GUESS,{nick,range:guessMax,score,tries:guessTries,date:Date.now()});
      addScore(LS_TOURN,{nick,game:'guess',score,date:Date.now()});
      renderAllTables();
      document.getElementById('guessHint').textContent =
        '–£–≥–∞–¥–∞–ª –∑–∞ '+guessTries+' –ø–æ–ø—ã—Ç–æ–∫, –æ—á–∫–∏: '+score+'. –ù–æ–≤–æ–µ —á–∏—Å–ª–æ –∑–∞–≥–∞–¥–∞–Ω–æ.';
      newGuessRound();
    }else if(val<guessNumber){
      document.getElementById('guessHint').textContent = '–ë–æ–ª—å—à–µ';
    }else{
      document.getElementById('guessHint').textContent = '–ú–µ–Ω—å—à–µ';
    }
    document.getElementById('guessInput').value = '';
  }

  document.getElementById('guessBtn').onclick = makeGuess;
  newGuessRound();

  /* ======= –†–ï–ù–î–ï–† –¢–ê–ë–õ–ò–¶ ======= */
  function renderSnakeTable(){
    const body = document.querySelector('#snakeTable tbody');
    body.innerHTML = '';
    const data = loadScores(LS_SNAKE);

    const modes = ['easy','normal','hard','extreme'];
    const modeNames = {easy:'–õ–µ–≥–∫–æ',normal:'–ù–æ—Ä–º–∞–ª—å–Ω–æ',hard:'–°–ª–æ–∂–Ω–æ',extreme:'–≠–∫—Å—Ç—Ä–∏–º'};

    modes.forEach(mode=>{
      const list = data.filter(r=>r.mode===mode).sort((a,b)=>b.score-a.score).slice(0,10);
      list.forEach((r,i)=>{
        const tr = document.createElement('tr');
        tr.innerHTML =
          `<td>${modeNames[mode]}</td><td>${i+1}</td><td>${r.nick}</td><td>${r.score}</td>`;
        body.appendChild(tr);
      });
    });
  }

  function renderGuessTable(){
    const body = document.querySelector('#guessTable tbody');
    body.innerHTML = '';
    const data = loadScores(LS_GUESS);

    const ranges = [100,1000,10000,100000];
    ranges.forEach(rg=>{
      const list = data.filter(r=>r.range===rg).sort((a,b)=>b.score-a.score).slice(0,10);
      list.forEach((r,i)=>{
        const tr = document.createElement('tr');
        tr.innerHTML =
          `<td>1‚Äì${rg}</td><td>${i+1}</td><td>${r.nick}</td><td>${r.score}</td>`;
        body.appendChild(tr);
      });
    });
  }

  function renderTournamentTable(){
    const body = document.querySelector('#tournamentTable tbody');
    body.innerHTML = '';
    const data = loadScores(LS_TOURN);
    const games = ['snake','guess'];
    const gameNames = {snake:'–ó–º–µ–π–∫–∞',guess:'–£–≥–∞–¥–∞–π–∫–∞'};

    games.forEach(game=>{
      const list = data.filter(r=>r.game===game).sort((a,b)=>b.score-a.score).slice(0,10);
      list.forEach((r,i)=>{
        const tr = document.createElement('tr');
        tr.innerHTML =
          `<td>${gameNames[game]}</td><td>${i+1}</td><td>${r.nick}</td><td>${r.score}</td>`;
        body.appendChild(tr);
      });
    });
  }

  function renderAllTables(){
    renderSnakeTable();
    renderGuessTable();
    renderTournamentTable();
  }

  renderAllTables();
</script>
</body>
</html>
