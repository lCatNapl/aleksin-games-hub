<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéÆ ALEKSIN GAMES HUB 2026 ‚ú®</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Exo+2:wght@300;400;600;800&display=swap');
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Exo 2', sans-serif;
            background: linear-gradient(-45deg, #0f0f23, #1a0033, #2d004f, #0f0f23);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
            color: #fff;
            min-height: 100vh;
            overflow-x: hidden;
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .container { max-width: 1400px; margin: 0 auto; padding: 20px; }
        .header { text-align: center; margin-bottom: 40px; }
        .title {
            font-family: 'Orbitron', monospace;
            font-size: clamp(2.5rem, 8vw, 5rem);
            background: linear-gradient(45deg, #00ff88, #00bfff, #ff00ff, #ffff00);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 0 30px rgba(0, 255, 136, 0.5);
            animation: neonGlow 2s ease-in-out infinite alternate;
            margin-bottom: 20px;
        }
        @keyframes neonGlow {
            from { filter: drop-shadow(0 0 10px #00ff88); }
            to { filter: drop-shadow(0 0 20px #00ff88); }
        }
        .subtitle { font-size: 1.5rem; color: #00ff88; text-shadow: 0 0 15px rgba(0, 255, 136, 0.3); }

        /* üîê –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø */
        #authSection {
            display: block; max-width: 500px; margin: 0 auto; padding: 50px;
            background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(20px);
            border-radius: 25px; border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
        }
        #loginPrompt { text-align: center; font-size: 1.8rem; color: #00ff88; margin-bottom: 30px; }
        .auth-input {
            width: 100%; padding: 20px; margin: 15px 0; border: none; border-radius: 15px;
            background: rgba(255, 255, 255, 0.15); backdrop-filter: blur(10px);
            color: #fff; font-size: 1.2rem; font-family: 'Exo 2', sans-serif;
            border: 2px solid transparent; transition: all 0.3s ease;
        }
        .auth-input::placeholder { color: rgba(255, 255, 255, 0.7); }
        .auth-input:focus { outline: none; border-color: #00ff88; box-shadow: 0 0 20px rgba(0, 255, 136, 0.4); }
        .btn {
            width: 100%; padding: 20px; margin: 10px 0; border: none; border-radius: 15px;
            font-size: 1.3rem; font-weight: 600; font-family: 'Exo 2', sans-serif;
            cursor: pointer; transition: all 0.3s ease; text-transform: uppercase; letter-spacing: 1px;
        }
        .btn-primary { background: linear-gradient(45deg, #00ff88, #00bfff); color: #000; box-shadow: 0 10px 30px rgba(0, 255, 136, 0.4); }
        .btn-primary:hover { transform: translateY(-3px); box-shadow: 0 15px 40px rgba(0, 255, 136, 0.6); }
        .btn-secondary { background: linear-gradient(45deg, #ff4757, #ff6b7a); color: #fff; }
        .btn-secondary:hover { transform: translateY(-3px); box-shadow: 0 15px 40px rgba(255, 71, 87, 0.6); }

        /* üéÆ –ö–û–ù–¢–ï–ù–¢ */
        #gamesSection, #userInfo { display: none; }
        .games-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 30px; margin-bottom: 50px;
        }
        .glass-card {
            background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(20px); border-radius: 25px; padding: 30px;
            border: 1px solid rgba(255, 255, 255, 0.2); transition: all 0.4s ease; position: relative; overflow: hidden;
        }
        .glass-card::before {
            content: ''; position: absolute; top: 0; left: -100%; width: 100%; height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent); transition: left 0.6s;
        }
        .glass-card:hover::before { left: 100%; }
        .glass-card:hover { transform: translateY(-15px); box-shadow: 0 30px 60px rgba(0, 0, 0, 0.6); }
        .game-icon { font-size: 4rem; margin-bottom: 20px; text-shadow: 0 0 20px currentColor; }
        .game-title { font-family: 'Orbitron', monospace; font-size: 2rem; margin-bottom: 15px; color: #00ff88; }
        .features { margin-bottom: 25px; }
        .feature {
            display: inline-block; background: rgba(0, 255, 136, 0.2); padding: 8px 15px; margin: 5px;
            border-radius: 20px; font-size: 0.9rem; color: #00ff88;
        }

        /* üèÜ –õ–ò–î–ï–†–ë–û–†–î–´ */
        .leaderboards { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 30px; margin-bottom: 50px; }
        .leaderboard-card {
            background: rgba(0, 255, 136, 0.1); backdrop-filter: blur(20px); border-radius: 25px; padding: 30px;
            border: 1px solid rgba(0, 255, 136, 0.3);
        }
        .lb-title {
            font-family: 'Orbitron', monospace; font-size: 1.8rem; text-align: center; margin-bottom: 25px;
            color: #ffd700; text-shadow: 0 0 15px rgba(255, 215, 0, 0.5);
        }
        .lb-list { list-style: none; max-height: 400px; overflow-y: auto; }
        .lb-item {
            display: flex; justify-content: space-between; align-items: center; padding: 15px; margin: 10px 0;
            background: rgba(255, 255, 255, 0.1); border-radius: 15px; transition: all 0.3s ease;
        }
        .lb-item:hover { background: rgba(255, 255, 255, 0.2); transform: translateX(10px); }
        .rank { font-weight: bold; font-size: 1.3rem; color: #ffd700; }

        /* üéØ –ò–ì–†–´ */
        .game-screen {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.95); z-index: 1000; justify-content: center; align-items: center;
        }
        .game-container {
            background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(20px); border-radius: 25px; padding: 40px;
            max-width: 90%; max-height: 90%; overflow-y: auto;
        }
        canvas {
            border: 3px solid #00ff88; border-radius: 15px; box-shadow: 0 0 30px rgba(0, 255, 136, 0.5); background: #000;
        }
        select { 
            width: 100%; padding: 15px; margin: 15px 0; border-radius: 15px; background: rgba(255,255,255,0.15);
            color: #fff; font-size: 1.1rem; border: 2px solid transparent;
        }
        select:focus { border-color: #00ff88; outline: none; }

        @media (max-width: 768px) {
            .games-grid { grid-template-columns: 1fr; }
            .leaderboards { grid-template-columns: 1fr; }
            .container { padding: 10px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- üîê –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø -->
        <div id="authSection">
            <div id="loginPrompt">üîê –í–û–ô–î–ò –ò –°–¢–ê–ù–¨ –õ–ï–ì–ï–ù–î–û–ô –ê–õ–ï–ö–°–ò–ù–ê!</div>
            <div id="loginForm">
                <input type="text" id="usernameInput" class="auth-input" placeholder="üëë –ù–∏–∫–Ω–µ–π–º" maxlength="20">
                <input type="password" id="passwordInput" class="auth-input" placeholder="üîë –ü–∞—Ä–æ–ª—å (–º–∏–Ω–∏–º—É–º 4 —Å–∏–º–≤–æ–ª–∞)">
                <button class="btn btn-primary" onclick="login()">üöÄ –í–û–ô–¢–ò</button>
                <button class="btn btn-secondary" onclick="register()">‚ûï –†–ï–ì–ò–°–¢–†–ê–¶–ò–Ø</button>
            </div>
            <div id="statusMessage" style="text-align: center; margin-top: 20px; font-size: 1.2rem;"></div>
        </div>

        <!-- üë§ –ò–ù–§–û -->
        <div id="userInfo" class="header">
            <div style="font-size: 1.5rem; color: #00ff88;">
                üëë <span id="currentUser"></span> ‚Äî –õ–ï–ì–ï–ù–î–ê –ê–õ–ï–ö–°–ò–ù–ê!
            </div>
            <button class="btn btn-secondary" onclick="logout()" style="width: auto; padding: 10px 25px;">üö™ –í–´–•–û–î</button>
        </div>

        <!-- üéÆ –ò–ì–†–´ -->
        <div id="gamesSection">
            <div class="header">
                <h1 class="title">ALEKSIN GAMES HUB 2026</h1>
                <p class="subtitle">üêç –ó–ú–ï–ô–ö–ê | üéØ –£–ì–ê–î–ê–ô–ö–ê | üèÜ –û–¢–î–ï–õ–¨–ù–´–ï –¢–û–ü–´ | ‚öîÔ∏è –¢–£–†–ù–ò–†–´</p>
            </div>

            <div class="games-grid">
                <!-- üêç –ó–ú–ï–ô–ö–ê -->
                <div class="glass-card" id="snakeGame">
                    <div class="game-icon" style="color: #00ff88;">üêç</div>
                    <div class="game-title">–ó–º–µ–π–∫–∞ Pro 4.0</div>
                    <div class="features">
                        <span class="feature">üåà –ö—Ä–∞—Å–∏–≤—ã–π –≥—Ä–∞–¥–∏–µ–Ω—Ç</span>
                        <span class="feature">üß± –°—Ç–µ–Ω—ã + —Å–ª–æ–∂–Ω–æ—Å—Ç–∏</span>
                        <span class="feature">üì± –°–≤–∞–π–ø—ã + WASD</span>
                    </div>
                    <select id="wallDifficulty">
                        <option value="0">üòå –õ–µ–≥–∫–æ (150–º—Å)</option>
                        <option value="1">üß± –°—Ä–µ–¥–Ω–µ (120–º—Å)</option>
                        <option value="2">üíÄ –•–∞—Ä–¥–∫–æ—Ä (90–º—Å)</option>
                    </select>
                    <button class="btn btn-primary" onclick="startSnakeGame()">üéÆ –ò–ì–†–ê–¢–¨</button>
                </div>

                <!-- üéØ –£–ì–ê–î–ê–ô–ö–ê -->
                <div class="glass-card" id="guessGame">
                    <div class="game-icon" style="color: #ff6b9d;">üéØ</div>
                    <div class="game-title">–£–≥–∞–¥–∞–π —á–∏—Å–ª–æ PRO</div>
                    <div class="features">
                        <span class="feature">1Ô∏è‚É£ 1-1000 | 2Ô∏è‚É£ 1-10000 | 3Ô∏è‚É£ 1-100000</span>
                        <span class="feature">üîç Enter + –∫–Ω–æ–ø–∫–∞</span>
                        <span class="feature">üìä –¢–æ—á–Ω—ã–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏</span>
                    </div>
                    <select id="guessDifficulty">
                        <option value="0">1Ô∏è‚É£ –õ–µ–≥–∫–æ (1-1000)</option>
                        <option value="1">2Ô∏è‚É£ –°—Ä–µ–¥–Ω–µ (1-10000)</option>
                        <option value="2">3Ô∏è‚É£ –•–∞—Ä–¥–∫–æ—Ä (1-100000)</option>
                    </select>
                    <button class="btn btn-primary" onclick="startGuessGame()">üéØ –ù–û–í–ê–Ø –ò–ì–†–ê</button>
                </div>
            </div>

            <!-- üèÜ –¢–û–ü–´ -->
            <div class="leaderboards">
                <div class="leaderboard-card">
                    <div class="lb-title">üêç –¢–û–ü-10 –ó–ú–ï–ô–ö–ê</div>
                    <ul class="lb-list" id="snakeTop10"></ul>
                    <button class="btn btn-primary" onclick="updateSnakeTop10()" style="width: 100%; margin-top: 15px;">üîÑ –û–ë–ù–û–í–ò–¢–¨</button>
                </div>
                <div class="leaderboard-card">
                    <div class="lb-title">üéØ –¢–û–ü-10 –£–ì–ê–î–ê–ô–ö–ê</div>
                    <ul class="lb-list" id="guessTop10"></ul>
                    <button class="btn btn-primary" onclick="updateGuessTop10()" style="width: 100%; margin-top: 15px;">üîÑ –û–ë–ù–û–í–ò–¢–¨</button>
                </div>
                <div class="leaderboard-card">
                    <div class="lb-title">‚öîÔ∏è –¢–£–†–ù–ò–† –ó–ú–ï–ô–ö–ê</div>
                    <ul class="lb-list" id="snakeTournament"></ul>
                </div>
                <div class="leaderboard-card">
                    <div class="lb-title">‚öîÔ∏è –¢–£–†–ù–ò–† –£–ì–ê–î–ê–ô–ö–ê</div>
                    <ul class="lb-list" id="guessTournament"></ul>
                </div>
            </div>
        </div>
    </div>

    <!-- üêç –ó–ú–ï–ô–ö–ê -->
    <div class="game-screen" id="snakeScreen">
        <div class="game-container">
            <div style="text-align: center; margin-bottom: 30px;">
                <div style="font-size: 2rem; color: #00ff88;">üêç –û–ß–ö–ò: <span id="snakeScore">0</span></div>
                <div id="snakeInstructions" style="color: #fff;">WASD / –°—Ç—Ä–µ–ª–∫–∏ / –°–≤–∞–π–ø—ã</div>
            </div>
            <canvas id="snakeCanvas" width="400" height="400"></canvas>
            <div style="margin-top: 25px;">
                <button class="btn btn-primary" onclick="saveSnakeScore()">üíæ –°–û–•–†–ê–ù–ò–¢–¨</button>
                <button class="btn btn-secondary" onclick="closeSnakeGame()">‚ùå –í–´–ô–¢–ò</button>
            </div>
        </div>
    </div>

    <!-- üéØ –£–ì–ê–î–ê–ô–ö–ê -->
    <div class="game-screen" id="guessScreen">
        <div class="game-container">
            <div style="text-align: center;">
                <div style="font-size: 2rem; color: #ff6b9d; margin-bottom: 20px;" id="guessRange">1 - 1000</div>
                <div style="font-size: 1.5rem; color: #00ff88;">–ü–æ–ø—ã—Ç–æ–∫: <span id="guessAttempts">0</span></div>
                <input type="number" id="guessInput" class="auth-input" placeholder="–í–≤–µ–¥–∏ —á–∏—Å–ª–æ..." min="1">
                <div style="margin: 20px 0;">
                    <button class="btn btn-primary" onclick="checkGuess()">üîç –ü–†–û–í–ï–†–ò–¢–¨</button>
                    <button class="btn btn-secondary" onclick="newGuessGame()">üîÑ –ù–û–í–ê–Ø</button>
                </div>
                <div id="guessFeedback" style="font-size: 1.3rem; min-height: 40px;"></div>
            </div>
        </div>
    </div>

    <script>
        // üéÆ –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï
        let currentUser = '', userToken = '';
        let snake = [{x: 10, y: 10}], dx = 1, dy = 0, food = {}, snakeScore = 0;
        let gameCanvas, ctx, lastSnakeUpdate = 0;
        const SNAKE_SPEED = {0: 150, 1: 120, 2: 90};
        let wallDifficulty = 0, walls = [];
        let currentSecret = 0, minRange = 1, maxRange = 1000, guessAttempts = 0, guessDifficulty = 0;
        const GUESS_RANGES = [[1000, 1], [10000, 1], [100000, 1]];

        // üîê –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø
        window.onload = () => {
            checkAuth();
            updateAllTops();
            // –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫
            setInterval(autoSaveSnake, 30000);
            document.addEventListener('visibilitychange', function() {
                if (!document.hidden) updateAllTops();
            });
        };

        // ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø
function checkAuth() {
    userToken = localStorage.getItem('userToken');
    currentUser = localStorage.getItem('userName');
    
    if (userToken && currentUser) {
        // ‚úÖ –ü–†–Ø–ú–û —Å—Ä–∞–∑—É –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç
        document.getElementById('authSection').style.display = 'none';
        document.getElementById('gamesSection').style.display = 'block';
        document.getElementById('userInfo').style.display = 'flex';
        document.getElementById('currentUser').textContent = currentUser;
        updateAllTops();
        return true;
    }
    return false;
}

function login() {
    const username = document.getElementById('usernameInput').value.trim();
    const password = document.getElementById('passwordInput').value;
    
    if (!username || password.length < 4) {
        showStatus('‚ùå –ù–∏–∫ –∏ –ø–∞—Ä–æ–ª—å (–º–∏–Ω–∏–º—É–º 4 —Å–∏–º–≤–æ–ª–∞) –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã!', 'error');
        return;
    }

    const savedPassword = localStorage.getItem(`user_${username}_pass`);
    if (savedPassword && savedPassword === btoa(password)) {
        // ‚úÖ –°–û–•–†–ê–ù–Ø–ï–ú –∏ —Å—Ä–∞–∑—É –ø–µ—Ä–µ–∫–ª—é—á–∞–µ–º
        userToken = btoa(username + Date.now());
        localStorage.setItem('userToken', userToken);
        localStorage.setItem('userName', username);
        currentUser = username;
        
        showStatus('‚úÖ –í–û–®–Å–õ –£–°–ü–ï–®–ù–û! –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!', 'success');
        
        // ‚úÖ –ü–†–Ø–ú–û —Å—Ä–∞–∑—É –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–≥—Ä—ã –ë–ï–ó setTimeout
        document.getElementById('authSection').style.display = 'none';
        document.getElementById('gamesSection').style.display = 'block';
        document.getElementById('userInfo').style.display = 'flex';
        document.getElementById('currentUser').textContent = currentUser;
        updateAllTops();
        
    } else {
        showStatus('‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω –∏–ª–∏ –ø–∞—Ä–æ–ª—å!', 'error');
        document.getElementById('usernameInput').value = '';
        document.getElementById('passwordInput').value = '';
    }
}

function register() {
    const username = document.getElementById('usernameInput').value.trim();
    const password = document.getElementById('passwordInput').value;
    
    if (!username || password.length < 4) {
        showStatus('‚ùå –ù–∏–∫ –∏ –ø–∞—Ä–æ–ª—å (–º–∏–Ω–∏–º—É–º 4 —Å–∏–º–≤–æ–ª–∞) –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã!', 'error');
        return;
    }

    if (localStorage.getItem(`user_${username}_pass`)) {
        showStatus('‚ùå –ù–∏–∫ —É–∂–µ –∑–∞–Ω—è—Ç!', 'error');
        return;
    }

    localStorage.setItem(`user_${username}_pass`, btoa(password));
    showStatus('‚úÖ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞! –¢–µ–ø–µ—Ä—å –≤–æ–π–¥–∏.', 'success');
}

function logout() {
    if (confirm('üö™ –í—ã–π—Ç–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞?')) {
        localStorage.removeItem('userToken');
        localStorage.removeItem('userName');
        location.reload(); // ‚úÖ –ü–æ–ª–Ω—ã–π —Ä–µ—Ñ—Ä–µ—à
    }
}

function showStatus(message, type) {
    const statusEl = document.getElementById('statusMessage');
    statusEl.textContent = message;
    statusEl.style.color = type === 'success' ? '#00ff88' : '#ff4757';
    statusEl.style.fontSize = '1.2rem';
    statusEl.style.fontWeight = 'bold';
}

// ‚úÖ –ò–ó–ú–ï–ù–ò window.onload
window.onload = () => {
    checkAuth();  // ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ä–∞–∑—É
    updateAllTops();
    setInterval(autoSaveSnake, 30000);
};

        // üêç –ó–ú–ï–ô–ö–ê –ù–û–í–´–ô –í–ò–î
        function startSnakeGame() {
            if (!currentUser) return alert('üîê –í–æ–π–¥–∏!');
            wallDifficulty = parseInt(document.getElementById('wallDifficulty').value);
            setupWalls();
            snakeScore = 0;
            snake = [{x: 10, y: 10}];
            dx = 1; dy = 0;
            spawnFood();
            lastSnakeUpdate = 0;
            document.getElementById('snakeScore').textContent = '0';
            document.getElementById('snakeScreen').style.display = 'flex';
            gameCanvas = document.getElementById('snakeCanvas');
            ctx = gameCanvas.getContext('2d');
            gameLoop(0);
        }

        function setupWalls() {
            walls = [];
            const wallCount = [5, 10, 15][wallDifficulty];
            for (let i = 0; i < wallCount; i++) {
                walls.push({x: Math.floor(Math.random() * 38) + 1, y: Math.floor(Math.random() * 38) + 1});
            }
        }

        function spawnFood() {
            do {
                food = {x: Math.floor(Math.random() * 38) + 1, y: Math.floor(Math.random() * 38) + 1};
            } while (walls.some(w => w.x === food.x && w.y === food.y));
        }

        function gameLoop(currentTime) {
            const speed = SNAKE_SPEED[wallDifficulty];
            if (currentTime - lastSnakeUpdate < speed) {
                requestAnimationFrame(gameLoop);
                return;
            }
            lastSnakeUpdate = currentTime;

            ctx.clearRect(0, 0, 400, 400);
            
            // ‚ú® –ù–û–í–´–ï –°–¢–ï–ù–´ (–∫–≤–∞–¥—Ä–∞—Ç—ã —Å –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–º)
            walls.forEach(wall => {
                const grad = ctx.createLinearGradient(wall.x*10, wall.y*10, wall.x*10+10, wall.y*10+10);
                grad.addColorStop(0, '#666'); grad.addColorStop(1, '#333');
                ctx.fillStyle = grad;
                ctx.shadowColor = '#888'; ctx.shadowBlur = 10;
                ctx.fillRect(wall.x * 10 + 1, wall.y * 10 + 1, 8, 8);
                ctx.shadowBlur = 0;
            });

            // ‚ú® –ï–î–ê (–ø—É–ª—å—Å–∏—Ä—É—é—â–∏–π –∫—Ä—É–≥)
            const pulse = Math.sin(currentTime * 0.01) * 2 + 4;
            const foodGrad = ctx.createRadialGradient(food.x*10+5, food.y*10+5, 0, food.x*10+5, food.y*10+5, pulse);
            foodGrad.addColorStop(0, '#ff6b9d'); foodGrad.addColorStop(0.7, '#ff4757'); foodGrad.addColorStop(1, '#8b0000');
            ctx.fillStyle = foodGrad; ctx.shadowColor = '#ff6b9d'; ctx.shadowBlur = 20;
            ctx.beginPath(); ctx.arc(food.x*10+5, food.y*10+5, pulse, 0, Math.PI*2); ctx.fill();
            ctx.shadowBlur = 0;

            // –î–≤–∏–∂–µ–Ω–∏–µ
            const head = {x: snake[0].x + dx, y: snake[0].y + dy};
            if (head.x < 1 || head.x > 39 || head.y < 1 || head.y > 39 || 
                walls.some(w => w.x === head.x && w.y === head.y) ||
                snake.some(s => s.x === head.x && s.y === head.y)) {
                gameOver();
                return;
            }

            snake.unshift(head);
            if (head.x === food.x && head.y === food.y) {
                snakeScore += 10;
                document.getElementById('snakeScore').textContent = snakeScore;
                spawnFood();
                autoSaveSnake(); // –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–∏ –µ–¥–µ
            } else snake.pop();

            // ‚ú® –ö–†–ê–°–ò–í–ê–Ø –ó–ú–ï–ô–ö–ê (3D —ç—Ñ—Ñ–µ–∫—Ç + –≥—Ä–∞–¥–∏–µ–Ω—Ç + —Å–≤–µ—á–µ–Ω–∏–µ)
            for (let i = 0; i < snake.length; i++) {
                const size = i === 0 ? 9 : 8;
                const glow = i === 0 ? 25 : 15;
                
                // –û—Å–Ω–æ–≤–Ω–æ–π –≥—Ä–∞–¥–∏–µ–Ω—Ç —Ç–µ–ª–∞
                const bodyGrad = ctx.createLinearGradient(
                    snake[i].x*10+1, snake[i].y*10+1, 
                    snake[i].x*10+1+size, snake[i].y*10+1+size
                );
                bodyGrad.addColorStop(0, i === 0 ? '#00ff88' : `hsl(${120 + i*2}, 100%, ${50 + i*2}%)`);
                bodyGrad.addColorStop(0.5, i === 0 ? '#00bfff' : '#1a0033');
                bodyGrad.addColorStop(1, '#0a001a');
                
                // –¢–µ–Ω—å –¥–ª—è 3D
                ctx.shadowColor = '#000'; ctx.shadowBlur = 8; ctx.shadowOffsetY = 3;
                ctx.fillStyle = 'rgba(0,0,0,0.3)';
                ctx.fillRect(snake[i].x*10+2, snake[i].y*10+3, size, size-2);
                
                // –û—Å–Ω–æ–≤–Ω–æ–µ —Ç–µ–ª–æ
                ctx.shadowColor = i === 0 ? '#00ff88' : '#00bfff';
                ctx.shadowBlur = glow;
                ctx.fillStyle = bodyGrad;
                ctx.fillRect(snake[i].x*10+1, snake[i].y*10+1, size, size);
                ctx.shadowBlur = 0;
                
                // –ë–ª–∏–∫ –Ω–∞ –≥–æ–ª–æ–≤–µ
                if (i === 0) {
                    ctx.shadowColor = '#ffffff'; ctx.shadowBlur = 10;
                    ctx.fillStyle = 'rgba(255,255,255,0.6)';
                    ctx.fillRect(snake[i].x*10+2, snake[i].y*10+2, 3, 3);
                }
            }

            requestAnimationFrame(gameLoop);
        }

        function autoSaveSnake() {
            if (snakeScore > (localStorage.getItem(`snake_best_${currentUser}`) || 0)) {
                localStorage.setItem(`snake_best_${currentUser}`, snakeScore);
            }
        }

        function gameOver() {
            alert(`üêç GAME OVER! ${snakeScore} –æ—á–∫–æ–≤`);
            closeSnakeGame();
        }

        // üéØ –£–ì–ê–î–ê–ô–ö–ê 3 –†–ï–ñ–ò–ú–ê
        function startGuessGame() {
            if (!currentUser) return alert('üîê –í–æ–π–¥–∏!');
            guessDifficulty = parseInt(document.getElementById('guessDifficulty').value);
            [maxRange, minRange] = GUESS_RANGES[guessDifficulty];
            currentSecret = Math.floor(Math.random() * maxRange) + minRange;
            guessAttempts = 0;
            document.getElementById('guessAttempts').textContent = '0';
            document.getElementById('guessRange').textContent = `${minRange}-${maxRange}`;
            document.getElementById('guessInput').max = maxRange;
            document.getElementById('guessInput').value = '';
            document.getElementById('guessFeedback').textContent = '';
            document.getElementById('guessScreen').style.display = 'flex';
            document.getElementById('guessInput').focus();
        }

        function checkGuess() {
            const guess = parseInt(document.getElementById('guessInput').value);
            guessAttempts++;
            document.getElementById('guessAttempts').textContent = guessAttempts;

            if (isNaN(guess) || guess < minRange || guess > maxRange) {
                return document.getElementById('guessFeedback').textContent = `‚ùå ${minRange}-${maxRange}!`;
            }

            if (guess === currentSecret) {
                const score = Math.max(0, maxRange - (guessAttempts * 10));
                document.getElementById('guessFeedback').innerHTML = 
                    `üéâ –£–ì–ê–î–ê–õ ${currentSecret}! –û—á–∫–∏: ${score}`;
                saveGuessScore(score);
            } else if (guess < currentSecret) {
                minRange = guess + 1;
                document.getElementById('guessFeedback').textContent = `üìà –ë–æ–ª—å—à–µ ${guess}! ${minRange}-${maxRange}`;
            } else {
                maxRange = guess - 1;
                document.getElementById('guessFeedback').textContent = `üìâ –ú–µ–Ω—å—à–µ ${guess}! ${minRange}-${maxRange}`;
            }
            document.getElementById('guessRange').textContent = `${minRange}-${maxRange}`;
            document.getElementById('guessInput').value = '';
            document.getElementById('guessInput').focus();
        }

        // üèÜ –û–¢–î–ï–õ–¨–ù–´–ï –¢–û–ü–´ (1 –∑–∞–ø–∏—Å—å –Ω–∞ –∏–≥—Ä–æ–∫–∞)
        function updateAllTops() {
            updateSnakeTop10();
            updateGuessTop10();
        }

        function updateSnakeTop10() {
            const scores = [];
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key.startsWith('snake_best_')) {
                    const name = key.replace('snake_best_', '');
                    scores.push({name, score: parseInt(localStorage.getItem(key)) || 0});
                }
            }
            const top10 = scores.sort((a, b) => b.score - a.score).slice(0, 10);
            document.getElementById('snakeTop10').innerHTML = top10.length ? 
                top10.map((p, i) => `<li class="lb-item"><span class="rank">${i+1}.</span><strong>${p.name}</strong><span>${p.score}üî•</span></li>`).join('')
                : '<li style="text-align:center;color:#888;">üêç –ë–£–î–¨ –ü–ï–†–í–´–ú!</li>';
        }

        function updateGuessTop10() {
            const scores = JSON.parse(localStorage.getItem('guess_best_scores') || '[]');
            const top10 = scores.sort((a, b) => b.score - a.score).slice(0, 10);
            document.getElementById('guessTop10').innerHTML = top10.length ? 
                top10.map((p, i) => `<li class="lb-item"><span class="rank">${i+1}.</span><strong>${p.name}</strong><span>${p.score}üî•</span></li>`).join('')
                : '<li style="text-align:center;color:#888;">üéØ –ë–£–î–¨ –ü–ï–†–í–´–ú!</li>';
        }

        function saveSnakeScore() {
            if (!currentUser) return;
            const prevBest = parseInt(localStorage.getItem(`snake_best_${currentUser}`)) || 0;
            if (snakeScore > prevBest) {
                localStorage.setItem(`snake_best_${currentUser}`, snakeScore);
                updateSnakeTop10();
                alert(`üêç –ù–æ–≤—ã–π —Ä–µ–∫–æ—Ä–¥: ${snakeScore}!`);
            }
            closeSnakeGame();
        }

        function saveGuessScore(score) {
            const scores = JSON.parse(localStorage.getItem('guess_best_scores') || '[]');
            const existing = scores.find(s => s.name === currentUser);
            if (!existing || score > existing.score) {
                if (existing) scores[scores.indexOf(existing)] = {name: currentUser, score};
                else scores.push({name: currentUser, score});
                localStorage.setItem('guess_best_scores', JSON.stringify(scores.slice(0, 100)));
                updateGuessTop10();
                alert(`üéØ –†–µ–∫–æ—Ä–¥: ${score}!`);
            }
            // –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –∏–≥—Ä—É
        }

        // –£–ü–†–ê–í–õ–ï–ù–ò–ï
        document.addEventListener('keydown', e => {
            if (document.getElementById('snakeScreen').style.display === 'flex') {
                switch(e.key) {
                    case 'w': case 'ArrowUp': changeDirection(0, -1); break;
                    case 's': case 'ArrowDown': changeDirection(0, 1); break;
                    case 'a': case 'ArrowLeft': changeDirection(-1, 0); break;
                    case 'd': case 'ArrowRight': changeDirection(1, 0); break;
                }
            }
            if (e.key === 'Enter' && document.getElementById('guessScreen').style.display === 'flex') {
                checkGuess();
            }
        });

        let touchStartX = 0, touchStartY = 0;
        document.addEventListener('touchstart', e => { touchStartX = e.touches[0].clientX; touchStartY = e.touches[0].clientY; });
        document.addEventListener('touchend', e => {
            if (!gameCanvas) return;
            const diffX = touchStartX - e.changedTouches[0].clientX;
            const diffY = touchStartY - e.changedTouches[0].clientY;
            if (Math.abs(diffX) > Math.abs(diffY)) {
                diffX > 50 ? changeDirection(-1, 0) : changeDirection(1, 0);
            } else {
                diffY > 50 ? changeDirection(0, -1) : changeDirection(0, 1);
            }
        });

        function changeDirection(newDx, newDy) {
            if (newDx * dx + newDy * dy === 0) { dx = newDx; dy = newDy; }
        }

        function closeSnakeGame() { document.getElementById('snakeScreen').style.display = 'none'; }
        function newGuessGame() { startGuessGame(); }
    </script>
</body>
</html>

